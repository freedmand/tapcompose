!function(){"use strict";function t(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function e(t,e){return e={exports:{}},t(e,e.exports),e.exports}function i(t,e){for(var i=t%e;i<0;)i+=e;return i>e/2&&(i-=e),i}function n(){}function r(t){for(var e,i,n=1,r=arguments.length;n<r;n++){i=arguments[n];for(e in i)t[e]=i[e]}return t}function o(t,e){e.appendChild(t)}function s(t,e,i){e.insertBefore(t,i)}function a(t){t.parentNode.removeChild(t)}function h(t){for(var e=0;e<t.length;e+=1)t[e]&&t[e].d()}function u(t){return document.createElement(t)}function l(t){return document.createTextNode(t)}function c(t,e,i){t.addEventListener(e,i,!1)}function f(t,e,i){t.removeEventListener(e,i,!1)}function d(t,e,i){t.setAttribute(e,i)}function v(t,e,i){t.style.setProperty(e,i)}function y(){return Object.create(null)}function g(t){this.destroy=n,this.fire("destroy"),this.set=this.get=n,!1!==t&&this._fragment.u(),this._fragment.d(),this._fragment=this._state=null}function p(t,e){return t!==e||t&&"object"==typeof t||"function"==typeof t}function _(t,e,i,n,r){for(var o in e)if(i[o]){var s=n[o],a=r[o],h=e[o];if(h)for(var u=0;u<h.length;u+=1){var l=h[u];l.__calling||(l.__calling=!0,l.call(t,s,a),l.__calling=!1)}}}function m(t){for(;t&&t.length;)t.pop()()}function x(t){d(t,"svelte-1994413770","")}function b(t,e,i,n,r){for(var o,l=i[2],c=[],f=0;f<l.length;f+=1)c[f]=k(t,e,i,n,l,l[f],f,r);return{c:function(){o=u("tr");for(var t=0;t<c.length;t+=1)c[t].c()},m:function(t,e){s(o,t,e);for(var i=0;i<c.length;i+=1)c[i].m(o,null)},p:function(t,e,i,n,s){var a=n[2];if(t.arpeggios||t.styleIndex){for(var h=0;h<a.length;h+=1)c[h]?c[h].p(t,e,i,n,s,a,a[h],h):(c[h]=k(e,i,n,s,a,a[h],h,r),c[h].c(),c[h].m(o,null));for(;h<c.length;h+=1)c[h].u(),c[h].d();c.length=a.length}},u:function(){a(o);for(var t=0;t<c.length;t+=1)c[t].u()},d:function(){h(c)}}}function k(t,e,i,r,h,l,c,f){var d,y,g;return{c:function(){d=u("td"),y=u("div"),this.h()},h:function(){x(d),x(y),y.className=g=l,v(d,"width",1/i[2].length*100+"%")},m:function(t,e){s(d,t,e),o(y,d)},p:function(t,e,i,n,r,o,s,a){(t.arpeggios||t.styleIndex)&&g!==(g=s)&&(y.className=g),(t.arpeggios||t.styleIndex)&&v(d,"width",1/n[2].length*100+"%")},u:function(){a(d)},d:n}}function w(t){!function(t,e){t._observers={pre:y(),post:y()},t._handlers=y(),t._root=e._root||t,t._bind=e._bind,t.options=e,t.store=t._root.options.store}(this,t),this._state=r({styleIndex:0,arpeggios:Wn,ON:Dn,OFF:Gn,HOLD:Yn},t.data),this._fragment=function(t,e){function i(t){var i=e.get();e.set({styleIndex:(i.styleIndex+i.arpeggios.length-1)%i.arpeggios.length})}function n(t){var i=e.get();e.set({styleIndex:(i.styleIndex+1)%i.arpeggios.length})}for(var r,v,y,g,p,_,m,k,w,T,S,E,R,C,O=t.arpeggios[t.styleIndex%t.arpeggios.length].name,N=t.arpeggios[t.styleIndex].arpeggio.slice().reverse(),P=[],A=0;A<N.length;A+=1)P[A]=b(t,N,N[A],A,e);return{c:function(){(r=u("div")).textContent="Groove",v=l("\n"),y=u("div"),g=u("div"),p=u("div"),_=l(O),m=l("\n        "),k=u("div"),(w=u("div")).textContent="<",T=l("\n            "),(S=u("div")).textContent=">",E=l("\n    "),R=u("div"),C=u("table");for(var t=0;t<P.length;t+=1)P[t].c();this.h()},h:function(){x(r),r.className="groove",x(y),x(p),p.className="style",x(k),x(w),w.className="button",c(w,"click",i),x(S),S.className="button",c(S,"click",n),k.className="nav",x(R),x(C),d(C,"cellspacing","0"),d(C,"cellpadding","2"),R.className="arpeggiator",y.className="component"},m:function(t,e){s(r,t,e),s(v,t,e),s(y,t,e),o(g,y),o(p,g),o(_,p),o(m,g),o(k,g),o(w,k),o(T,k),o(S,k),o(E,y),o(R,y),o(C,R);for(var i=0;i<P.length;i+=1)P[i].m(C,null)},p:function(t,i){(t.arpeggios||t.styleIndex)&&O!==(O=i.arpeggios[i.styleIndex%i.arpeggios.length].name)&&(_.data=O);var n=i.arpeggios[i.styleIndex].arpeggio.slice().reverse();if(t.arpeggios||t.styleIndex){for(var r=0;r<n.length;r+=1)P[r]?P[r].p(t,i,n,n[r],r):(P[r]=b(i,n,n[r],r,e),P[r].c(),P[r].m(C,null));for(;r<P.length;r+=1)P[r].u(),P[r].d();P.length=n.length}},u:function(){a(r),a(v),a(y);for(var t=0;t<P.length;t+=1)P[t].u()},d:function(){f(w,"click",i),f(S,"click",n),h(P)}}}(this._state,this),t.target&&(this._fragment.c(),this._fragment.m(t.target,t.anchor||null))}function T(t){return t[Math.floor(Math.random()*t.length)]}function S(t,e,i,n,r){t[e][i]||(t[e][i]={}),t[e][i][n]=r}function E(t,e,i,n,r,o){function s(){return e+t[c++]*n}function a(){return i+t[c++]*r}for(var h=void 0,u=void 0,l=void 0,c=0;c<t.length;)switch(h=t[c++]){case"m":case"l":o[h](s(),a());break;case"q":u=s(),l=a(),o.q(s(),a(),u,l);break;case"b":u=s(),l=a(),o.b(s(),a(),s(),a(),u,l)}}function R(t,e,i){var n=(e.isrest?0:1)*i;t.line+=n,t.maxLine+=n,t.minLine+=n,t.note.setKeyLine(0,t.note.getKeyLine(0)+n)}function C(){for(var t=arguments,e=arguments.length,i=Array(e),n=0;n<e;n++)i[n]=t[n];Ur.DEBUG&&or.L("Vex.Flow.Accidental",i)}function O(t,e,i,n,r){if(e!==zr.type.BOLD_DOUBLE_LEFT&&e!==zr.type.BOLD_DOUBLE_RIGHT)throw new or.RERR("InvalidConnector","A REPEAT_BEGIN or REPEAT_END type must be provided.");var o=3,s=3.5;e===zr.type.BOLD_DOUBLE_RIGHT&&(o=-5,s=3),t.fillRect(i+o,n,1,r-n),t.fillRect(i-2,n,s,r-n)}function N(){for(var t=arguments,e=arguments.length,i=Array(e),n=0;n<e;n++)i[n]=t[n];xo.DEBUG&&or.L("Vex.Flow.ModifierContext",i)}function P(t,e,i,n){var r=e;for(i+=1;i<t.length;i+=1){var o=t[i];if(!o.isRest()&&!o.shouldIgnoreTicks()){r=o.getLineForRest();break}}if(n&&e!==r){var s=Math.max(e,r),a=Math.min(e,r);r=or.MidLine(s,a)}return r}function A(t,e,i){if(!t||!t.length)throw new or.RERR("BadArgument","No voices to format");var n=t[0].getTotalTicks(),r=t.reduce(function(t,e){if(!e.getTotalTicks().equals(n))throw new or.RERR("TickMismatch","Voices should have same total note duration in ticks.");if(e.getMode()===Xr.Mode.STRICT&&!e.isComplete())throw new or.RERR("IncompleteVoice","Voice does not have enough notes.");return Math.max(t,ar.LCM(t,e.getResolutionMultiplier()))},1),o={},s=[],a=[];return t.forEach(function(t){var n=new ar(0,r);t.getTickables().forEach(function(t){var r=n.numerator;if(!o[r]){var h=new e;a.push(h),o[r]=h}i(t,o[r]),s.push(r),n.add(t.getTicks())})}),{map:o,array:a,list:or.SortAndUnique(s,function(t,e){return t-e},function(t,e){return t===e}),resolutionMultiplier:r}}function L(t){var e=0;return t.forEach(function(t){t.keyProps&&t.keyProps.forEach(function(t){e+=t.line-3})}),e>=0?gr.DOWN:gr.UP}var M=Math.ceil,F=Math.floor,B=function(t){return isNaN(t=+t)?0:(t>0?F:M)(t)},I=function(t){if(void 0==t)throw TypeError("Can't call method on  "+t);return t},G=e(function(t){var e=t.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=e)}),D=e(function(t){var e=t.exports={version:"2.5.2"};"number"==typeof __e&&(__e=e)}),Y=function(t,e,i){if(function(t){if("function"!=typeof t)throw TypeError(t+" is not a function!")}(t),void 0===e)return t;switch(i){case 1:return function(i){return t.call(e,i)};case 2:return function(i,n){return t.call(e,i,n)};case 3:return function(i,n,r){return t.call(e,i,n,r)}}return function(){return t.apply(e,arguments)}},W=function(t){return"object"==typeof t?null!==t:"function"==typeof t},V=function(t){if(!W(t))throw TypeError(t+" is not an object!");return t},H=function(t){try{return!!t()}catch(t){return!0}},j=!H(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a}),U=G.document,X=W(U)&&W(U.createElement),z=function(t){return X?U.createElement(t):{}},K=!j&&!H(function(){return 7!=Object.defineProperty(z("div"),"a",{get:function(){return 7}}).a}),q=function(t,e){if(!W(t))return t;var i,n;if(e&&"function"==typeof(i=t.toString)&&!W(n=i.call(t)))return n;if("function"==typeof(i=t.valueOf)&&!W(n=i.call(t)))return n;if(!e&&"function"==typeof(i=t.toString)&&!W(n=i.call(t)))return n;throw TypeError("Can't convert object to primitive value")},J=Object.defineProperty,Q={f:j?Object.defineProperty:function(t,e,i){if(V(t),e=q(e,!0),V(i),K)try{return J(t,e,i)}catch(t){}if("get"in i||"set"in i)throw TypeError("Accessors not supported!");return"value"in i&&(t[e]=i.value),t}},Z=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}},$=j?function(t,e,i){return Q.f(t,e,Z(1,i))}:function(t,e,i){return t[e]=i,t},tt="prototype",et=function(t,e,i){var n,r,o,s=t&et.F,a=t&et.G,h=t&et.S,u=t&et.P,l=t&et.B,c=t&et.W,f=a?D:D[e]||(D[e]={}),d=f[tt],v=a?G:h?G[e]:(G[e]||{})[tt];a&&(i=e);for(n in i)(r=!s&&v&&void 0!==v[n])&&n in f||(o=r?v[n]:i[n],f[n]=a&&"function"!=typeof v[n]?i[n]:l&&r?Y(o,G):c&&v[n]==o?function(t){var e=function(e,i,n){if(this instanceof t){switch(arguments.length){case 0:return new t;case 1:return new t(e);case 2:return new t(e,i)}return new t(e,i,n)}return t.apply(this,arguments)};return e[tt]=t[tt],e}(o):u&&"function"==typeof o?Y(Function.call,o):o,u&&((f.virtual||(f.virtual={}))[n]=o,t&et.R&&d&&!d[n]&&$(d,n,o)))};et.F=1,et.G=2,et.S=4,et.P=8,et.B=16,et.W=32,et.U=64,et.R=128;var it=et,nt=$,rt={}.hasOwnProperty,ot=function(t,e){return rt.call(t,e)},st={},at={}.toString,ht=function(t){return at.call(t).slice(8,-1)},ut=Object("z").propertyIsEnumerable(0)?Object:function(t){return"String"==ht(t)?t.split(""):Object(t)},lt=function(t){return ut(I(t))},ct=Math.min,ft=function(t){return t>0?ct(B(t),9007199254740991):0},dt=Math.max,vt=Math.min,yt="__core-js_shared__",gt=G[yt]||(G[yt]={}),pt=function(t){return gt[t]||(gt[t]={})},_t=0,mt=Math.random(),xt=function(t){return"Symbol(".concat(void 0===t?"":t,")_",(++_t+mt).toString(36))},bt=pt("keys"),kt=function(t){return bt[t]||(bt[t]=xt(t))},wt=function(t){return function(e,i,n){var r,o=lt(e),s=ft(o.length),a=function(t,e){return(t=B(t))<0?dt(t+e,0):vt(t,e)}(n,s);if(t&&i!=i){for(;s>a;)if((r=o[a++])!=r)return!0}else for(;s>a;a++)if((t||a in o)&&o[a]===i)return t||a||0;return!t&&-1}}(!1),Tt=kt("IE_PROTO"),St=function(t,e){var i,n=lt(t),r=0,o=[];for(i in n)i!=Tt&&ot(n,i)&&o.push(i);for(;e.length>r;)ot(n,i=e[r++])&&(~wt(o,i)||o.push(i));return o},Et="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(","),Rt=Object.keys||function(t){return St(t,Et)},Ct=j?Object.defineProperties:function(t,e){V(t);for(var i,n=Rt(e),r=n.length,o=0;r>o;)Q.f(t,i=n[o++],e[i]);return t},Ot=G.document,Nt=Ot&&Ot.documentElement,Pt=kt("IE_PROTO"),At=function(){},Lt="prototype",Mt=function(){var t,e=z("iframe"),i=Et.length;for(e.style.display="none",Nt.appendChild(e),e.src="javascript:",(t=e.contentWindow.document).open(),t.write("<script>document.F=Object<\/script>"),t.close(),Mt=t.F;i--;)delete Mt[Lt][Et[i]];return Mt()},Ft=Object.create||function(t,e){var i;return null!==t?(At[Lt]=V(t),i=new At,At[Lt]=null,i[Pt]=t):i=Mt(),void 0===e?i:Ct(i,e)},Bt=e(function(t){var e=pt("wks"),i=G.Symbol,n="function"==typeof i;(t.exports=function(t){return e[t]||(e[t]=n&&i[t]||(n?i:xt)("Symbol."+t))}).store=e}),It=Q.f,Gt=Bt("toStringTag"),Dt=function(t,e,i){t&&!ot(t=i?t:t.prototype,Gt)&&It(t,Gt,{configurable:!0,value:e})},Yt={};$(Yt,Bt("iterator"),function(){return this});var Wt=function(t){return Object(I(t))},Vt=kt("IE_PROTO"),Ht=Object.prototype,jt=Object.getPrototypeOf||function(t){return t=Wt(t),ot(t,Vt)?t[Vt]:"function"==typeof t.constructor&&t instanceof t.constructor?t.constructor.prototype:t instanceof Object?Ht:null},Ut=Bt("iterator"),Xt=!([].keys&&"next"in[].keys()),zt="values",Kt=function(){return this},qt=function(t,e,i,n,r,o,s){!function(t,e,i){t.prototype=Ft(Yt,{next:Z(1,i)}),Dt(t,e+" Iterator")}(i,e,n);var a,h,u,l=function(t){if(!Xt&&t in v)return v[t];switch(t){case"keys":case zt:return function(){return new i(this,t)}}return function(){return new i(this,t)}},c=e+" Iterator",f=r==zt,d=!1,v=t.prototype,y=v[Ut]||v["@@iterator"]||r&&v[r],g=y||l(r),p=r?f?l("entries"):g:void 0,_="Array"==e?v.entries||y:y;if(_&&(u=jt(_.call(new t)))!==Object.prototype&&u.next&&Dt(u,c,!0),f&&y&&y.name!==zt&&(d=!0,g=function(){return y.call(this)}),s&&(Xt||d||!v[Ut])&&$(v,Ut,g),st[e]=g,st[c]=Kt,r)if(a={values:f?g:l(zt),keys:o?g:l("keys"),entries:p},s)for(h in a)h in v||nt(v,h,a[h]);else it(it.P+it.F*(Xt||d),e,a);return a},Jt=function(t){return function(e,i){var n,r,o=String(I(e)),s=B(i),a=o.length;return s<0||s>=a?t?"":void 0:(n=o.charCodeAt(s))<55296||n>56319||s+1===a||(r=o.charCodeAt(s+1))<56320||r>57343?t?o.charAt(s):n:t?o.slice(s,s+2):r-56320+(n-55296<<10)+65536}}(!0);qt(String,"String",function(t){this._t=String(t),this._i=0},function(){var t,e=this._t,i=this._i;return i>=e.length?{value:void 0,done:!0}:(t=Jt(e,i),this._i+=t.length,{value:t,done:!1})});var Qt=function(){},Zt=function(t,e){return{value:e,done:!!t}};qt(Array,"Array",function(t,e){this._t=lt(t),this._i=0,this._k=e},function(){var t=this._t,e=this._k,i=this._i++;return!t||i>=t.length?(this._t=void 0,Zt(1)):"keys"==e?Zt(0,i):"values"==e?Zt(0,t[i]):Zt(0,[i,t[i]])},"values");st.Arguments=st.Array,Qt(),Qt(),Qt();for(var $t=Bt("toStringTag"),te="CSSRuleList,CSSStyleDeclaration,CSSValueList,ClientRectList,DOMRectList,DOMStringList,DOMTokenList,DataTransferItemList,FileList,HTMLAllCollection,HTMLCollection,HTMLFormElement,HTMLSelectElement,MediaList,MimeTypeArray,NamedNodeMap,NodeList,PaintRequestList,Plugin,PluginArray,SVGLengthList,SVGNumberList,SVGPathSegList,SVGPointList,SVGStringList,SVGTransformList,SourceBufferList,StyleSheetList,TextTrackCueList,TextTrackList,TouchList".split(","),ee=0;ee<te.length;ee++){var ie=te[ee],ne=G[ie],re=ne&&ne.prototype;re&&!re[$t]&&$(re,$t,ie),st[ie]=st.Array}var oe={f:Bt},se=oe.f("iterator"),ae=e(function(t){t.exports={default:se,__esModule:!0}});t(ae);var he=e(function(t){var e=xt("meta"),i=Q.f,n=0,r=Object.isExtensible||function(){return!0},o=!H(function(){return r(Object.preventExtensions({}))}),s=function(t){i(t,e,{value:{i:"O"+ ++n,w:{}}})},a=t.exports={KEY:e,NEED:!1,fastKey:function(t,i){if(!W(t))return"symbol"==typeof t?t:("string"==typeof t?"S":"P")+t;if(!ot(t,e)){if(!r(t))return"F";if(!i)return"E";s(t)}return t[e].i},getWeak:function(t,i){if(!ot(t,e)){if(!r(t))return!0;if(!i)return!1;s(t)}return t[e].w},onFreeze:function(t){return o&&a.NEED&&r(t)&&!ot(t,e)&&s(t),t}}}),ue=Q.f,le=function(t){var e=D.Symbol||(D.Symbol={});"_"==t.charAt(0)||t in e||ue(e,t,{value:oe.f(t)})},ce={f:Object.getOwnPropertySymbols},fe={f:{}.propertyIsEnumerable},de=Array.isArray||function(t){return"Array"==ht(t)},ve=Et.concat("length","prototype"),ye={f:Object.getOwnPropertyNames||function(t){return St(t,ve)}},ge=ye.f,pe={}.toString,_e="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],me={f:function(t){return _e&&"[object Window]"==pe.call(t)?function(t){try{return ge(t)}catch(t){return _e.slice()}}(t):ge(lt(t))}},xe=Object.getOwnPropertyDescriptor,be={f:j?xe:function(t,e){if(t=lt(t),e=q(e,!0),K)try{return xe(t,e)}catch(t){}if(ot(t,e))return Z(!fe.f.call(t,e),t[e])}},ke=he.KEY,we=be.f,Te=Q.f,Se=me.f,Ee=G.Symbol,Re=G.JSON,Ce=Re&&Re.stringify,Oe="prototype",Ne=Bt("_hidden"),Pe=Bt("toPrimitive"),Ae={}.propertyIsEnumerable,Le=pt("symbol-registry"),Me=pt("symbols"),Fe=pt("op-symbols"),Be=Object[Oe],Ie="function"==typeof Ee,Ge=G.QObject,De=!Ge||!Ge[Oe]||!Ge[Oe].findChild,Ye=j&&H(function(){return 7!=Ft(Te({},"a",{get:function(){return Te(this,"a",{value:7}).a}})).a})?function(t,e,i){var n=we(Be,e);n&&delete Be[e],Te(t,e,i),n&&t!==Be&&Te(Be,e,n)}:Te,We=function(t){var e=Me[t]=Ft(Ee[Oe]);return e._k=t,e},Ve=Ie&&"symbol"==typeof Ee.iterator?function(t){return"symbol"==typeof t}:function(t){return t instanceof Ee},He=function(t,e,i){return t===Be&&He(Fe,e,i),V(t),e=q(e,!0),V(i),ot(Me,e)?(i.enumerable?(ot(t,Ne)&&t[Ne][e]&&(t[Ne][e]=!1),i=Ft(i,{enumerable:Z(0,!1)})):(ot(t,Ne)||Te(t,Ne,Z(1,{})),t[Ne][e]=!0),Ye(t,e,i)):Te(t,e,i)},je=function(t,e){V(t);for(var i,n=function(t){var e=Rt(t),i=ce.f;if(i)for(var n,r=i(t),o=fe.f,s=0;r.length>s;)o.call(t,n=r[s++])&&e.push(n);return e}(e=lt(e)),r=0,o=n.length;o>r;)He(t,i=n[r++],e[i]);return t},Ue=function(t){var e=Ae.call(this,t=q(t,!0));return!(this===Be&&ot(Me,t)&&!ot(Fe,t))&&(!(e||!ot(this,t)||!ot(Me,t)||ot(this,Ne)&&this[Ne][t])||e)},Xe=function(t,e){if(t=lt(t),e=q(e,!0),t!==Be||!ot(Me,e)||ot(Fe,e)){var i=we(t,e);return!i||!ot(Me,e)||ot(t,Ne)&&t[Ne][e]||(i.enumerable=!0),i}},ze=function(t){for(var e,i=Se(lt(t)),n=[],r=0;i.length>r;)ot(Me,e=i[r++])||e==Ne||e==ke||n.push(e);return n},Ke=function(t){for(var e,i=t===Be,n=Se(i?Fe:lt(t)),r=[],o=0;n.length>o;)!ot(Me,e=n[o++])||i&&!ot(Be,e)||r.push(Me[e]);return r};Ie||(nt((Ee=function(){if(this instanceof Ee)throw TypeError("Symbol is not a constructor!");var t=xt(arguments.length>0?arguments[0]:void 0),e=function(i){this===Be&&e.call(Fe,i),ot(this,Ne)&&ot(this[Ne],t)&&(this[Ne][t]=!1),Ye(this,t,Z(1,i))};return j&&De&&Ye(Be,t,{configurable:!0,set:e}),We(t)})[Oe],"toString",function(){return this._k}),be.f=Xe,Q.f=He,ye.f=me.f=ze,fe.f=Ue,ce.f=Ke,oe.f=function(t){return We(Bt(t))}),it(it.G+it.W+it.F*!Ie,{Symbol:Ee});for(var qe="hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","),Je=0;qe.length>Je;)Bt(qe[Je++]);for(var Qe=Rt(Bt.store),Ze=0;Qe.length>Ze;)le(Qe[Ze++]);it(it.S+it.F*!Ie,"Symbol",{for:function(t){return ot(Le,t+="")?Le[t]:Le[t]=Ee(t)},keyFor:function(t){if(!Ve(t))throw TypeError(t+" is not a symbol!");for(var e in Le)if(Le[e]===t)return e},useSetter:function(){De=!0},useSimple:function(){De=!1}}),it(it.S+it.F*!Ie,"Object",{create:function(t,e){return void 0===e?Ft(t):je(Ft(t),e)},defineProperty:He,defineProperties:je,getOwnPropertyDescriptor:Xe,getOwnPropertyNames:ze,getOwnPropertySymbols:Ke}),Re&&it(it.S+it.F*(!Ie||H(function(){var t=Ee();return"[null]"!=Ce([t])||"{}"!=Ce({a:t})||"{}"!=Ce(Object(t))})),"JSON",{stringify:function(t){for(var e,i,n=[t],r=1;arguments.length>r;)n.push(arguments[r++]);if(i=e=n[1],(W(e)||void 0!==t)&&!Ve(t))return de(e)||(e=function(t,e){if(i&&(e=i.call(this,t,e)),!Ve(e))return e}),n[1]=e,Ce.apply(Re,n)}}),Ee[Oe][Pe]||$(Ee[Oe],Pe,Ee[Oe].valueOf),Dt(Ee,"Symbol"),Dt(Math,"Math",!0),Dt(G.JSON,"JSON",!0),le("asyncIterator"),le("observable");var $e=D.Symbol,ti=e(function(t){t.exports={default:$e,__esModule:!0}});t(ti);var ei=e(function(t,e){function i(t){return t&&t.__esModule?t:{default:t}}e.__esModule=!0;var n=i(ae),r=i(ti),o="function"==typeof r.default&&"symbol"==typeof n.default?function(t){return typeof t}:function(t){return t&&"function"==typeof r.default&&t.constructor===r.default&&t!==r.default.prototype?"symbol":typeof t};e.default="function"==typeof r.default&&"symbol"===o(n.default)?function(t){return void 0===t?"undefined":o(t)}:function(t){return t&&"function"==typeof r.default&&t.constructor===r.default&&t!==r.default.prototype?"symbol":void 0===t?"undefined":o(t)}}),ii=t(ei),ni=t(e(function(t,e){e.__esModule=!0;var i=function(t){return t&&t.__esModule?t:{default:t}}(ei);e.default=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!==(void 0===e?"undefined":(0,i.default)(e))&&"function"!=typeof e?t:e}})),ri=function(t,e){if(V(t),!W(e)&&null!==e)throw TypeError(e+": can't set as prototype!")},oi={set:Object.setPrototypeOf||("__proto__"in{}?function(t,e,i){try{(i=Y(Function.call,be.f(Object.prototype,"__proto__").set,2))(t,[]),e=!(t instanceof Array)}catch(t){e=!0}return function(t,n){return ri(t,n),e?t.__proto__=n:i(t,n),t}}({},!1):void 0),check:ri};it(it.S,"Object",{setPrototypeOf:oi.set});var si=D.Object.setPrototypeOf,ai=e(function(t){t.exports={default:si,__esModule:!0}});t(ai),it(it.S,"Object",{create:Ft});var hi=D.Object,ui=function(t,e){return hi.create(t,e)},li=e(function(t){t.exports={default:ui,__esModule:!0}});t(li);var ci=t(e(function(t,e){function i(t){return t&&t.__esModule?t:{default:t}}e.__esModule=!0;var n=i(ai),r=i(li),o=i(ei);e.default=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+(void 0===e?"undefined":(0,o.default)(e)));t.prototype=(0,r.default)(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(n.default?(0,n.default)(t,e):t.__proto__=e)}})),fi=t(e(function(t,e){e.__esModule=!0,e.default=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}}));it(it.S+it.F*!j,"Object",{defineProperty:Q.f});var di=D.Object,vi=function(t,e,i){return di.defineProperty(t,e,i)},yi=e(function(t){t.exports={default:vi,__esModule:!0}});t(yi);var gi=t(e(function(t,e){e.__esModule=!0;var i=function(t){return t&&t.__esModule?t:{default:t}}(yi);e.default=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),(0,i.default)(t,r.key,r)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}()})),pi=function(){function t(e,i,n){fi(this,t),this.instruments=[],this.playing=[],this.handles=new Map;for(var r=0;r<n;r++)this.instruments.push(new i(e)),this.playing.push(!1);this.polyphony=n}return gi(t,[{key:"noteOn",value:function(t,e){for(var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.2,n=0;n<this.playing.length;n++)if(!this.playing[n])return this.instruments[n].noteOn(e,i),this.playing[n]=!0,void this.handles.set(t,n);console.warn("No keys available to play note.")}},{key:"noteOff",value:function(t){if(this.handles.has(t)){var e=this.handles.get(t);this.instruments[e].noteOff(),this.playing[e]=!1,this.handles.delete(t)}else console.warn("Note off on handle that does not exist.")}},{key:"allOff",value:function(){for(var t=0;t<this.instruments.length;t++)this.instruments[t].noteOff(),this.playing[t]=!1;this.handles.clear()}}]),t}(),_i=(function(){function t(){fi(this,t)}gi(t,[{key:"noteOn",value:function(t){}},{key:"noteOff",value:function(){}}])}(),function(){function t(e){fi(this,t),this.context=e,this.playing=!1,this.gainNode=this.context.createGain(),this.gainNode.gain.setValueAtTime(0,0),this.wire_()}return gi(t,[{key:"wire_",value:function(){this.gainNode.connect(this.context.destination)}},{key:"changeFrequency_",value:function(t){}},{key:"noteOn",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.2;this.playing=!0,this.attack_(e),this.decay_(e),this.changeFrequency_(t)}},{key:"noteOff",value:function(){this.playing=!1,this.release_()}},{key:"attack_",value:function(t){this.gainNode.gain.cancelScheduledValues(0),this.gainNode.gain.setValueAtTime(t,0)}},{key:"decay_",value:function(t){}},{key:"release_",value:function(){this.gainNode.gain.setValueAtTime(0,0)}}]),t}()),mi=function(t){function e(t,i){fi(this,e);var n=ni(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return n.oscillator=null,n.oscillatorType=i,n.initialize_(),n}return ci(e,_i),gi(e,[{key:"initialize_",value:function(){this.oscillator=this.context.createOscillator(),this.oscillator.type=this.oscillatorType,this.oscillator.connect(this.gainNode),this.oscillator.start(0);try{this.oscillator.noteOn(0)}catch(t){}}},{key:"changeFrequency_",value:function(t){this.oscillator.frequency.setValueAtTime(t,0)}}]),e}(),xi=(function(t){function e(t){return fi(this,e),ni(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,"sine"))}ci(e,mi)}(),function(t){function e(t){return fi(this,e),ni(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,"sawtooth"))}ci(e,mi)}(),function(t){function e(t,i){fi(this,e);var n=ni(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return n.oscillators=[],n.oscillatorTypes=i,n.initialize_(),n}return ci(e,_i),gi(e,[{key:"initialize_",value:function(){var t=!0,e=!1,i=void 0;try{for(var n,r=this.oscillatorTypes[Symbol.iterator]();!(t=(n=r.next()).done);t=!0){var o=n.value,s=this.context.createOscillator();s.type=o,s.connect(this.gainNode),s.start(0);try{s.noteOn(0)}catch(t){}this.oscillators.push(s)}}catch(t){e=!0,i=t}finally{try{!t&&r.return&&r.return()}finally{if(e)throw i}}}},{key:"changeFrequency_",value:function(t){var e=!0,i=!1,n=void 0;try{for(var r,o=this.oscillators[Symbol.iterator]();!(e=(r=o.next()).done);e=!0){r.value.frequency.setValueAtTime(t,0)}}catch(t){i=!0,n=t}finally{try{!e&&o.return&&o.return()}finally{if(i)throw n}}}}]),e}()),bi=(function(t){function e(t){return fi(this,e),ni(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,["sine"]))}ci(e,xi),gi(e,[{key:"decay_",value:function(t){this.gainNode.gain.linearRampToValueAtTime(0,this.context.currentTime+5)}}])}(),function(t){function e(t){return fi(this,e),ni(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,["sawtooth","sawtooth","sawtooth"]))}return ci(e,xi),gi(e,[{key:"changeFrequency_",value:function(t){for(var e=0;e<this.oscillators.length;e++){var i=.5*(e-1);this.oscillators[e].frequency.setValueAtTime(t+i,0)}}},{key:"wire_",value:function(){var t=this.context.createBiquadFilter();t.type="lowpass",t.frequency.setValueAtTime(800,0);var e=this.context.createDynamicsCompressor();e.threshold.setValueAtTime(0,0),e.knee.setValueAtTime(0,0),e.ratio.setValueAtTime(20,0),e.attack.setValueAtTime(.005,0),e.release.setValueAtTime(.05,0);var i=this.context.createGain();i.gain.setValueAtTime(.5,0),this.gainNode.connect(t),t.connect(i),i.connect(e),e.connect(this.context.destination)}},{key:"attack_",value:function(t){this.gainNode.gain.linearRampToValueAtTime(t,this.context.currentTime+.02)}},{key:"decay_",value:function(t){this.gainNode.gain.linearRampToValueAtTime(.8*t,this.context.currentTime+.1)}}]),e}()),ki=function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;if(fi(this,t),e.length<1)throw new Error(INVALID_NOTE);if(this.noteLetter=e.charAt(0).toUpperCase(),this.noteLetter.charCodeAt(0)<"A".charCodeAt(0)||this.noteLetter.charCodeAt(0)>"G".charCodeAt(0))throw new Error("Invalid note letter.");this.accidentals=0;var r=void 0;for(r=1;r<e.length;r++){var o=e.charAt(r);if("#"==o)this.accidentals++;else{if("b"!=o)break;this.accidentals--}}var s=e.substring(r);isNaN(s)&&(s=""+n),this.octave=parseInt(s);var a=this.noteLetter.charCodeAt(0)-"A".charCodeAt(0)-3;this.s2=i(-3*a,11),this.s3=i(2*a,7),this.s2-=11*this.accidentals,this.s3+=7*this.accidentals,this.s2+=this.octave,this.note=e}return gi(t,[{key:"wellTemperedFrequency",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:19,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:12,i=Math.pow(2,t/e);return 440*Math.pow(2,this.s2-2)*Math.pow(i,this.s3-1)}},{key:"twoThreeFrequency",value:function(){return 440*Math.pow(2,this.s2-2)*Math.pow(3,this.s3-1)}},{key:"jump",value:function(e){var i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return t.fromTwoThree(this.s2+e.s2*(i?-1:1),this.s3+e.s3*(i?-1:1))}},{key:"octaveShift",value:function(e){return t.fromTwoThree(this.s2+e,this.s3)}},{key:"baseShift",value:function(e){var i="A".charCodeAt(0),n="G".charCodeAt(0)-i+1,r=this.noteLetter.charCodeAt(0)+e-i,o=Math.floor(r/n);return new t(""+String.fromCharCode((r%n+n)%n+i)+(this.accidentals<0?"b".repeat(-this.accidentals):"#".repeat(this.accidentals))+(this.octave+o))}},{key:"accidentalShift",value:function(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=this.accidentals+e;return new t(null!=i&&Math.abs(n)>i?this.note:this.noteLetter+(n<0?"b".repeat(-n):"#".repeat(n))+this.octave)}},{key:"vexflowNoteName",value:function(){var t=this.noteLetter.toLowerCase(),e=this.noteLetter.charCodeAt(0)-"C".charCodeAt(0)>=0?1:0;return""+t+(this.accidentals>0?"#".repeat(this.accidentals):"b".repeat(-this.accidentals))+"/"+(this.octave+e)}}],[{key:"fromTwoThree",value:function(e,n){var r=i(-3*n,7),o=String.fromCharCode("A".charCodeAt(0)+r+3),s=function(t,e,i){return Math.round(t/e*i)}(1,7,n),a=e-(i(-3*r,11)-11*s);return new t(o+(s<0?"b".repeat(-s):"#".repeat(s))+a)}}]),t}(),wi="D0",Ti="D#0",Si="Eb0",Ei="E0",Ri="F0",Ci="F#0",Oi="G0",Ni="Ab1",Pi="A1",Ai="A#1",Li="Bb1",Mi="B1",Fi="Cb1",Bi="C1",Ii="C#1",Gi="C##1",Di=function(){function t(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"D0";fi(this,t);var n=new ki(e),r=new ki(i),o=ki.fromTwoThree(n.s2-r.s2,n.s3-r.s3);this.s2=o.s2,this.s3=o.s3}return gi(t,[{key:"jump",value:function(e){return new t(ki.fromTwoThree(this.s2+e.s2,this.s3+e.s3))}}],[{key:"P1",value:function(){return new t(wi)}},{key:"a1",value:function(){return new t(Ti)}},{key:"m2",value:function(){return new t(Si)}},{key:"M2",value:function(){return new t(Ei)}},{key:"m3",value:function(){return new t(Ri)}},{key:"M3",value:function(){return new t(Ci)}},{key:"P4",value:function(){return new t(Oi)}},{key:"d5",value:function(){return new t(Ni)}},{key:"P5",value:function(){return new t(Pi)}},{key:"a5",value:function(){return new t(Ai)}},{key:"m6",value:function(){return new t(Li)}},{key:"M6",value:function(){return new t(Mi)}},{key:"d7",value:function(){return new t(Fi)}},{key:"m7",value:function(){return new t(Bi)}},{key:"M7",value:function(){return new t(Ii)}},{key:"a7",value:function(){return new t(Gi)}}]),t}(),Yi=e(function(t){!function(e){function i(t,e,i,o){var s=e&&e.prototype instanceof r?e:r,a=Object.create(s.prototype),h=new f(o||[]);return a._invoke=function(t,e,i){var r=w;return function(o,s){if(r===S)throw new Error("Generator is already running");if(r===E){if("throw"===o)throw s;return v()}for(i.method=o,i.arg=s;;){var a=i.delegate;if(a){var h=u(a,i);if(h){if(h===R)continue;return h}}if("next"===i.method)i.sent=i._sent=i.arg;else if("throw"===i.method){if(r===w)throw r=E,i.arg;i.dispatchException(i.arg)}else"return"===i.method&&i.abrupt("return",i.arg);r=S;var l=n(t,e,i);if("normal"===l.type){if(r=i.done?E:T,l.arg===R)continue;return{value:l.arg,done:i.done}}"throw"===l.type&&(r=E,i.method="throw",i.arg=l.arg)}}}(t,i,h),a}function n(t,e,i){try{return{type:"normal",arg:t.call(e,i)}}catch(t){return{type:"throw",arg:t}}}function r(){}function o(){}function s(){}function a(t){["next","throw","return"].forEach(function(e){t[e]=function(t){return this._invoke(e,t)}})}function h(t){function e(i,r,o,s){var a=n(t[i],t,r);if("throw"!==a.type){var h=a.arg,u=h.value;return u&&"object"==typeof u&&p.call(u,"__await")?Promise.resolve(u.__await).then(function(t){e("next",t,o,s)},function(t){e("throw",t,o,s)}):Promise.resolve(u).then(function(t){h.value=t,o(h)},s)}s(a.arg)}var i;this._invoke=function(t,n){function r(){return new Promise(function(i,r){e(t,n,i,r)})}return i=i?i.then(r,r):r()}}function u(t,e){var i=t.iterator[e.method];if(i===y){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=y,u(t,e),"throw"===e.method))return R;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return R}var r=n(i,t.iterator,e.arg);if("throw"===r.type)return e.method="throw",e.arg=r.arg,e.delegate=null,R;var o=r.arg;return o?o.done?(e[t.resultName]=o.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=y),e.delegate=null,R):o:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,R)}function l(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function c(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function f(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(l,this),this.reset(!0)}function d(t){if(t){var e=t[m];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var i=-1,n=function e(){for(;++i<t.length;)if(p.call(t,i))return e.value=t[i],e.done=!1,e;return e.value=y,e.done=!0,e};return n.next=n}}return{next:v}}function v(){return{value:y,done:!0}}var y,g=Object.prototype,p=g.hasOwnProperty,_="function"==typeof Symbol?Symbol:{},m=_.iterator||"@@iterator",x=_.asyncIterator||"@@asyncIterator",b=_.toStringTag||"@@toStringTag",k=e.regeneratorRuntime;if(k)t.exports=k;else{(k=e.regeneratorRuntime=t.exports).wrap=i;var w="suspendedStart",T="suspendedYield",S="executing",E="completed",R={},C={};C[m]=function(){return this};var O=Object.getPrototypeOf,N=O&&O(O(d([])));N&&N!==g&&p.call(N,m)&&(C=N);var P=s.prototype=r.prototype=Object.create(C);o.prototype=P.constructor=s,s.constructor=o,s[b]=o.displayName="GeneratorFunction",k.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===o||"GeneratorFunction"===(e.displayName||e.name))},k.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,s):(t.__proto__=s,b in t||(t[b]="GeneratorFunction")),t.prototype=Object.create(P),t},k.awrap=function(t){return{__await:t}},a(h.prototype),h.prototype[x]=function(){return this},k.AsyncIterator=h,k.async=function(t,e,n,r){var o=new h(i(t,e,n,r));return k.isGeneratorFunction(e)?o:o.next().then(function(t){return t.done?t.value:o.next()})},a(P),P[b]="Generator",P[m]=function(){return this},P.toString=function(){return"[object Generator]"},k.keys=function(t){var e=[];for(var i in t)e.push(i);return e.reverse(),function i(){for(;e.length;){var n=e.pop();if(n in t)return i.value=n,i.done=!1,i}return i.done=!0,i}},k.values=d,f.prototype={constructor:f,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=y,this.done=!1,this.delegate=null,this.method="next",this.arg=y,this.tryEntries.forEach(c),!t)for(var e in this)"t"===e.charAt(0)&&p.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=y)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){function e(e,n){return o.type="throw",o.arg=t,i.next=e,n&&(i.method="next",i.arg=y),!!n}if(this.done)throw t;for(var i=this,n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n],o=r.completion;if("root"===r.tryLoc)return e("end");if(r.tryLoc<=this.prev){var s=p.call(r,"catchLoc"),a=p.call(r,"finallyLoc");if(s&&a){if(this.prev<r.catchLoc)return e(r.catchLoc,!0);if(this.prev<r.finallyLoc)return e(r.finallyLoc)}else if(s){if(this.prev<r.catchLoc)return e(r.catchLoc,!0)}else{if(!a)throw new Error("try statement without catch or finally");if(this.prev<r.finallyLoc)return e(r.finallyLoc)}}}},abrupt:function(t,e){for(var i=this.tryEntries.length-1;i>=0;--i){var n=this.tryEntries[i];if(n.tryLoc<=this.prev&&p.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var r=n;break}}r&&("break"===t||"continue"===t)&&r.tryLoc<=e&&e<=r.finallyLoc&&(r=null);var o=r?r.completion:{};return o.type=t,o.arg=e,r?(this.method="next",this.next=r.finallyLoc,R):this.complete(o)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),R},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var i=this.tryEntries[e];if(i.finallyLoc===t)return this.complete(i.completion,i.afterLoc),c(i),R}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var i=this.tryEntries[e];if(i.tryLoc===t){var n=i.completion;if("throw"===n.type){var r=n.arg;c(i)}return r}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,i){return this.delegate={iterator:d(t),resultName:e,nextLoc:i},"next"===this.method&&(this.arg=y),R}}}}(function(){return this}()||Function("return this")())}),Wi=function(){return this}()||Function("return this")(),Vi=Wi.regeneratorRuntime&&Object.getOwnPropertyNames(Wi).indexOf("regeneratorRuntime")>=0,Hi=Vi&&Wi.regeneratorRuntime;Wi.regeneratorRuntime=void 0;var ji=Yi;if(Vi)Wi.regeneratorRuntime=Hi;else try{delete Wi.regeneratorRuntime}catch(t){Wi.regeneratorRuntime=void 0}var Ui=ji,Xi=Bt("toStringTag"),zi="Arguments"==ht(function(){return arguments}()),Ki=function(t){var e,i,n;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(i=function(t,e){try{return t[e]}catch(t){}}(e=Object(t),Xi))?i:zi?ht(e):"Object"==(n=ht(e))&&"function"==typeof e.callee?"Arguments":n},qi=Bt("iterator"),Ji=D.isIterable=function(t){var e=Object(t);return void 0!==e[qi]||"@@iterator"in e||st.hasOwnProperty(Ki(e))},Qi=e(function(t){t.exports={default:Ji,__esModule:!0}});t(Qi);var Zi=Bt("iterator"),$i=D.getIteratorMethod=function(t){if(void 0!=t)return t[Zi]||t["@@iterator"]||st[Ki(t)]},tn=D.getIterator=function(t){var e=$i(t);if("function"!=typeof e)throw TypeError(t+" is not iterable!");return V(e.call(t))},en=e(function(t){t.exports={default:tn,__esModule:!0}});t(en);var nn=t(e(function(t,e){function i(t){return t&&t.__esModule?t:{default:t}}e.__esModule=!0;var n=i(Qi),r=i(en);e.default=function(){return function(t,e){if(Array.isArray(t))return t;if((0,n.default)(Object(t)))return function(t,e){var i=[],n=!0,o=!1,s=void 0;try{for(var a,h=(0,r.default)(t);!(n=(a=h.next()).done)&&(i.push(a.value),!e||i.length!==e);n=!0);}catch(t){o=!0,s=t}finally{try{!n&&h.return&&h.return()}finally{if(o)throw s}}return i}(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}()})),rn=function(){function t(e){fi(this,t),this.tempo=e}return gi(t,[{key:"getDuration",value:function(t){return t/this.tempo*60*1e3}},{key:"getBeats",value:function(t){return t/1e3/60*this.tempo}}]),t}(),on=function(){function t(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;fi(this,t),this.fn=e,this.beats=i,this.timer=null}return gi(t,[{key:"setTimeout",value:function(t){function e(e){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}(function(t){var e=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;clearTimeout(),this.timer=setTimeout(function(){e.fn(),clearTimeout(e.timer),null!=i&&e.setTimeout(i,i)},t)})},{key:"clearTimeout",value:function(t){function e(){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}(function(){null!=this.timer&&clearTimeout(this.timer),this.timer=null})}]),t}(),sn=function(){function t(e){var i=this;fi(this,t),this.timing=e,this.schedule=new ln,this.playing=!1,this.startTime=null,this.startOffset=0,this.beatOffset=0,this.timers=[],this.autoPauseTimer=new on(function(){i.pause(),i.beatOffset=0}),this.beatOffsetTimer=null,this.beatOffsetCallback=null}return gi(t,[{key:"add",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.schedule.addGroup(new ln(t,e))}},{key:"initialize",value:function(){this.clearTimers();var t=!0,e=!1,i=void 0;try{for(var n,r=this.schedule.iterate()[Symbol.iterator]();!(t=(n=r.next()).done);t=!0){var o=n.value,s=new on(o.fn,o.beats);this.timers.push(s)}}catch(t){e=!0,i=t}finally{try{!t&&r.return&&r.return()}finally{if(e)throw i}}}},{key:"play",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.playing=!0,this.startTime=Date.now(),this.startOffset=this.beatOffset;var e=0,i=!0,n=!1,r=void 0;try{for(var o,s=this.timers[Symbol.iterator]();!(i=(o=s.next()).done);i=!0){var a=o.value;if(!(a.beats<this.beatOffset)){var h=a.beats-this.beatOffset,u=this.timing.getDuration(h);u>e&&(e=u),a.setTimeout(u,null!=t?this.timing.getDuration(t):null)}}}catch(t){n=!0,r=t}finally{try{!i&&s.return&&s.return()}finally{if(n)throw r}}this.autoPauseTimer.setTimeout(e)}},{key:"updateBeatOffset",value:function(){if(this.playing){var t=Date.now()-this.startTime;this.beatOffset=this.timing.getBeats(t)+this.startOffset}}},{key:"pause",value:function(){this.updateBeatOffset(),this.playing=!1;var t=!0,e=!1,i=void 0;try{for(var n,r=this.timers[Symbol.iterator]();!(t=(n=r.next()).done);t=!0){n.value.clearTimeout()}}catch(t){e=!0,i=t}finally{try{!t&&r.return&&r.return()}finally{if(e)throw i}}this.autoPauseTimer.clearTimeout()}},{key:"clearTimers",value:function(){var t=!0,e=!1,i=void 0;try{for(var n,r=this.timers[Symbol.iterator]();!(t=(n=r.next()).done);t=!0){n.value.clearTimeout()}}catch(t){e=!0,i=t}finally{try{!t&&r.return&&r.return()}finally{if(e)throw i}}this.autoPauseTimer.clearTimeout(),this.timers.splice(0)}},{key:"clear",value:function(){this.clearTimers(),this.schedule=new ln,this.playing=!1,this.timers=[]}},{key:"setBeatOffset",value:function(t){var e=this.playing;this.playing&&this.pause(),this.beatOffset=t,null!=this.beatOffsetCallback&&this.beatOffsetCallback(this.beatOffset),e&&this.play()}},{key:"setBeatOffsetCallback",value:function(t){var e=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:50;this.beatOffsetCallback=t,this.beatOffsetTimer=new on(function(){e.updateBeatOffset(),e.playing&&e.beatOffsetCallback(e.beatOffset)},this.timing.getBeats(i)),this.beatOffsetTimer.setTimeout(i,i)}}]),t}(),an=function(){function t(){fi(this,t)}return gi(t,[{key:"shift",value:function(t){throw new Error("Not implemented.")}}]),t}(),hn=function(t){function e(t,i){fi(this,e);var n=ni(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return n.fn=t,n.beats=i,n}return ci(e,an),gi(e,[{key:"shift",value:function(t){return new e(this.fn,this.beats+t)}}]),e}(),un=function(t){function e(t,i,n){fi(this,e);var r=ni(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return r.note=t,r.start=i,r.end=n,r}return ci(e,an),gi(e,[{key:"toString",value:function(){var t=function(t){return parseFloat(t.toFixed(5)).toString()};return[this.note.note,t(this.start),t(this.end)].join(",")}},{key:"timeKey",value:function(){return this.start.toFixed(6)+","+this.end.toFixed(6)}},{key:"toGroup",value:function(t){var e=this,i=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.1,r=new ln;return r.addEvent(new hn(function(){return t.noteOn(e.note.name,e.note.wellTemperedFrequency())},i?0:this.start)),r.addEvent(new hn(function(){return t.noteOff(e.note.name)},this.end-n-(i?this.start:0))),r}},{key:"shift",value:function(t){return new e(this.note,this.start+t,this.end+t)}}],[{key:"fromString",value:function(t){var i=t.split(","),n=nn(i,3),r=n[0],o=n[1],s=n[2];return new e(new ki(r),parseFloat(o),parseFloat(s))}}]),e}(),ln=function(){function t(e){var i=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments[2];if(fi(this,t),this.events=[],this.subgroups=[],this.name=r,this.beatOffset=n,void 0!==e)if(e instanceof an)this.events.push(e);else if(e instanceof t)this.subgroups.push(e);else{if(!Array.isArray(e))throw new Error("Unrecognized constructor to group");e.forEach(function(e){if(e instanceof an)i.events.push(e);else{if(!(e instanceof t))throw new Error("Unrecognized constructor to group");i.subgroups.push(e)}})}}return gi(t,[{key:"addEvent",value:function(t){this.events.push(t)}},{key:"addGroup",value:function(t){this.subgroups.push(t)}},{key:"setOffset",value:function(t){this.beatOffset=t}},{key:"removeGroupByName",value:function(t){for(var e=0;e<this.subgroups.length;e++)this.subgroups[e].name==t&&this.subgroups.splice(e,1);var i=!0,n=!1,r=void 0;try{for(var o,s=this.subgroups[Symbol.iterator]();!(i=(o=s.next()).done);i=!0){o.value.removeGroupByName(t)}}catch(t){n=!0,r=t}finally{try{!i&&s.return&&s.return()}finally{if(n)throw r}}}},{key:"iterate",value:Ui.mark(function t(){var e,i,n,r,o,s,a,h,u,l,c,f,d,v,y,g,p,_,m=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return Ui.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:e=!0,i=!1,n=void 0,t.prev=3,r=this.events[Symbol.iterator]();case 5:if(e=(o=r.next()).done){t.next=12;break}return s=o.value,t.next=9,s.shift(m+this.beatOffset);case 9:e=!0,t.next=5;break;case 12:t.next=18;break;case 14:t.prev=14,t.t0=t.catch(3),i=!0,n=t.t0;case 18:t.prev=18,t.prev=19,!e&&r.return&&r.return();case 21:if(t.prev=21,!i){t.next=24;break}throw n;case 24:return t.finish(21);case 25:return t.finish(18);case 26:a=!0,h=!1,u=void 0,t.prev=29,l=this.subgroups[Symbol.iterator]();case 31:if(a=(c=l.next()).done){t.next=62;break}f=c.value,d=!0,v=!1,y=void 0,t.prev=36,g=f.iterate(m+this.beatOffset)[Symbol.iterator]();case 38:if(d=(p=g.next()).done){t.next=45;break}return _=p.value,t.next=42,_;case 42:d=!0,t.next=38;break;case 45:t.next=51;break;case 47:t.prev=47,t.t1=t.catch(36),v=!0,y=t.t1;case 51:t.prev=51,t.prev=52,!d&&g.return&&g.return();case 54:if(t.prev=54,!v){t.next=57;break}throw y;case 57:return t.finish(54);case 58:return t.finish(51);case 59:a=!0,t.next=31;break;case 62:t.next=68;break;case 64:t.prev=64,t.t2=t.catch(29),h=!0,u=t.t2;case 68:t.prev=68,t.prev=69,!a&&l.return&&l.return();case 71:if(t.prev=71,!h){t.next=74;break}throw u;case 74:return t.finish(71);case 75:return t.finish(68);case 76:case"end":return t.stop()}},t,this,[[3,14,18,26],[19,,21,25],[29,64,68,76],[36,47,51,59],[52,,54,58],[69,,71,75]])})},{key:"length",value:function(){var t=0,e=!0,i=!1,n=void 0;try{for(var r=this.iterate()[Symbol.iterator]();!(e=r.next().done);e=!0)t++}catch(t){i=!0,n=t}finally{try{!e&&r.return&&r.return()}finally{if(i)throw n}}return t}}]),t}(),cn=function(t){function e(){return fi(this,e),ni(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return ci(e,ln),gi(e,[{key:"iterateStrings",value:Ui.mark(function t(){var e,i,n,r,o,s;return Ui.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:e=!0,i=!1,n=void 0,t.prev=3,r=this.iterate()[Symbol.iterator]();case 5:if(e=(o=r.next()).done){t.next=12;break}return s=o.value,t.next=9,s.toString();case 9:e=!0,t.next=5;break;case 12:t.next=18;break;case 14:t.prev=14,t.t0=t.catch(3),i=!0,n=t.t0;case 18:t.prev=18,t.prev=19,!e&&r.return&&r.return();case 21:if(t.prev=21,!i){t.next=24;break}throw n;case 24:return t.finish(21);case 25:return t.finish(18);case 26:case"end":return t.stop()}},t,this,[[3,14,18,26],[19,,21,25]])})},{key:"serialize",value:function(){var t=[],e=!0,i=!1,n=void 0;try{for(var r,o=this.iterate()[Symbol.iterator]();!(e=(r=o.next()).done);e=!0){var s=r.value;t.push(s.toString())}}catch(t){i=!0,n=t}finally{try{!e&&o.return&&o.return()}finally{if(i)throw n}}return t.join("|")}},{key:"toPerformanceGroup",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.1,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.2,o=new ln,s=0;if(e){var a=null,h=!0,u=!1,l=void 0;try{for(var c,f=this.iterate()[Symbol.iterator]();!(h=(c=f.next()).done);h=!0){var d=c.value;(null==a||d.start<a)&&(a=d.start)}}catch(t){u=!0,l=t}finally{try{!h&&f.return&&f.return()}finally{if(u)throw l}}null!=a&&(s=a)}var v=function(e){var a=""+i+e.note.note;o.addEvent(new hn(function(){t.noteOn(a,e.note.wellTemperedFrequency(),r)},e.start-s)),o.addEvent(new hn(function(){t.noteOff(a)},e.end-n-s))},y=!0,g=!1,p=void 0;try{for(var _,m=this.iterate()[Symbol.iterator]();!(y=(_=m.next()).done);y=!0){v(_.value)}}catch(t){g=!0,p=t}finally{try{!y&&m.return&&m.return()}finally{if(g)throw p}}return o}}],[{key:"deserialize",value:function(t){return new e(t.split("|").map(function(t){return un.fromString(t)}))}}]),e}(),fn=/([a-gA-G]b*#*-?[0-9]*)(.*)/,dn=function(){function t(){var e=arguments;fi(this,t);for(var i=arguments.length,n=Array(i),r=0;r<i;r++)n[r]=e[r];this.intervals=n,this.length=n.length}return gi(t,[{key:"apply",value:function(t){var e=[],i=!0,n=!1,r=void 0;try{for(var o,s=this.intervals[Symbol.iterator]();!(i=(o=s.next()).done);i=!0){var a=o.value;e.push(t.jump(a))}}catch(t){n=!0,r=t}finally{try{!i&&s.return&&s.return()}finally{if(n)throw r}}return new(Function.prototype.bind.apply(vn,[null].concat(e)))}}]),t}(),vn=function(){function t(){var e=arguments;fi(this,t);for(var i=arguments.length,n=Array(i),r=0;r<i;r++)n[r]=e[r];this.notes=n}return gi(t,[{key:"getN",value:function(t){var e=(t%this.notes.length+this.notes.length)%this.notes.length,i=Math.floor(t/this.notes.length),n=[this.notes[e].s2,this.notes[e].s3],r=n[0],o=n[1];return ki.fromTwoThree(r+i,o)}}]),t}(),yn=function(){function t(e,i){fi(this,t),this.chordTemplate=e,this.suffix=i}return gi(t,[{key:"apply",value:function(t){var e=t.accidentals<0?"b".repeat(-t.accidentals):"#".repeat(t.accidentals);return new gn(this.chordTemplate.apply(t),""+t.noteLetter+e+this.suffix)}}]),t}(),gn=function t(e,i){fi(this,t),this.chord=e,this.name=i},pn=function(){function t(e,i,n){fi(this,t),this.interval=e,this.namedChordTemplate=i,this.scale=n}return gi(t,[{key:"apply",value:function(t){var e=t.jump(this.interval,!0);return new _n(this.namedChordTemplate.apply(t),this.scale.apply(e))}}]),t}(),_n=function t(e,i){fi(this,t),this.namedChord=e,this.scale=i},mn=function t(e,i){fi(this,t),this.contextualChord=e,this.noteGroup=i},xn=function(){function t(e){fi(this,t),this.chordDictionary=new Map;var i=!0,n=!1,r=void 0;try{for(var o,s=e[Symbol.iterator]();!(i=(o=s.next()).done);i=!0){var a=o.value;this.chordDictionary.set(a.suffix,a)}}catch(t){n=!0,r=t}finally{try{!i&&s.return&&s.return()}finally{if(n)throw r}}}return gi(t,[{key:"getChordTemplateBySuffix",value:function(t){return this.chordDictionary.get(t)}},{key:"getChordByName",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,i=fn.exec(t);if(3!=i.length)throw new Error("Invalid chord name.");var n=new ki(i[1],e),r=i[2],o=this.getChordTemplateBySuffix(r);if(null!=o)return o.apply(n)}}]),t}(),bn=new yn(new dn(Di.P1(),Di.M3(),Di.P5()),""),kn=new yn(new dn(Di.P1(),Di.m3(),Di.P5()),"m"),wn=new yn(new dn(Di.P1(),Di.M3(),Di.P5(),Di.m7()),"7"),Tn=new yn(new dn(Di.P1(),Di.m3(),Di.P5(),Di.m7()),"m7"),Sn=new yn(new dn(Di.P1(),Di.M3(),Di.P5(),Di.M7()),"maj7"),En=new yn(new dn(Di.P1(),Di.m3(),Di.d5()),"dim"),Rn=new yn(new dn(Di.P1(),Di.m3(),Di.d5(),Di.d7()),"dim7"),Cn=new yn(new dn(Di.P1(),Di.m3(),Di.d5(),Di.m7()),"m7b5"),On=new xn([bn,kn,wn,Tn,Sn,En,Rn,Cn,new yn(new dn(Di.P1(),Di.M3(),Di.a5()),"aug")]),Nn=new dn(Di.P1(),Di.M2(),Di.M3(),Di.P4(),Di.P5(),Di.M6(),Di.M7()),Pn=new dn(Di.P1(),Di.M2(),Di.m3(),Di.P4(),Di.P5(),Di.m6(),Di.m7()),An=new dn(Di.P1(),Di.M2(),Di.m3(),Di.P4(),Di.P5(),Di.m6(),Di.M7()),Ln=(new dn(Di.P1(),Di.M2(),Di.M3(),Di.P4(),Di.P5(),Di.M6(),Di.m7()),new dn(Di.P1(),Di.M2(),Di.M3(),Di.P4(),Di.P5(),Di.m6(),Di.m7())),Mn=(new pn(Di.P1(),bn,Nn),new pn(Di.P1(),Sn,Nn),new pn(Di.P4(),bn,Nn),new pn(Di.P4(),Sn,Nn),new pn(Di.P5(),bn,Nn),new pn(Di.P5(),wn,Nn),new pn(Di.M2(),kn,Nn),new pn(Di.M2(),Tn,Nn),new pn(Di.M6(),kn,Nn),new pn(Di.M6(),Tn,Nn),new pn(Di.M3(),kn,Nn),new pn(Di.M3(),Tn,Nn),new pn(Di.P1(),kn,Pn),new pn(Di.P1(),Tn,Pn),new pn(Di.P4(),kn,Pn),new pn(Di.P4(),Tn,Pn),new pn(Di.P5(),bn,An),new pn(Di.P5(),wn,An),new pn(Di.M2(),En,Pn),new pn(Di.M2(),Cn,Pn),new pn(Di.m6(),bn,Pn),new pn(Di.m6(),Sn,Pn),new pn(Di.m3(),bn,Pn),new pn(Di.m3(),Sn,Pn),[new pn(Di.P1(),kn,Pn),new pn(Di.P1(),Tn,Pn),new pn(Di.P1(),bn,Ln),new pn(Di.P1(),wn,Ln),new pn(Di.P4(),kn,Pn),new pn(Di.P4(),Tn,Pn),new pn(Di.P5(),bn,An),new pn(Di.P5(),wn,An),new pn(Di.P5(),kn,Pn),new pn(Di.P5(),Tn,Pn),new pn(Di.M2(),En,Pn),new pn(Di.M2(),Cn,Pn),new pn(Di.m6(),bn,Pn),new pn(Di.m6(),Sn,Pn),new pn(Di.m3(),bn,Pn),new pn(Di.m3(),Sn,Pn)]),Fn=[[1,1,1,1],[1,.5,.5,1,1],[1,1,1,.5,.5],[.5,.5,.5,.5,1,1],[1,1,.5,.5,.5,.5]],Bn={ON:{ON:["OFF","ON"],OFF:["OFF"],HOLD:[]},OFF:{ON:["ON"],OFF:[],HOLD:[]},HOLD:{ON:[],OFF:[],HOLD:[]}},In=function(){function t(e,i){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:.1,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:-2;fi(this,t),this.pattern=e,this.chord=i,this.beatsPerStep=n,this.offDelta=s,this.defaultOctaveShift=a,this.length=this.pattern[0][2].length,this.startOffset=r/this.beatsPerStep,this.cutOff=null===o?this.length:o/this.beatsPerStep}return gi(t,[{key:"toNoteGroup",value:function(){var t=this,e=new cn,i=new Map,n=function(n,r,o){for(var s=t.chord.getN(n).octaveShift(r+t.defaultOctaveShift),a=n+","+r,h=function(n,r){if("ON"==n){var o=new un(s,r*t.beatsPerStep,-1);i.set(a,o)}else{if("OFF"!=n)throw new Error("Unrecognized arpeggiation state.");if(i.has(a)){var h=i.get(a);h.end=r*t.beatsPerStep,e.addEvent(h),i.delete(a)}}},u="OFF",l=0,c=t.startOffset;c<t.cutOff;c++){var f=o[c%t.length].toUpperCase(),d=Bn[u][f];d.length>0&&(u=d[d.length-1]);var v=!0,y=!1,g=void 0;try{for(var p,_=d[Symbol.iterator]();!(v=(p=_.next()).done);v=!0){h(p.value,l)}}catch(t){y=!0,g=t}finally{try{!v&&_.return&&_.return()}finally{if(y)throw g}}l++}var m=Bn[u].OFF,x=!0,b=!1,k=void 0;try{for(var w,T=m[Symbol.iterator]();!(x=(w=T.next()).done);x=!0){h(w.value,l)}}catch(t){b=!0,k=t}finally{try{!x&&T.return&&T.return()}finally{if(b)throw k}}},r=!0,o=!1,s=void 0;try{for(var a,h=this.pattern[Symbol.iterator]();!(r=(a=h.next()).done);r=!0){var u=a.value,l=nn(u,3);n(l[0],l[1],l[2])}}catch(t){o=!0,s=t}finally{try{!r&&h.return&&h.return()}finally{if(o)throw s}}if(i.length>0)throw new Error("Some notes were not accounted for. This should never happen.");return e}}]),t}(),Gn="off",Dn="on",Yn="hold",Wn=[{name:"Waterfall",arpeggio:[[0,0,[Dn,Yn,Yn,Yn,Yn,Yn,Yn,Yn]],[1,0,[Gn,Dn,Gn,Dn,Gn,Gn,Gn,Dn]],[2,0,[Gn,Gn,Dn,Gn,Dn,Gn,Dn,Gn]],[3,0,[Gn,Gn,Gn,Gn,Gn,Dn,Gn,Gn]]],beatsPerStep:.5},{name:"Klez",arpeggio:[[0,-1,[Dn,Yn,Gn,Gn,Dn,Yn,Gn,Gn,Dn,Yn,Gn,Gn,Dn,Yn,Gn,Gn]],[0,0,[Gn,Gn,Dn,Dn,Gn,Gn,Dn,Yn,Gn,Gn,Dn,Yn,Gn,Gn,Dn,Yn]],[1,0,[Gn,Gn,Dn,Dn,Gn,Gn,Dn,Yn,Gn,Gn,Dn,Yn,Gn,Gn,Dn,Yn]],[2,0,[Gn,Gn,Dn,Dn,Gn,Gn,Dn,Yn,Gn,Gn,Dn,Yn,Gn,Gn,Dn,Yn]],[3,0,[Gn,Gn,Dn,Dn,Gn,Gn,Dn,Yn,Gn,Gn,Dn,Yn,Gn,Gn,Dn,Yn]]],beatsPerStep:.5},{name:"Persistence",arpeggio:[[0,-1,[Dn,Gn,Dn,Gn,Dn,Gn,Dn,Gn]],[0,0,[Dn,Gn,Dn,Gn,Dn,Gn,Dn,Gn]],[1,0,[Dn,Gn,Dn,Gn,Dn,Gn,Dn,Gn]],[2,0,[Dn,Gn,Dn,Gn,Dn,Gn,Dn,Gn]],[3,0,[Dn,Gn,Dn,Gn,Dn,Gn,Dn,Gn]]],beatsPerStep:.5},{name:"Twinkle",arpeggio:[[0,-1,[Dn,Yn,Yn,Yn,Yn,Yn,Yn,Yn]],[2,-1,[Dn,Gn,Dn,Gn,Dn,Gn,Dn,Gn]],[1,0,[Gn,Dn,Gn,Dn,Gn,Dn,Gn,Dn]],[0,1,[Dn,Yn,Yn,Yn,Yn,Yn,Yn,Yn]]],beatsPerStep:.5},{name:"Rapid",arpeggio:[[0,-1,[Dn,Yn,Yn,Yn,Dn,Yn,Yn,Yn]],[0,0,[Dn,Dn,Gn,Dn,Dn,Dn,Gn,Dn]],[1,0,[Dn,Gn,Dn,Gn,Dn,Gn,Dn,Gn]],[2,0,[Dn,Dn,Gn,Dn,Dn,Dn,Gn,Dn]],[3,0,[Dn,Gn,Dn,Gn,Dn,Gn,Dn,Gn]]],beatsPerStep:.5}];r(w.prototype,{destroy:g,get:function(t){return t?this._state[t]:this._state},fire:function(t,e){var i=t in this._handlers&&this._handlers[t].slice();if(i)for(var n=0;n<i.length;n+=1)i[n].call(this,e)},observe:function(t,e,i){var n=i&&i.defer?this._observers.post:this._observers.pre;return(n[t]||(n[t]=[])).push(e),i&&!1===i.init||(e.__calling=!0,e.call(this,this._state[t]),e.__calling=!1),{cancel:function(){var i=n[t].indexOf(e);~i&&n[t].splice(i,1)}}},on:function(t,e){if("teardown"===t)return this.on("destroy",e);var i=this._handlers[t]||(this._handlers[t]=[]);return i.push(e),{cancel:function(){var t=i.indexOf(e);~t&&i.splice(t,1)}}},set:function(t){this._set(r({},t)),this._root._lock||(this._root._lock=!0,m(this._root._beforecreate),m(this._root._oncreate),m(this._root._aftercreate),this._root._lock=!1)},teardown:g,_recompute:n,_set:function(t){var e=this._state,i={},n=!1;for(var o in t)p(t[o],e[o])&&(i[o]=n=!0);n&&(this._state=r({},e,t),this._recompute(i,this._state),this._bind&&this._bind(i,this._state),this._fragment&&(_(this,this._observers.pre,i,this._state,e),this._fragment.p(i,this._state),_(this,this._observers.post,i,this._state,e)))},_mount:function(t,e){this._fragment.m(t,e)},_unmount:function(){this._fragment.u()}});var Vn=function(t,e){var i=(D.Object||{})[t]||Object[t],n={};n[t]=e(i),it(it.S+it.F*H(function(){i(1)}),"Object",n)};Vn("getPrototypeOf",function(){return function(t){return jt(Wt(t))}});var Hn=D.Object.getPrototypeOf,jn=e(function(t){t.exports={default:Hn,__esModule:!0}});t(jn);var Un=be.f;Vn("getOwnPropertyDescriptor",function(){return function(t,e){return Un(lt(t),e)}});var Xn=D.Object,zn=function(t,e){return Xn.getOwnPropertyDescriptor(t,e)},Kn=e(function(t){t.exports={default:zn,__esModule:!0}});t(Kn);var qn=t(e(function(t,e){function i(t){return t&&t.__esModule?t:{default:t}}e.__esModule=!0;var n=i(jn),r=i(Kn);e.default=function t(e,i,o){null===e&&(e=Function.prototype);var s=(0,r.default)(e,i);if(void 0===s){var a=(0,n.default)(e);return null===a?void 0:t(a,i,o)}if("value"in s)return s.value;var h=s.get;if(void 0!==h)return h.call(o)}})),Jn=(function(){function t(e){fi(this,t),this.guesses=e,this.totalProb=0,this.mostLikely=null;var i=!0,n=!1,r=void 0;try{for(var o,s=this.guesses[Symbol.iterator]();!(i=(o=s.next()).done);i=!0){var a=o.value;this.totalProb+=a.likelihood,(null==this.mostLikely||a.likelihood>this.mostLikely.likelihood)&&(this.mostLikely=a)}}catch(t){n=!0,r=t}finally{try{!i&&s.return&&s.return()}finally{if(n)throw r}}}gi(t,[{key:"sample",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;null==t&&(t=random()),t*=this.totalProb;var e=!0,i=!1,n=void 0;try{for(var r,o=this.guesses[Symbol.iterator]();!(e=(r=o.next()).done);e=!0){var s=r.value;if(t<s.likelihood)return new Jn(this,s);t-=s.likelihood}}catch(t){i=!0,n=t}finally{try{!e&&o.return&&o.return()}finally{if(i)throw n}}throw new Error("This should never happen.")}}])}(),function(){function t(e,i){fi(this,t),this.guesses=e,this.guess=i,this.value=this.guess.value}return gi(t,null,[{key:"fixed",value:function(e){var i=new function t(e,i){fi(this,t),this.value=e,this.likelihood=i}(e,1);return new t([i],i)}}]),t}()),Qn=function(){function t(){fi(this,t),this.history=[],this.acceptIndex=0}return gi(t,[{key:"addToHistory_",value:function(t){return this.history.push(t),t}},{key:"clearSuggestion",value:function(){this.history.length=this.acceptIndex}},{key:"suggestInternal_",value:function(){throw new Error("Override")}},{key:"suggest",value:function(){return arguments.length>0&&void 0!==arguments[0]&&arguments[0]||this.clearSuggestion(),this.addToHistory_(this.suggestInternal_())}},{key:"accept",value:function(){this.acceptIndex=this.history.length}}]),t}(),Zn=function(t){function e(t,i){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;fi(this,e);var o=ni(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return o.baseNote=t,o.scale=i.apply(o.baseNote),o.minSuggest=n,o.maxSuggest=null!=r?r:i.length,o}return ci(e,Qn),gi(e,[{key:"setScale",value:function(t){this.scale=t}},{key:"suggestInternal_",value:function(){return Jn.fixed(this.scale.getN(function(t,e){var i=e-t;return Math.floor(Math.random()*i)+t}(this.minSuggest,this.maxSuggest)))}}]),e}(),$n=function(t){function e(t,i){fi(this,e);var n=ni(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return n.baseNote=t,n.contextualChords=i.map(function(t){return t.apply(n.baseNote.jump(t.interval))}),n}return ci(e,Qn),gi(e,[{key:"suggestInternal_",value:function(){return Jn.fixed(T(this.contextualChords))}}]),e}(),tr=function(t){function e(t){fi(this,e);var i=ni(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return i.rhythmTemplates=t,i}return ci(e,Qn),gi(e,[{key:"suggestInternal_",value:function(){return Jn.fixed(T(this.rhythmTemplates))}}]),e}(),er=function(t){function e(t,i,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;fi(this,e);var s=ni(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return s.chordSuggester=new $n(t,i),s.noteSuggester=new Zn(t,i[0].scale,r,o),s.rhythmSuggester=new tr(n),s.currentBeat=0,s.currentEndBeat=0,s}return ci(e,Qn),gi(e,[{key:"suggestInternal_",value:function(){var t=this.chordSuggester.suggest().value,e=this.rhythmSuggester.suggest().value;this.noteSuggester.clearSuggestion(),this.noteSuggester.setScale(t.scale);var i=new cn,n=this.currentBeat,r=!0,o=!1,s=void 0;try{for(var a,h=e[Symbol.iterator]();!(r=(a=h.next()).done);r=!0){var u=a.value;i.addEvent(new un(this.noteSuggester.suggest(!0).value,n,n+u)),n+=u}}catch(t){o=!0,s=t}finally{try{!r&&h.return&&h.return()}finally{if(o)throw s}}return this.currentEndBeat=n,Jn.fixed(new mn(t,i))}},{key:"accept",value:function(){qn(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"accept",this).call(this),this.chordSuggester.accept(),this.rhythmSuggester.accept(),this.noteSuggester.accept(),this.currentBeat=this.currentEndBeat}}]),e}(),ir=function(){function t(e,i,n){fi(this,t),this.target=e,this.eventType=i,this.fn=n}return gi(t,[{key:"add",value:function(){this.target.addEventListener(this.eventType,this.fn,!1)}},{key:"remove",value:function(){this.target.removeEventListener(this.eventType,this.fn,!1)}}]),t}(),nr=function(){function t(){fi(this,t),this.listeners=[]}return gi(t,[{key:"tearDown",value:function(){var t=!0,e=!1,i=void 0;try{for(var n,r=this.listeners[Symbol.iterator]();!(t=(n=r.next()).done);t=!0){n.value.remove()}}catch(t){e=!0,i=t}finally{try{!t&&r.return&&r.return()}finally{if(e)throw i}}this.listeners=[]}},{key:"registerListener",value:function(t,e,i){var n=new ir(t,e,i);this.listeners.push(n),n.add()}}]),t}(),rr=function(t){function e(t){fi(this,e);var i=ni(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return i.callback=t,i.audioContext=null,i.webAudioUnlocked=!1,i.htmlAudioUnlocked=!1,i.registerListener(document.body,"touchend",i.tap.bind(i)),i.registerListener(document.body,"click",i.tap.bind(i)),i.initialize(),i}return ci(e,nr),gi(e,[{key:"initialize",value:function(){try{"undefined"!=typeof AudioContext?this.audioContext=new AudioContext:"undefined"!=typeof webkitAudioContext&&(this.audioContext=new webkitAudioContext)}catch(t){}null!=this.audioContext?"suspended"!=this.audioContext.state&&(this.tearDown(),this.callback(this.audioContext)):alert("tapcompose is not compatible with your device because it lacksWebAudio support")}},{key:"tap",value:function(){var t=this;if(this.audioContext.resume(),!this.webAudioUnlocked)if("running"==this.audioContext.state)this.webAudioUnlocked=!0,this.verify();else{var e=this.audioContext.createBuffer(1,1,22050),i=this.audioContext.createBufferSource();i.buffer=e,i.connect(this.audioContext.destination),i.onended=function(){t.webAudioUnlocked=!0,t.verify()},i.start()}var n=document.createElement("audio");n.controls=!1,n.preload="auto",n.loop=!1,n.src="data:audio/mp3;base64,//MkxAAHiAICWABElBeKPL/RANb2w+yiT1g/gTok//lP/W/l3h8QO/OCdCqCW2Cw//MkxAQHkAIWUAhEmAQXWUOFW2dxPu//9mr60ElY5sseQ+xxesmHKtZr7bsqqX2L//MkxAgFwAYiQAhEAC2hq22d3///9FTV6tA36JdgBJoOGgc+7qvqej5Zu7/7uI9l//MkxBQHAAYi8AhEAO193vt9KGOq+6qcT7hhfN5FTInmwk8RkqKImTM55pRQHQSq//MkxBsGkgoIAABHhTACIJLf99nVI///yuW1uBqWfEu7CgNPWGpUadBmZ////4sL//MkxCMHMAH9iABEmAsKioqKigsLCwtVTEFNRTMuOTkuNVVVVVVVVVVVVVVVVVVV//MkxCkECAUYCAAAAFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV",n.onended=function(){t.htmlAudioUnlocked=!0,t.verify()},n.play()}},{key:"verify",value:function(){var t=this;this.audioContext.resume(),this.webAudioUnlocked&&this.htmlAudioUnlocked&&setTimeout(function(){"running"==t.audioContext.state&&t.run()},0)}},{key:"run",value:function(){this.tearDown(),this.callback(this.audioContext)}}]),e}(),or=function(){};or.L=function(t,e){if(e){var i=Array.prototype.slice.call(e).join(" ");window.console.log(t+": "+i)}},or.MakeException=function(t){return function(e){function i(e,n){fi(this,i);var r=ni(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,e));return r.name=t,r.message=e,r.data=n,r}return ci(i,e),i}(Error)};var sr=function(){function t(e,i){fi(this,t),this.code=e,this.message=i}return gi(t,[{key:"toString",value:function(){return"[RuntimeError] "+this.code+":"+this.message}}]),t}();or.RuntimeError=sr,or.RERR=or.RuntimeError,or.Merge=function(t,e){for(var i in e)t[i]=e[i];return t},or.Min=Math.min,or.Max=Math.max,or.forEach=function(t,e){for(var i=0;i<t.length;i++)e(t[i],i)},or.RoundN=function(t,e){return t%e>=e/2?parseInt(t/e,10)*e+e:parseInt(t/e,10)*e},or.MidLine=function(t,e){var i=e+(t-e)/2;return i%2>0&&(i=or.RoundN(10*i,5)/10),i},or.SortAndUnique=function(t,e,i){if(t.length>1){var n=[],r=void 0;t.sort(e);for(var o=0;o<t.length;++o)0!==o&&i(t[o],r)||n.push(t[o]),r=t[o];return n}return t},or.Contains=function(t,e){for(var i=t.length;i--;)if(t[i]===e)return!0;return!1},or.getCanvasContext=function(t){if(!t)throw new or.RERR("BadArgument","Invalid canvas selector: "+t);var e=document.getElementById(t);if(!e||!e.getContext)throw new or.RERR("UnsupportedBrowserError","This browser does not support HTML5 Canvas");return e.getContext("2d")},or.drawDot=function(t,e,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"#55";t.save(),t.setFillStyle(n),t.beginPath(),t.arc(e,i,3,0,2*Math.PI,!0),t.closePath(),t.fill(),t.restore()},or.BM=function(t,e){var i=(new Date).getTime();e();var n=(new Date).getTime()-i;or.L(t+n+"ms")},or.StackTrace=function(){return(new Error).stack},or.W=function(){for(var t=arguments,e=arguments.length,i=Array(e),n=0;n<e;n++)i[n]=t[n];var r=i.join(" ");window.console.log("Warning: ",r,or.StackTrace())},or.Prefix=function(t){return or.Prefix.prefix+t},or.Prefix.prefix="vf-";var ar=function(){function t(e,i){fi(this,t),this.set(e,i)}return gi(t,null,[{key:"GCD",value:function(t,e){if("number"!=typeof t||"number"!=typeof e)throw new or.RERR("BadArgument","Invalid numbers: "+t+", "+e);for(var i=void 0;0!==e;)i=e,e=t%e,t=i;return t}},{key:"LCM",value:function(e,i){return e*i/t.GCD(e,i)}},{key:"LCMM",value:function(e){if(0===e.length)return 0;if(1===e.length)return e[0];if(2===e.length)return t.LCM(e[0],e[1]);var i=e[0];return e.shift(),t.LCM(i,t.LCMM(e))}}]),gi(t,[{key:"set",value:function(t,e){return this.numerator=void 0===t?1:t,this.denominator=void 0===e?1:e,this}},{key:"value",value:function(){return this.numerator/this.denominator}},{key:"simplify",value:function(){var e=this.numerator,i=this.denominator,n=t.GCD(e,i);return e/=n,(i/=n)<0&&(i=-i,e=-e),this.set(e,i)}},{key:"add",value:function(e,i){var n=void 0,r=void 0;e instanceof t?(n=e.numerator,r=e.denominator):(n=void 0!==e?e:0,r=void 0!==i?i:1);var o=t.LCM(this.denominator,r),s=o/this.denominator,a=o/r,h=this.numerator*s+n*a;return this.set(h,o)}},{key:"subtract",value:function(e,i){var n=void 0,r=void 0;e instanceof t?(n=e.numerator,r=e.denominator):(n=void 0!==e?e:0,r=void 0!==i?i:1);var o=t.LCM(this.denominator,r),s=o/this.denominator,a=o/r,h=this.numerator*s-n*a;return this.set(h,o)}},{key:"multiply",value:function(e,i){var n=void 0,r=void 0;return e instanceof t?(n=e.numerator,r=e.denominator):(n=void 0!==e?e:1,r=void 0!==i?i:1),this.set(this.numerator*n,this.denominator*r)}},{key:"divide",value:function(e,i){var n=void 0,r=void 0;return e instanceof t?(n=e.numerator,r=e.denominator):(n=void 0!==e?e:1,r=void 0!==i?i:1),this.set(this.numerator*r,this.denominator*n)}},{key:"equals",value:function(e){var i=t.__compareA.copy(e).simplify(),n=t.__compareB.copy(this).simplify();return i.numerator===n.numerator&&i.denominator===n.denominator}},{key:"greaterThan",value:function(e){var i=t.__compareB.copy(this);return i.subtract(e),i.numerator>0}},{key:"greaterThanEquals",value:function(e){var i=t.__compareB.copy(this);return i.subtract(e),i.numerator>=0}},{key:"lessThan",value:function(t){return!this.greaterThanEquals(t)}},{key:"lessThanEquals",value:function(t){return!this.greaterThan(t)}},{key:"clone",value:function(){return new t(this.numerator,this.denominator)}},{key:"copy",value:function(t){return this.set(t.numerator,t.denominator)}},{key:"quotient",value:function(){return Math.floor(this.numerator/this.denominator)}},{key:"fraction",value:function(){return this.numerator%this.denominator}},{key:"abs",value:function(){return this.denominator=Math.abs(this.denominator),this.numerator=Math.abs(this.numerator),this}},{key:"toString",value:function(){return this.numerator+"/"+this.denominator}},{key:"toSimplifiedString",value:function(){return t.__tmp.copy(this).simplify().toString()}},{key:"toMixedString",value:function(){var e="",i=this.quotient(),n=t.__tmp.copy(this);return i<0?n.abs().fraction():n.fraction(),0!==i?(e+=i,0!==n.numerator&&(e+=" "+n.toSimplifiedString())):e=0===n.numerator?"0":n.toSimplifiedString(),e}},{key:"parse",value:function(t){var e=t.split("/"),i=parseInt(e[0],10),n=e[1]?parseInt(e[1],10):1;return this.set(i,n)}}]),t}();ar.__compareA=new ar,ar.__compareB=new ar,ar.__tmp=new ar;var hr=function(){function t(e,i,n,r){fi(this,t),this.x=e,this.y=i,this.w=n,this.h=r}return gi(t,null,[{key:"copy",value:function(e){return new t(e.x,e.y,e.w,e.h)}}]),gi(t,[{key:"getX",value:function(){return this.x}},{key:"getY",value:function(){return this.y}},{key:"getW",value:function(){return this.w}},{key:"getH",value:function(){return this.h}},{key:"setX",value:function(t){return this.x=t,this}},{key:"setY",value:function(t){return this.y=t,this}},{key:"setW",value:function(t){return this.w=t,this}},{key:"setH",value:function(t){return this.h=t,this}},{key:"move",value:function(t,e){this.x+=t,this.y+=e}},{key:"clone",value:function(){return t.copy(this)}},{key:"mergeWith",value:function(t,e){var i=t,n=this.x<i.x?this.x:i.x,r=this.y<i.y?this.y:i.y,o=Math.max(this.x+this.w,i.x+i.w)-n,s=Math.max(this.y+this.h,i.y+i.h)-r;return this.x=n,this.y=r,this.w=o,this.h=s,e&&this.draw(e),this}},{key:"draw",value:function(t,e,i){e||(e=0),i||(i=0),t.rect(this.x+e,this.y+i,this.w,this.h),t.stroke()}}]),t}(),ur=function(){function t(e,i,n,r){fi(this,t),this.x1=Number.NaN,this.y1=Number.NaN,this.x2=Number.NaN,this.y2=Number.NaN,this.addPoint(e,i),this.addPoint(n,r)}return gi(t,[{key:"width",value:function(){return this.x2-this.x1}},{key:"height",value:function(){return this.y2-this.y1}},{key:"addPoint",value:function(t,e){null!=t&&((isNaN(this.x1)||isNaN(this.x2))&&(this.x1=t,this.x2=t),t<this.x1&&(this.x1=t),t>this.x2&&(this.x2=t)),null!=e&&((isNaN(this.y1)||isNaN(this.y2))&&(this.y1=e,this.y2=e),e<this.y1&&(this.y1=e),e>this.y2&&(this.y2=e))}},{key:"addX",value:function(t){this.addPoint(t,null)}},{key:"addY",value:function(t){this.addPoint(null,t)}},{key:"addQuadraticCurve",value:function(t,e,i,n,r,o){var s=t+2/3*(i-t),a=e+2/3*(n-e),h=s+1/3*(r-t),u=a+1/3*(o-e);this.addBezierCurve(t,e,s,a,h,u,r,o)}},{key:"addBezierCurve",value:function(t,e,i,n,r,o,s,a){var h=[t,e],u=[i,n],l=[r,o],c=[s,a],f=void 0;this.addPoint(h[0],h[1]),this.addPoint(c[0],c[1]);var d=function(t,e){return Math.pow(1-t,3)*h[e]+3*Math.pow(1-t,2)*t*u[e]+3*(1-t)*Math.pow(t,2)*l[e]+Math.pow(t,3)*c[e]};for(f=0;f<=1;f++){var v=6*h[f]-12*u[f]+6*l[f],y=-3*h[f]+9*u[f]-9*l[f]+3*c[f],g=3*u[f]-3*h[f];if(0!==y){var p=Math.pow(v,2)-4*g*y;if(!(p<0)){var _=(-v+Math.sqrt(p))/(2*y);0<_&&_<1&&(0===f&&this.addX(d(_,f)),1===f&&this.addY(d(_,f)));var m=(-v-Math.sqrt(p))/(2*y);0<m&&m<1&&(0===f&&this.addX(d(m,f)),1===f&&this.addY(d(m,f)))}}else{if(0===v)continue;var x=-g/v;0<x&&x<1&&(0===f&&this.addX(d(x,f)),1===f&&this.addY(d(x,f)))}}}}]),t}(),lr=or.MakeException("RegistryError"),cr=function(){function t(){fi(this,t),this.clear()}return gi(t,null,[{key:"INDEXES",get:function(){return["type"]}}]),gi(t,[{key:"clear",value:function(){return this.index={id:{},type:{},class:{}},this}},{key:"updateIndex",value:function(t){var e=t.id,i=t.name,n=t.value,r=t.oldValue,o=this.getElementById(e);null!==r&&this.index[i][r]&&delete this.index[i][r][e],null!==n&&S(this.index,i,n,o.getAttribute("id"),o)}},{key:"register",value:function(e,i){var n=this;if(!(i=i||e.getAttribute("id")))throw new lr("Can't add element without `id` attribute to registry",e);return e.setAttribute("id",i),S(this.index,"id",i,i,e),t.INDEXES.forEach(function(t){n.updateIndex({id:i,name:t,value:e.getAttribute(t),oldValue:null})}),e.onRegister(this),this}},{key:"getElementById",value:function(t){return this.index.id[t]?this.index.id[t][t]:null}},{key:"getElementsByAttribute",value:function(t,e){var i=this.index[t];return i&&i[e]?Object.keys(i[e]).map(function(t){return i[e][t]}):[]}},{key:"getElementsByType",value:function(t){return this.getElementsByAttribute("type",t)}},{key:"getElementsByClass",value:function(t){return this.getElementsByAttribute("class",t)}},{key:"onUpdate",value:function(e){var i=e.id,n=e.name,r=e.value,o=e.oldValue;return function(t,e){return t.filter(function(t){return t===e}).length>0}(t.INDEXES.concat(["id","class"]),n)?(this.updateIndex({id:i,name:n,value:r,oldValue:o}),this):this}}],[{key:"enableDefaultRegistry",value:function(e){t.defaultRegistry=e}},{key:"getDefaultRegistry",value:function(){return t.defaultRegistry}},{key:"disableDefaultRegistry",value:function(){t.defaultRegistry=null}}]),t}();cr.defaultRegistry=null;var fr=function(){function t(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).type;fi(this,t),this.attrs={id:t.newID(),el:null,type:e||"Base",classes:{}},this.boundingBox=null,this.context=null,this.rendered=!1,cr.getDefaultRegistry()&&cr.getDefaultRegistry().register(this)}return gi(t,null,[{key:"newID",value:function(){return"auto"+t.ID++}}]),gi(t,[{key:"setStyle",value:function(t){return this.style=t,this}},{key:"getStyle",value:function(){return this.style}},{key:"applyStyle",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.context,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.getStyle();return e?(t.save(),e.shadowColor&&t.setShadowColor(e.shadowColor),e.shadowBlur&&t.setShadowBlur(e.shadowBlur),e.fillStyle&&t.setFillStyle(e.fillStyle),e.strokeStyle&&t.setStrokeStyle(e.strokeStyle),e.lineWidth&&t.setLineWidth(e.lineWidth),this):this}},{key:"restoreStyle",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.context;return(arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.getStyle())?(t.restore(),this):this}},{key:"hasClass",value:function(t){return!0===this.attrs.classes[t]}},{key:"addClass",value:function(t){return this.attrs.classes[t]=!0,this.registry&&this.registry.onUpdate({id:this.getAttribute("id"),name:"class",value:t,oldValue:null}),this}},{key:"removeClass",value:function(t){return delete this.attrs.classes[t],this.registry&&this.registry.onUpdate({id:this.getAttribute("id"),name:"class",value:null,oldValue:t}),this}},{key:"onRegister",value:function(t){return this.registry=t,this}},{key:"isRendered",value:function(){return this.rendered}},{key:"setRendered",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this.rendered=t,this}},{key:"getAttributes",value:function(){return this.attrs}},{key:"getAttribute",value:function(t){return this.attrs[t]}},{key:"setAttribute",value:function(t,e){var i=this.attrs.id,n=this.attrs[t];return this.attrs[t]=e,this.registry&&this.registry.onUpdate({id:i,name:t,value:e,oldValue:n}),this}},{key:"getContext",value:function(){return this.context}},{key:"setContext",value:function(t){return this.context=t,this}},{key:"getBoundingBox",value:function(){return this.boundingBox}},{key:"checkContext",value:function(){if(!this.context)throw new or.RERR("NoContext","No rendering context attached to instance");return this.context}}]),t}();fr.ID=1e3;var dr={glyphs:{v0:{x_min:0,x_max:514.5,ha:525,o:"m 236 648 b 246 648 238 648 242 648 b 288 646 261 648 283 648 b 472 513 364 634 428 587 b 514 347 502 464 514 413 b 462 163 514 272 499 217 b 257 44 409 83 333 44 b 50 163 181 44 103 83 b 0 347 14 217 0 272 b 40 513 0 413 12 464 b 236 648 87 591 155 638 m 277 614 b 253 616 273 616 261 616 b 242 616 247 616 243 616 b 170 499 193 609 181 589 b 159 348 163 446 159 398 b 166 222 159 308 161 266 b 201 91 174 138 183 106 b 257 76 215 81 235 76 b 311 91 277 76 299 81 b 347 222 330 106 338 138 b 353 348 352 266 353 308 b 344 499 353 398 351 446 b 277 614 333 587 322 606 m 257 -1 l 258 -1 l 255 -1 l 257 -1 m 257 673 l 258 673 l 255 673 l 257 673 "},v4:{x_min:0,x_max:468.21875,ha:478,o:"m 174 637 b 232 638 175 638 189 638 b 277 638 245 638 259 638 l 378 638 l 381 635 b 389 623 386 632 389 627 b 382 609 389 617 386 613 b 366 589 381 606 372 598 l 313 528 l 245 451 l 209 410 l 155 348 l 84 267 b 59 240 72 252 59 240 b 59 240 59 240 59 240 b 151 238 59 238 68 238 l 242 238 l 242 303 b 243 371 242 369 242 370 b 289 426 245 374 254 385 l 303 441 l 317 456 l 338 483 l 360 506 l 371 520 b 386 527 375 526 381 527 b 400 519 392 527 397 524 b 401 440 401 516 401 514 b 401 377 401 423 401 402 l 401 238 l 426 238 b 453 237 449 238 450 238 b 465 217 461 234 465 226 b 460 202 465 212 464 206 b 426 197 454 197 453 197 l 401 197 l 401 180 b 451 88 402 129 412 109 b 468 69 465 81 468 79 b 461 55 468 62 466 59 l 458 54 l 321 54 l 185 54 l 182 55 b 175 69 176 59 175 62 b 191 88 175 79 176 81 b 240 180 230 109 240 129 l 240 197 l 125 197 b 73 195 104 195 87 195 b 8 197 10 195 9 197 b 0 212 2 199 0 205 b 0 212 0 212 0 212 b 20 242 0 219 0 219 b 163 610 104 344 163 492 b 174 637 163 628 166 634 m 234 -1 l 235 -1 l 232 -1 l 234 -1 m 234 673 l 235 673 l 232 673 l 234 673 "},vb:{x_min:0,x_max:428.75,ha:438,o:"m 262 186 b 273 186 266 186 272 186 b 274 186 273 186 274 186 b 285 186 274 186 280 186 b 428 48 375 181 428 122 b 386 -68 428 12 416 -29 b 155 -187 329 -145 236 -187 b 12 -111 92 -187 38 -162 b 0 -51 4 -91 0 -72 b 262 186 0 58 122 179 "},v18:{x_min:0,x_max:323.9375,ha:331,o:"m 217 535 b 225 537 220 537 221 537 b 245 524 235 537 242 533 l 246 521 l 247 390 l 247 258 l 273 265 b 306 270 288 269 299 270 b 322 259 315 270 319 267 b 323 208 323 256 323 233 b 322 158 323 184 323 159 b 288 140 318 148 315 147 b 247 130 254 131 247 130 b 247 65 247 130 247 104 b 247 20 247 51 247 36 l 247 -88 l 273 -81 b 306 -76 289 -77 299 -76 b 318 -81 311 -76 315 -77 b 323 -123 323 -87 323 -86 l 323 -138 l 323 -154 b 318 -195 323 -191 323 -190 b 269 -210 314 -199 315 -199 b 249 -216 259 -213 250 -216 l 247 -216 l 247 -349 l 246 -483 l 245 -487 b 225 -499 242 -495 234 -499 b 206 -487 219 -499 210 -495 l 205 -483 l 205 -355 l 205 -227 l 204 -227 l 181 -233 l 138 -244 b 117 -249 127 -247 117 -249 b 115 -385 115 -249 115 -256 l 115 -523 l 114 -526 b 95 -538 110 -534 102 -538 b 74 -526 87 -538 78 -534 l 73 -523 l 73 -391 b 72 -260 73 -269 73 -260 b 72 -260 72 -260 72 -260 b 19 -273 61 -263 23 -273 b 0 -260 10 -273 4 -267 b 0 -209 0 -256 0 -256 l 0 -162 l 1 -158 b 61 -134 5 -148 5 -148 l 73 -131 l 73 -22 b 72 86 73 79 73 86 b 72 86 72 86 72 86 b 19 74 61 83 23 74 b 0 86 10 74 4 79 b 0 137 0 90 0 90 l 0 184 l 1 188 b 61 212 5 198 5 198 l 73 215 l 73 348 l 73 481 l 74 485 b 95 498 78 492 87 498 b 103 495 98 498 100 496 b 114 485 107 494 111 489 l 115 481 l 115 353 l 115 226 l 121 226 b 159 235 123 227 141 231 l 198 247 l 205 248 l 205 384 l 205 521 l 206 524 b 217 535 209 528 212 533 m 205 9 b 205 119 205 70 205 119 l 205 119 b 182 113 204 119 194 116 l 138 102 b 117 97 127 99 117 97 b 115 -12 115 97 115 91 l 115 -122 l 121 -120 b 159 -111 123 -119 141 -115 l 198 -101 l 205 -98 l 205 9 "},v26:{x_min:-21.78125,x_max:483.1875,ha:493,o:"m -8 631 b -1 632 -6 632 -4 632 b 19 620 8 632 16 628 b 20 383 20 616 20 616 l 20 148 l 21 151 b 140 199 59 183 102 199 b 206 179 164 199 187 192 l 210 176 l 210 396 l 210 617 l 212 621 b 231 632 216 628 223 632 b 250 620 239 632 247 628 b 251 383 251 616 251 616 l 251 148 l 254 151 b 370 199 291 183 332 199 b 415 191 385 199 400 197 b 483 84 458 176 483 134 b 461 0 483 58 476 29 b 332 -142 439 -40 411 -72 l 255 -215 b 231 -229 240 -229 239 -229 b 216 -223 224 -229 220 -227 b 210 -158 210 -217 210 -223 b 210 -120 210 -148 210 -136 l 210 -29 l 205 -34 b 100 -142 182 -65 159 -88 l 23 -215 b -1 -229 9 -229 6 -229 b -20 -216 -9 -229 -17 -224 l -21 -212 l -21 201 l -21 616 l -20 620 b -8 631 -17 624 -13 630 m 110 131 b 96 133 106 133 100 133 b 89 133 93 133 91 133 b 24 87 63 129 40 113 l 20 80 l 20 -37 l 20 -156 l 23 -152 b 144 81 96 -72 144 20 l 144 83 b 110 131 144 113 134 126 m 341 131 b 328 133 337 133 332 133 b 322 133 326 133 323 133 b 257 87 296 129 273 113 l 251 80 l 251 -37 l 251 -156 l 255 -152 b 375 81 328 -72 375 20 l 375 83 b 341 131 375 113 367 126 "},v44:{x_min:-21.78125,x_max:251.8125,ha:257,o:"m -8 631 b -1 632 -6 632 -4 632 b 19 620 8 632 16 628 b 20 383 20 616 20 616 l 20 148 l 21 151 b 137 199 59 183 99 199 b 182 191 152 199 167 197 b 251 84 227 176 251 134 b 228 0 251 58 243 29 b 100 -142 206 -40 178 -72 l 23 -215 b 0 -229 9 -229 6 -229 b -20 -216 -9 -229 -17 -224 l -21 -212 l -21 201 l -21 616 l -20 620 b -8 631 -17 624 -13 630 m 110 131 b 96 133 106 133 100 133 b 89 133 93 133 91 133 b 24 87 63 129 40 113 l 20 80 l 20 -37 l 20 -156 l 23 -152 b 144 81 96 -72 144 20 l 144 83 b 110 131 144 113 134 126 "},v4e:{x_min:0,x_max:239.5625,ha:244,o:"m 10 460 b 20 462 13 462 14 462 b 39 449 28 462 35 458 l 40 446 l 40 326 b 40 205 40 259 40 205 b 127 227 40 205 80 215 b 220 249 196 244 213 249 b 227 247 224 249 225 248 b 238 237 231 245 235 241 l 239 233 l 239 -106 l 239 -448 l 238 -451 b 219 -463 234 -459 225 -463 b 198 -451 210 -463 202 -459 l 197 -448 l 197 -324 b 197 -201 197 -248 197 -201 b 110 -223 196 -201 157 -210 b 17 -245 42 -240 24 -245 b 10 -242 13 -245 13 -244 b 0 -233 6 -241 2 -237 l 0 -230 l 0 108 l 0 446 l 0 449 b 10 460 2 453 6 458 m 197 22 b 197 70 197 41 197 58 b 196 116 197 113 197 116 l 196 116 b 118 97 196 116 160 106 l 40 77 l 40 -18 b 40 -112 40 -69 40 -112 l 119 -93 l 197 -73 l 197 22 "},v54:{x_min:-24.5,x_max:317.140625,ha:324,o:"m -24 -161 l -24 -5 l -20 -5 b 0 -24 -9 -5 -2 -12 b 171 -315 21 -124 84 -233 b 317 -660 268 -406 317 -531 b 187 -1014 317 -782 274 -909 b 161 -1034 172 -1034 171 -1034 b 141 -1013 149 -1034 141 -1025 b 152 -991 141 -1004 142 -1002 b 266 -682 228 -899 266 -788 b 174 -430 266 -588 236 -498 b -23 -317 136 -388 66 -348 b -24 -161 -23 -316 -24 -285 "},v7f:{x_min:0,x_max:367.5,ha:375,o:"m 0 124 l 0 187 l 61 187 l 122 187 l 122 138 l 122 91 l 153 61 l 183 30 l 213 61 l 243 91 l 243 138 l 243 187 l 306 187 l 367 187 l 367 124 l 367 61 l 321 61 l 274 61 l 243 30 l 213 0 l 243 -31 l 274 -62 l 321 -62 l 367 -62 l 367 -124 l 367 -188 l 306 -188 l 243 -188 l 243 -140 l 243 -93 l 213 -62 l 183 -31 l 153 -62 l 122 -93 l 122 -140 l 122 -188 l 61 -188 l 0 -188 l 0 -124 l 0 -62 l 46 -62 l 92 -62 l 123 -31 l 153 0 l 123 30 l 92 61 l 46 61 l 0 61 l 0 124 "},v81:{x_min:0,x_max:428.75,ha:438,o:"m 262 186 b 273 186 266 186 272 186 b 274 186 273 186 274 186 b 285 186 274 186 280 186 b 428 48 375 181 428 122 b 386 -68 428 12 416 -29 b 155 -187 329 -145 236 -187 b 12 -111 92 -187 38 -162 b 0 -51 4 -91 0 -72 b 262 186 0 58 122 179 m 366 131 b 352 134 362 133 357 134 b 219 81 321 134 269 115 b 47 -111 126 23 50 -62 b 47 -112 47 -111 47 -112 b 77 -136 47 -129 58 -136 b 264 -45 118 -136 194 -101 b 382 109 336 12 382 76 b 366 131 382 120 377 129 "},v83:{x_min:-1.359375,x_max:847.96875,ha:865,o:"m 488 1499 b 495 1500 490 1500 492 1500 b 541 1465 507 1500 521 1490 b 679 1078 622 1372 679 1210 b 677 1050 679 1068 677 1060 b 477 642 668 893 604 764 l 443 609 l 431 596 l 431 592 l 438 562 l 449 508 l 460 458 b 481 355 475 390 481 355 b 481 355 481 355 481 355 b 490 356 481 355 485 355 b 528 358 495 356 511 358 b 558 356 540 358 552 356 b 839 95 699 338 808 237 b 847 22 845 72 847 47 b 631 -303 847 -113 766 -242 b 620 -309 623 -308 620 -309 l 620 -310 b 631 -359 620 -310 626 -333 l 646 -435 l 660 -496 b 672 -588 668 -535 672 -563 b 664 -653 672 -610 669 -630 b 383 -875 630 -792 509 -875 b 201 -810 321 -875 257 -855 b 129 -680 151 -768 129 -730 b 274 -530 129 -592 200 -530 b 351 -553 300 -530 326 -538 b 412 -669 393 -582 412 -626 b 287 -805 412 -735 366 -800 l 279 -805 l 285 -809 b 383 -830 318 -823 351 -830 b 586 -718 464 -830 540 -789 b 626 -584 612 -678 626 -631 b 619 -528 626 -566 623 -548 b 612 -495 619 -526 616 -510 b 577 -324 590 -387 577 -324 b 577 -324 577 -324 577 -324 b 568 -326 575 -324 571 -324 b 528 -334 558 -328 537 -333 b 465 -338 506 -337 485 -338 b 24 -11 269 -338 87 -206 b -1 145 8 41 -1 93 b 96 442 -1 249 32 351 b 322 714 166 541 236 626 l 352 745 l 345 782 l 332 843 l 315 921 b 303 984 310 950 304 978 b 295 1082 298 1017 295 1049 b 413 1426 295 1208 336 1329 b 488 1499 436 1456 477 1496 m 549 1301 b 541 1301 547 1301 544 1301 b 411 1207 500 1301 447 1263 b 355 1004 374 1152 355 1079 b 359 942 355 984 356 963 b 371 881 362 927 363 917 l 385 818 b 392 782 389 799 392 784 l 392 782 b 434 828 393 782 424 816 b 607 1165 534 941 594 1060 b 608 1193 608 1175 608 1183 b 597 1270 608 1224 604 1254 b 549 1301 589 1286 571 1299 m 398 528 b 393 555 396 542 393 553 b 392 555 393 555 393 555 b 317 470 390 555 347 505 b 190 298 266 408 212 334 b 127 70 148 227 127 148 b 155 -77 127 19 137 -30 b 468 -303 209 -216 333 -303 b 519 -299 484 -303 502 -302 b 568 -284 541 -295 568 -287 l 568 -284 b 563 -263 568 -284 566 -274 l 534 -120 l 511 -13 l 496 61 l 480 133 b 469 187 472 176 469 187 b 468 188 469 187 469 188 b 416 162 462 188 430 172 b 337 13 364 126 337 69 b 413 -124 337 -40 363 -93 b 428 -144 424 -131 428 -137 b 428 -149 428 -145 428 -148 b 409 -166 426 -161 419 -166 b 394 -162 405 -166 400 -165 b 240 77 302 -122 240 -27 l 240 77 b 430 342 240 197 315 301 l 436 344 l 426 394 l 398 528 m 548 194 b 526 195 540 195 532 195 b 519 195 524 195 521 195 l 514 195 l 518 177 l 539 79 l 552 15 l 566 -48 l 594 -187 l 605 -240 b 612 -266 609 -254 611 -266 b 612 -266 612 -266 612 -266 b 641 -248 613 -266 630 -256 b 744 -98 692 -212 730 -156 b 751 -40 749 -79 751 -59 b 548 194 751 76 665 181 "},v9a:{x_min:-21.78125,x_max:367.5,ha:375,o:"m 230 1031 b 238 1032 232 1032 235 1032 b 259 1014 245 1032 251 1027 b 367 662 330 906 367 782 b 364 602 367 641 367 621 b 232 317 352 488 304 384 b 57 120 155 245 103 187 b -1 18 31 84 6 40 b -19 4 -4 11 -12 4 l -21 4 l -21 159 l -21 315 l -16 315 b 96 335 10 315 62 324 b 315 695 227 380 315 527 b 313 738 315 709 314 724 b 224 991 304 825 273 916 b 216 1013 219 999 216 1007 b 230 1031 216 1021 220 1028 "}},cssFontWeight:"normal",ascender:1903,underlinePosition:-125,cssFontStyle:"normal",boundingBox:{yMin:-2065.375,xMin:-695.53125,yMax:1901.578125,xMax:1159.671875},resolution:1e3,descender:-2066,familyName:"VexFlow-18",lineHeight:4093,underlineThickness:50},vr=function(t){function e(t,i,n){fi(this,e);var r=ni(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return r.setAttribute("type","Glyph"),r.code=t,r.point=i,r.options={cache:!0,font:dr},r.metrics=null,r.x_shift=0,r.y_shift=0,r.originShift={x:0,y:0},n?r.setOptions(n):r.reset(),r}return ci(e,fr),gi(e,null,[{key:"loadMetrics",value:function(t,e,i){var n=t.glyphs[e];if(!n)throw new or.RERR("BadGlyph","Glyph "+e+" does not exist in font.");var r=n.x_min,o=n.x_max,s=n.ha,a=void 0;if(n.o)return i?n.cached_outline?a=n.cached_outline:(a=n.o.split(" "),n.cached_outline=a):(n.cached_outline&&delete n.cached_outline,a=n.o.split(" ")),{x_min:r,x_max:o,ha:s,outline:a};throw new or.RERR("BadGlyph","Glyph "+e+" has no outline defined.")}},{key:"renderGlyph",value:function(t,i,n,r,o,s){var a=72*r/(100*dr.resolution),h=e.loadMetrics(dr,o,!s);e.renderOutline(t,h.outline,a,i,n)}},{key:"renderOutline",value:function(t,e,i,n,r){t.beginPath(),t.moveTo(n,r),E(e,n,r,i,-i,{m:t.moveTo.bind(t),l:t.lineTo.bind(t),q:t.quadraticCurveTo.bind(t),b:t.bezierCurveTo.bind(t)}),t.fill()}},{key:"getOutlineBoundingBox",value:function(t,e,i,n){var r=new ur;return E(t,i,n,e,-e,{m:r.addPoint.bind(r),l:r.addPoint.bind(r),q:r.addQuadraticCurve.bind(r),b:r.addBezierCurve.bind(r)}),new hr(r.x1,r.y1,r.width(),r.height())}}]),gi(e,[{key:"setOptions",value:function(t){or.Merge(this.options,t),this.reset()}},{key:"setPoint",value:function(t){return this.point=t,this}},{key:"setStave",value:function(t){return this.stave=t,this}},{key:"setXShift",value:function(t){return this.x_shift=t,this}},{key:"setYShift",value:function(t){return this.y_shift=t,this}},{key:"reset",value:function(){this.scale=72*this.point/(100*this.options.font.resolution),this.metrics=e.loadMetrics(this.options.font,this.code,this.options.cache),this.bbox=e.getOutlineBoundingBox(this.metrics.outline,this.scale,0,0)}},{key:"getMetrics",value:function(){if(!this.metrics)throw new or.RuntimeError("BadGlyph","Glyph "+this.code+" is not initialized.");return{x_min:this.metrics.x_min*this.scale,x_max:this.metrics.x_max*this.scale,width:this.bbox.getW(),height:this.bbox.getH()}}},{key:"setOriginX",value:function(t){var e=this.bbox,i=(t-Math.abs(e.getX()/e.getW()))*e.getW();this.originShift.x=-i}},{key:"setOriginY",value:function(t){var e=this.bbox,i=(t-Math.abs(e.getY()/e.getH()))*e.getH();this.originShift.y=-i}},{key:"setOrigin",value:function(t,e){this.setOriginX(t),this.setOriginY(e)}},{key:"render",value:function(t,i,n){if(!this.metrics)throw new or.RuntimeError("BadGlyph","Glyph "+this.code+" is not initialized.");var r=this.metrics.outline,o=this.scale;this.setRendered(),this.applyStyle(t),e.renderOutline(t,r,o,i+this.originShift.x,n+this.originShift.y),this.restoreStyle(t)}},{key:"renderToStave",value:function(t){if(this.checkContext(),!this.metrics)throw new or.RuntimeError("BadGlyph","Glyph "+this.code+" is not initialized.");if(!this.stave)throw new or.RuntimeError("GlyphError","No valid stave");var i=this.metrics.outline,n=this.scale;this.setRendered(),this.applyStyle(),e.renderOutline(this.context,i,n,t+this.x_shift,this.stave.getYForGlyphs()+this.y_shift),this.restoreStyle()}}]),e}(),yr={STEM_WIDTH:1.5,STEM_HEIGHT:35,STAVE_LINE_THICKNESS:1,RESOLUTION:16384,DEFAULT_NOTATION_FONT_SCALE:39,DEFAULT_TABLATURE_FONT_SCALE:39,SLASH_NOTEHEAD_WIDTH:15,TEXT_HEIGHT_OFFSET_HACK:1,IsKerned:!0};yr.clefProperties=function(t){if(!t)throw new or.RERR("BadArgument","Invalid clef: "+t);var e=yr.clefProperties.values[t];if(!e)throw new or.RERR("BadArgument","Invalid clef: "+t);return e},yr.clefProperties.values={treble:{line_shift:0},bass:{line_shift:6},tenor:{line_shift:4},alto:{line_shift:3},soprano:{line_shift:1},percussion:{line_shift:0},"mezzo-soprano":{line_shift:2},"baritone-c":{line_shift:5},"baritone-f":{line_shift:5},subbass:{line_shift:7},french:{line_shift:-1}},yr.keyProperties=function(t,e,i){void 0===e&&(e="treble");var n={octave_shift:0};"object"===(void 0===i?"undefined":ii(i))&&or.Merge(n,i);var r=t.split("/");if(r.length<2)throw new or.RERR("BadArguments","Key must have note + octave and an optional glyph: "+t);var o=r[0].toUpperCase(),s=yr.keyProperties.note_values[o];if(!s)throw new or.RERR("BadArguments","Invalid key name: "+o);s.octave&&(r[1]=s.octave);var a=parseInt(r[1],10),h=(7*(a+=-1*n.octave_shift)-28+s.index)/2,u=0;(h+=yr.clefProperties(e).line_shift)<=0&&2*h%2==0&&(u=1),h>=6&&2*h%2==0&&(u=-1);var l=void 0!==s.int_val?12*a+s.int_val:null,c=s.code,f=s.shift_right;if(r.length>2&&r[2]){var d=r[2].toUpperCase(),v=yr.keyProperties.note_glyph[d];v&&(c=v.code,f=v.shift_right)}return{key:o,octave:a,line:h,int_value:l,accidental:s.accidental,code:c,stroke:u,shift_right:f,displaced:!1}},yr.keyProperties.note_values={C:{index:0,int_val:0,accidental:null},CN:{index:0,int_val:0,accidental:"n"},"C#":{index:0,int_val:1,accidental:"#"},"C##":{index:0,int_val:2,accidental:"##"},CB:{index:0,int_val:-1,accidental:"b"},CBB:{index:0,int_val:-2,accidental:"bb"},D:{index:1,int_val:2,accidental:null},DN:{index:1,int_val:2,accidental:"n"},"D#":{index:1,int_val:3,accidental:"#"},"D##":{index:1,int_val:4,accidental:"##"},DB:{index:1,int_val:1,accidental:"b"},DBB:{index:1,int_val:0,accidental:"bb"},E:{index:2,int_val:4,accidental:null},EN:{index:2,int_val:4,accidental:"n"},"E#":{index:2,int_val:5,accidental:"#"},"E##":{index:2,int_val:6,accidental:"##"},EB:{index:2,int_val:3,accidental:"b"},EBB:{index:2,int_val:2,accidental:"bb"},F:{index:3,int_val:5,accidental:null},FN:{index:3,int_val:5,accidental:"n"},"F#":{index:3,int_val:6,accidental:"#"},"F##":{index:3,int_val:7,accidental:"##"},FB:{index:3,int_val:4,accidental:"b"},FBB:{index:3,int_val:3,accidental:"bb"},G:{index:4,int_val:7,accidental:null},GN:{index:4,int_val:7,accidental:"n"},"G#":{index:4,int_val:8,accidental:"#"},"G##":{index:4,int_val:9,accidental:"##"},GB:{index:4,int_val:6,accidental:"b"},GBB:{index:4,int_val:5,accidental:"bb"},A:{index:5,int_val:9,accidental:null},AN:{index:5,int_val:9,accidental:"n"},"A#":{index:5,int_val:10,accidental:"#"},"A##":{index:5,int_val:11,accidental:"##"},AB:{index:5,int_val:8,accidental:"b"},ABB:{index:5,int_val:7,accidental:"bb"},B:{index:6,int_val:11,accidental:null},BN:{index:6,int_val:11,accidental:"n"},"B#":{index:6,int_val:12,accidental:"#"},"B##":{index:6,int_val:13,accidental:"##"},BB:{index:6,int_val:10,accidental:"b"},BBB:{index:6,int_val:9,accidental:"bb"},R:{index:6,int_val:9,rest:!0},X:{index:6,accidental:"",octave:4,code:"v3e",shift_right:5.5}},yr.keyProperties.note_glyph={D0:{code:"v27",shift_right:-.5},D1:{code:"v2d",shift_right:-.5},D2:{code:"v22",shift_right:-.5},D3:{code:"v70",shift_right:-.5},T0:{code:"v49",shift_right:-2},T1:{code:"v93",shift_right:.5},T2:{code:"v40",shift_right:.5},T3:{code:"v7d",shift_right:.5},X0:{code:"v92",shift_right:-2},X1:{code:"v95",shift_right:-.5},X2:{code:"v7f",shift_right:.5},X3:{code:"v3b",shift_right:-2}},yr.integerToNote=function(t){if(void 0===t)throw new or.RERR("BadArguments","Undefined integer for integerToNote");if(t<-2)throw new or.RERR("BadArguments","integerToNote requires integer > -2: "+t);var e=yr.integerToNote.table[t];if(!e)throw new or.RERR("BadArguments","Unknown note value for integer: "+t);return e},yr.integerToNote.table={0:"C",1:"C#",2:"D",3:"D#",4:"E",5:"F",6:"F#",7:"G",8:"G#",9:"A",10:"A#",11:"B"},yr.tabToGlyph=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=null,n=0,r=0;if("X"===t.toString().toUpperCase()){var o=new vr("v7f",yr.DEFAULT_TABLATURE_FONT_SCALE).getMetrics();i="v7f",n=o.width,r=-o.height/2}else n=yr.textWidth(t.toString());return{text:t,code:i,getWidth:function(){return n*e},shift_y:r}},yr.textWidth=function(t){return 7*t.toString().length},yr.articulationCodes=function(t){return yr.articulationCodes.articulations[t]},yr.articulationCodes.articulations={"a.":{code:"v23",between_lines:!0},av:{code:"v28",between_lines:!0},"a>":{code:"v42",between_lines:!0},"a-":{code:"v25",between_lines:!0},"a^":{code:"va",between_lines:!1},"a+":{code:"v8b",between_lines:!1},ao:{code:"v94",between_lines:!1},ah:{code:"vb9",between_lines:!1},"a@a":{code:"v43",between_lines:!1},"a@u":{code:"v5b",between_lines:!1},"a|":{code:"v75",between_lines:!1},am:{code:"v97",between_lines:!1},"a,":{code:"vb3",between_lines:!1}},yr.accidentalCodes=function(t){return yr.accidentalCodes.accidentals[t]},yr.accidentalCodes.accidentals={"#":{code:"v18",parenRightPaddingAdjustment:-1},"##":{code:"v7f",parenRightPaddingAdjustment:-1},b:{code:"v44",parenRightPaddingAdjustment:-2},bb:{code:"v26",parenRightPaddingAdjustment:-2},n:{code:"v4e",parenRightPaddingAdjustment:-1},"{":{code:"v9c",parenRightPaddingAdjustment:-1},"}":{code:"v84",parenRightPaddingAdjustment:-1},db:{code:"v9e",parenRightPaddingAdjustment:-1},d:{code:"vab",parenRightPaddingAdjustment:0},bbs:{code:"v90",parenRightPaddingAdjustment:-1},"++":{code:"v51",parenRightPaddingAdjustment:-1},"+":{code:"v78",parenRightPaddingAdjustment:-1},"+-":{code:"v8d",parenRightPaddingAdjustment:-1},"++-":{code:"v7a",parenRightPaddingAdjustment:-1},bs:{code:"vb7",parenRightPaddingAdjustment:-1},bss:{code:"v39",parenRightPaddingAdjustment:-1},o:{code:"vd0",parenRightPaddingAdjustment:-1},k:{code:"vd1",parenRightPaddingAdjustment:-1}},yr.accidentalColumnsTable={1:{a:[1],b:[1]},2:{a:[1,2]},3:{a:[1,3,2],b:[1,2,1],second_on_bottom:[1,2,3]},4:{a:[1,3,4,2],b:[1,2,3,1],spaced_out_tetrachord:[1,2,1,2]},5:{a:[1,3,5,4,2],b:[1,2,4,3,1],spaced_out_pentachord:[1,2,3,2,1],very_spaced_out_pentachord:[1,2,1,2,1]},6:{a:[1,3,5,6,4,2],b:[1,2,4,5,3,1],spaced_out_hexachord:[1,3,2,1,3,2],very_spaced_out_hexachord:[1,2,1,2,1,2]}},yr.ornamentCodes=function(t){return yr.ornamentCodes.ornaments[t]},yr.ornamentCodes.ornaments={mordent:{code:"v1e"},mordent_inverted:{code:"v45"},turn:{code:"v72"},turn_inverted:{code:"v33"},tr:{code:"v1f"},upprall:{code:"v60"},downprall:{code:"vb4"},prallup:{code:"v6d"},pralldown:{code:"v2c"},upmordent:{code:"v29"},downmordent:{code:"v68"},lineprall:{code:"v20"},prallprall:{code:"v86"}},yr.keySignature=function(t){var e=yr.keySignature.keySpecs[t];if(!e)throw new or.RERR("BadKeySignature","Bad key signature spec: '"+t+"'");if(!e.acc)return[];for(var i=yr.keySignature.accidentalList(e.acc),n=[],r=0;r<e.num;++r){var o=i[r];n.push({type:e.acc,line:o})}return n},yr.keySignature.keySpecs={C:{acc:null,num:0},Am:{acc:null,num:0},F:{acc:"b",num:1},Dm:{acc:"b",num:1},Bb:{acc:"b",num:2},Gm:{acc:"b",num:2},Eb:{acc:"b",num:3},Cm:{acc:"b",num:3},Ab:{acc:"b",num:4},Fm:{acc:"b",num:4},Db:{acc:"b",num:5},Bbm:{acc:"b",num:5},Gb:{acc:"b",num:6},Ebm:{acc:"b",num:6},Cb:{acc:"b",num:7},Abm:{acc:"b",num:7},G:{acc:"#",num:1},Em:{acc:"#",num:1},D:{acc:"#",num:2},Bm:{acc:"#",num:2},A:{acc:"#",num:3},"F#m":{acc:"#",num:3},E:{acc:"#",num:4},"C#m":{acc:"#",num:4},B:{acc:"#",num:5},"G#m":{acc:"#",num:5},"F#":{acc:"#",num:6},"D#m":{acc:"#",num:6},"C#":{acc:"#",num:7},"A#m":{acc:"#",num:7}},yr.unicode={sharp:String.fromCharCode(parseInt("266F",16)),flat:String.fromCharCode(parseInt("266D",16)),natural:String.fromCharCode(parseInt("266E",16)),triangle:String.fromCharCode(parseInt("25B3",16)),"o-with-slash":String.fromCharCode(parseInt("00F8",16)),degrees:String.fromCharCode(parseInt("00B0",16)),circle:String.fromCharCode(parseInt("25CB",16))},yr.keySignature.accidentalList=function(t){return{b:[2,.5,2.5,1,3,1.5,3.5],"#":[0,1.5,-.5,1,2.5,.5,2]}[t]},yr.parseNoteDurationString=function(t){if("string"!=typeof t)return null;var e=/(\d*\/?\d+|[a-z])(d*)([nrhms]|$)/.exec(t);if(!e)return null;var i=e[1],n=e[2].length,r=e[3];return 0===r.length&&(r="n"),{duration:i,dots:n,type:r}},yr.parseNoteData=function(t){var e=t.duration,i=yr.parseNoteDurationString(e);if(!i)return null;var n=yr.durationToTicks(i.duration);if(null==n)return null;var r=t.type;if(r){if("n"!==r&&"r"!==r&&"h"!==r&&"m"!==r&&"s"!==r)return null}else(r=i.type)||(r="n");var o=t.dots?t.dots:i.dots;if("number"!=typeof o)return null;for(var s=n,a=0;a<o;a++){if(s<=1)return null;n+=s/=2}return{duration:i.duration,type:r,dots:o,ticks:n}},yr.sanitizeDuration=function(t){var e=yr.durationAliases[t];if(void 0!==e&&(t=e),void 0===yr.durationToTicks.durations[t])throw new or.RERR("BadArguments","The provided duration is not valid: "+t);return t},yr.durationToFraction=function(t){return(new ar).parse(yr.sanitizeDuration(t))},yr.durationToNumber=function(t){return yr.durationToFraction(t).value()},yr.durationToTicks=function(t){t=yr.sanitizeDuration(t);var e=yr.durationToTicks.durations[t];return void 0===e?null:e},yr.durationToTicks.durations={"1/2":2*yr.RESOLUTION,1:yr.RESOLUTION/1,2:yr.RESOLUTION/2,4:yr.RESOLUTION/4,8:yr.RESOLUTION/8,16:yr.RESOLUTION/16,32:yr.RESOLUTION/32,64:yr.RESOLUTION/64,128:yr.RESOLUTION/128,256:yr.RESOLUTION/256},yr.durationAliases={w:"1",h:"2",q:"4",b:"256"},yr.durationToGlyph=function(t,e){t=yr.sanitizeDuration(t);var i=yr.durationToGlyph.duration_codes[t];if(void 0===i)return null;e||(e="n");var n=i.type[e];return void 0===n?null:or.Merge(or.Merge({},i.common),n)},yr.durationToGlyph.duration_codes={"1/2":{common:{getWidth:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:yr.DEFAULT_NOTATION_FONT_SCALE;return new vr(this.code_head||"v53",t).getMetrics().width},stem:!1,stem_offset:0,flag:!1,stem_up_extension:-yr.STEM_HEIGHT,stem_down_extension:-yr.STEM_HEIGHT,gracenote_stem_up_extension:-yr.STEM_HEIGHT,gracenote_stem_down_extension:-yr.STEM_HEIGHT,tabnote_stem_up_extension:-yr.STEM_HEIGHT,tabnote_stem_down_extension:-yr.STEM_HEIGHT,dot_shiftY:0,line_above:0,line_below:0},type:{n:{code_head:"v53"},h:{code_head:"v59"},m:{code_head:"vf",stem_offset:0},r:{code_head:"v31",rest:!0,position:"B/5",dot_shiftY:.5},s:{getWidth:function(){return yr.SLASH_NOTEHEAD_WIDTH},position:"B/4"}}},1:{common:{getWidth:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:yr.DEFAULT_NOTATION_FONT_SCALE;return new vr(this.code_head||"v1d",t).getMetrics().width},stem:!1,stem_offset:0,flag:!1,stem_up_extension:-yr.STEM_HEIGHT,stem_down_extension:-yr.STEM_HEIGHT,gracenote_stem_up_extension:-yr.STEM_HEIGHT,gracenote_stem_down_extension:-yr.STEM_HEIGHT,tabnote_stem_up_extension:-yr.STEM_HEIGHT,tabnote_stem_down_extension:-yr.STEM_HEIGHT,dot_shiftY:0,line_above:0,line_below:0},type:{n:{code_head:"v1d"},h:{code_head:"v46"},m:{code_head:"v92",stem_offset:-3},r:{code_head:"v5c",rest:!0,position:"D/5",dot_shiftY:.5},s:{getWidth:function(){return yr.SLASH_NOTEHEAD_WIDTH},position:"B/4"}}},2:{common:{getWidth:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:yr.DEFAULT_NOTATION_FONT_SCALE;return new vr(this.code_head||"v81",t).getMetrics().width},stem:!0,stem_offset:0,flag:!1,stem_up_extension:0,stem_down_extension:0,gracenote_stem_up_extension:-14,gracenote_stem_down_extension:-14,tabnote_stem_up_extension:0,tabnote_stem_down_extension:0,dot_shiftY:0,line_above:0,line_below:0},type:{n:{code_head:"v81"},h:{code_head:"v2d"},m:{code_head:"v95",stem_offset:-3},r:{code_head:"vc",stem:!1,rest:!0,position:"B/4",dot_shiftY:-.5},s:{getWidth:function(){return yr.SLASH_NOTEHEAD_WIDTH},position:"B/4"}}},4:{common:{getWidth:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:yr.DEFAULT_NOTATION_FONT_SCALE;return new vr(this.code_head||"vb",t).getMetrics().width},stem:!0,stem_offset:0,flag:!1,stem_up_extension:0,stem_down_extension:0,gracenote_stem_up_extension:-14,gracenote_stem_down_extension:-14,tabnote_stem_up_extension:0,tabnote_stem_down_extension:0,dot_shiftY:0,line_above:0,line_below:0},type:{n:{code_head:"vb"},h:{code_head:"v22"},m:{code_head:"v3e",stem_offset:-3},r:{code_head:"v7c",stem:!1,rest:!0,position:"B/4",dot_shiftY:-.5,line_above:1.5,line_below:1.5},s:{getWidth:function(){return yr.SLASH_NOTEHEAD_WIDTH},position:"B/4"}}},8:{common:{getWidth:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:yr.DEFAULT_NOTATION_FONT_SCALE;return new vr(this.code_head||"vb",t).getMetrics().width},stem:!0,stem_offset:0,flag:!0,beam_count:1,code_flag_upstem:"v54",code_flag_downstem:"v9a",stem_up_extension:0,stem_down_extension:0,gracenote_stem_up_extension:-14,gracenote_stem_down_extension:-14,tabnote_stem_up_extension:0,tabnote_stem_down_extension:0,dot_shiftY:0,line_above:0,line_below:0},type:{n:{code_head:"vb"},h:{code_head:"v22"},m:{code_head:"v3e"},r:{code_head:"va5",stem:!1,flag:!1,rest:!0,position:"B/4",dot_shiftY:-.5,line_above:1,line_below:1},s:{getWidth:function(){return yr.SLASH_NOTEHEAD_WIDTH},position:"B/4"}}},16:{common:{beam_count:2,getWidth:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:yr.DEFAULT_NOTATION_FONT_SCALE;return new vr(this.code_head||"vb",t).getMetrics().width},stem:!0,stem_offset:0,flag:!0,code_flag_upstem:"v3f",code_flag_downstem:"v8f",stem_up_extension:0,stem_down_extension:0,gracenote_stem_up_extension:-14,gracenote_stem_down_extension:-14,tabnote_stem_up_extension:0,tabnote_stem_down_extension:0,dot_shiftY:0,line_above:0,line_below:0},type:{n:{code_head:"vb"},h:{code_head:"v22"},m:{code_head:"v3e"},r:{code_head:"v3c",stem:!1,flag:!1,rest:!0,position:"B/4",dot_shiftY:-.5,line_above:1,line_below:2},s:{getWidth:function(){return yr.SLASH_NOTEHEAD_WIDTH},position:"B/4"}}},32:{common:{beam_count:3,getWidth:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:yr.DEFAULT_NOTATION_FONT_SCALE;return new vr(this.code_head||"vb",t).getMetrics().width},stem:!0,stem_offset:0,flag:!0,code_flag_upstem:"v47",code_flag_downstem:"v2a",stem_up_extension:9,stem_down_extension:9,gracenote_stem_up_extension:-12,gracenote_stem_down_extension:-12,tabnote_stem_up_extension:8,tabnote_stem_down_extension:5,dot_shiftY:0,line_above:0,line_below:0},type:{n:{code_head:"vb"},h:{code_head:"v22"},m:{code_head:"v3e"},r:{code_head:"v55",stem:!1,flag:!1,rest:!0,position:"B/4",dot_shiftY:-1.5,line_above:2,line_below:2},s:{getWidth:function(){return yr.SLASH_NOTEHEAD_WIDTH},position:"B/4"}}},64:{common:{beam_count:4,getWidth:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:yr.DEFAULT_NOTATION_FONT_SCALE;return new vr(this.code_head||"vb",t).getMetrics().width},stem:!0,stem_offset:0,flag:!0,code_flag_upstem:"va9",code_flag_downstem:"v58",stem_up_extension:13,stem_down_extension:13,gracenote_stem_up_extension:-10,gracenote_stem_down_extension:-10,tabnote_stem_up_extension:12,tabnote_stem_down_extension:9,dot_shiftY:0,line_above:0,line_below:0},type:{n:{code_head:"vb"},h:{code_head:"v22"},m:{code_head:"v3e"},r:{code_head:"v38",stem:!1,flag:!1,rest:!0,position:"B/4",dot_shiftY:-1.5,line_above:2,line_below:3},s:{getWidth:function(){return yr.SLASH_NOTEHEAD_WIDTH},position:"B/4"}}},128:{common:{beam_count:5,getWidth:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:yr.DEFAULT_NOTATION_FONT_SCALE;return new vr(this.code_head||"vb",t).getMetrics().width},stem:!0,stem_offset:0,flag:!0,code_flag_upstem:"v9b",code_flag_downstem:"v30",stem_up_extension:22,stem_down_extension:22,gracenote_stem_up_extension:-8,gracenote_stem_down_extension:-8,tabnote_stem_up_extension:21,tabnote_stem_down_extension:18,dot_shiftY:0,line_above:0,line_below:0},type:{n:{code_head:"vb"},h:{code_head:"v22"},m:{code_head:"v3e"},r:{code_head:"vaa",stem:!1,flag:!1,rest:!0,position:"B/4",dot_shiftY:1.5,line_above:3,line_below:3},s:{getWidth:function(){return yr.SLASH_NOTEHEAD_WIDTH},position:"B/4"}}}},yr.TIME4_4={num_beats:4,beat_value:4,resolution:yr.RESOLUTION};var gr=function(t){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};fi(this,e);var i=ni(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return i.setAttribute("type","Stem"),i.x_begin=t.x_begin||0,i.x_end=t.x_end||0,i.y_top=t.y_top||0,i.y_bottom=t.y_bottom||0,i.stem_extension=t.stem_extension||0,i.stem_direction=t.stem_direction||0,i.hide=t.hide||!1,i.isStemlet=t.isStemlet||!1,i.stemletHeight=t.stemletHeight||0,i.renderHeightAdjustment=0,i}return ci(e,fr),gi(e,null,[{key:"CATEGORY",get:function(){return"stem"}},{key:"UP",get:function(){return 1}},{key:"DOWN",get:function(){return-1}},{key:"WIDTH",get:function(){return yr.STEM_WIDTH}},{key:"HEIGHT",get:function(){return yr.STEM_HEIGHT}}]),gi(e,[{key:"setNoteHeadXBounds",value:function(t,e){return this.x_begin=t,this.x_end=e,this}},{key:"setDirection",value:function(t){this.stem_direction=t}},{key:"setExtension",value:function(t){this.stem_extension=t}},{key:"getExtension",value:function(){return this.stem_extension}},{key:"setYBounds",value:function(t,e){this.y_top=t,this.y_bottom=e}},{key:"getCategory",value:function(){return e.CATEGORY}},{key:"getHeight",value:function(){return(this.y_bottom-this.y_top)*this.stem_direction+(e.HEIGHT+this.stem_extension)*this.stem_direction}},{key:"getBoundingBox",value:function(){throw new or.RERR("NotImplemented","getBoundingBox() not implemented.")}},{key:"getExtents",value:function(){var t=this.stem_direction===e.UP,i=[this.y_top,this.y_bottom],n=e.HEIGHT+this.stem_extension,r=(t?Math.min:Math.max).apply(void 0,i),o=(t?Math.max:Math.min).apply(void 0,i);return{topY:r+n*-this.stem_direction,baseY:o}}},{key:"setVisibility",value:function(t){return this.hide=!t,this}},{key:"setStemlet",value:function(t,e){return this.isStemlet=t,this.stemletHeight=e,this}},{key:"draw",value:function(){if(this.setRendered(),!this.hide){var t=this.checkContext(),i=void 0,n=void 0,r=this.stem_direction;r===e.DOWN?(i=this.x_begin,n=this.y_top):(i=this.x_end,n=this.y_bottom);var o=this.getHeight();!function(){for(var t=arguments,e=arguments.length,i=Array(e),n=0;n<e;n++)i[n]=t[n];gr.DEBUG&&or.L("Vex.Flow.Stem",i)}("Rendering stem - ","Top Y: ",this.y_top,"Bottom Y: ",this.y_bottom);var s=this.isStemlet?o-this.stemletHeight*this.stem_direction:0;t.save(),this.applyStyle(t),t.beginPath(),t.setLineWidth(e.WIDTH),t.moveTo(i,n-s),t.lineTo(i,n-o-this.renderHeightAdjustment*r),t.stroke(),t.restore()}}}]),e}(),pr=function(t){function e(){fi(this,e);var t=ni(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return t.setAttribute("type","Tickable"),t.ticks=new ar(0,1),t.intrinsicTicks=0,t.tickMultiplier=new ar(1,1),t.width=0,t.x_shift=0,t.voice=null,t.tickContext=null,t.modifierContext=null,t.modifiers=[],t.preFormatted=!1,t.postFormatted=!1,t.tuplet=null,t.tupletStack=[],t.align_center=!1,t.center_x_shift=0,t.ignore_ticks=!1,t.formatterMetrics={freedom:{left:0,right:0},duration:"",iterations:0,space:{used:0,mean:0,deviation:0}},t}return ci(e,fr),gi(e,[{key:"reset",value:function(){return this}},{key:"getTicks",value:function(){return this.ticks}},{key:"shouldIgnoreTicks",value:function(){return this.ignore_ticks}},{key:"getWidth",value:function(){return this.width}},{key:"getFormatterMetrics",value:function(){return this.formatterMetrics}},{key:"setXShift",value:function(t){this.x_shift=t}},{key:"getCenterXShift",value:function(){return this.isCenterAligned()?this.center_x_shift:0}},{key:"isCenterAligned",value:function(){return this.align_center}},{key:"setCenterAlignment",value:function(t){return this.align_center=t,this}},{key:"getVoice",value:function(){if(!this.voice)throw new or.RERR("NoVoice","Tickable has no voice.");return this.voice}},{key:"setVoice",value:function(t){this.voice=t}},{key:"getTuplet",value:function(){return this.tuplet}},{key:"resetTuplet",value:function(t){var e=void 0,i=void 0;if(t){var n=this.tupletStack.indexOf(t);return-1!==n&&(this.tupletStack.splice(n,1),e=t.getNoteCount(),i=t.getNotesOccupied(),this.applyTickMultiplier(e,i)),this}for(;this.tupletStack.length;)e=(t=this.tupletStack.pop()).getNoteCount(),i=t.getNotesOccupied(),this.applyTickMultiplier(e,i);return this}},{key:"setTuplet",value:function(t){if(t){this.tupletStack.push(t);var e=t.getNoteCount(),i=t.getNotesOccupied();this.applyTickMultiplier(i,e)}return this.tuplet=t,this}},{key:"addToModifierContext",value:function(t){this.modifierContext=t,this.preFormatted=!1}},{key:"addModifier",value:function(t){return this.modifiers.push(t),this.preFormatted=!1,this}},{key:"getModifiers",value:function(){return this.modifiers}},{key:"setTickContext",value:function(t){this.tickContext=t,this.preFormatted=!1}},{key:"preFormat",value:function(){this.preFormatted||(this.width=0,this.modifierContext&&(this.modifierContext.preFormat(),this.width+=this.modifierContext.getWidth()))}},{key:"postFormat",value:function(){return this.postFormatted?this:(this.postFormatted=!0,this)}},{key:"getIntrinsicTicks",value:function(){return this.intrinsicTicks}},{key:"setIntrinsicTicks",value:function(t){this.intrinsicTicks=t,this.ticks=this.tickMultiplier.clone().multiply(this.intrinsicTicks)}},{key:"getTickMultiplier",value:function(){return this.tickMultiplier}},{key:"applyTickMultiplier",value:function(t,e){this.tickMultiplier.multiply(t,e),this.ticks=this.tickMultiplier.clone().multiply(this.intrinsicTicks)}},{key:"setDuration",value:function(t){var e=t.numerator*(yr.RESOLUTION/t.denominator);this.ticks=this.tickMultiplier.clone().multiply(e),this.intrinsicTicks=this.ticks.value()}}]),e}(),_r=function(t){function e(t){fi(this,e);var i=ni(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));if(i.setAttribute("type","Note"),!t)throw new or.RuntimeError("BadArguments","Note must have valid initialization data to identify duration and type.");var n=yr.parseNoteData(t);if(!n)throw new or.RuntimeError("BadArguments","Invalid note initialization object: "+JSON.stringify(t));if(i.duration=n.duration,i.dots=n.dots,i.noteType=n.type,t.duration_override?i.setDuration(t.duration_override):i.setIntrinsicTicks(n.ticks),i.modifiers=[],i.glyph=yr.durationToGlyph(i.duration,i.noteType),i.positions&&("object"!==ii(i.positions)||!i.positions.length))throw new or.RuntimeError("BadArguments","Note keys must be array type.");return i.playNote=null,i.tickContext=null,i.modifierContext=null,i.ignore_ticks=!1,i.width=0,i.extraLeftPx=0,i.extraRightPx=0,i.x_shift=0,i.left_modPx=0,i.right_modPx=0,i.voice=null,i.preFormatted=!1,i.ys=[],t.align_center&&i.setCenterAlignment(t.align_center),i.stave=null,i.render_options={annotation_spacing:5,stave_padding:e.STAVEPADDING},i}return ci(e,pr),gi(e,null,[{key:"plotMetrics",value:function(t,e,i){function n(i,n,r){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:d;t.beginPath(),t.setStrokeStyle(r),t.setFillStyle(r),t.setLineWidth(3),t.moveTo(i+e.getXShift(),o),t.lineTo(n+e.getXShift(),o),t.stroke()}var r=e.getMetrics(),o=e.getAbsoluteX()-r.modLeftPx-r.extraLeftPx,s=e.getAbsoluteX()-r.extraLeftPx,a=e.getAbsoluteX(),h=e.getAbsoluteX()+r.noteWidth,u=e.getAbsoluteX()+r.noteWidth+r.extraRightPx,l=e.getAbsoluteX()+r.noteWidth+r.extraRightPx+r.modRightPx,c=l+e.getFormatterMetrics().freedom.right,f=l-o;t.save(),t.setFont("Arial",8,""),t.fillText(Math.round(f)+"px",o+e.getXShift(),i);var d=i+7;n(o,s,"red"),n(s,a,"#999"),n(a,h,"green"),n(h,u,"#999"),n(u,l,"red"),n(l,c,"#DD0"),n(o-e.getXShift(),o,"#BBB"),or.drawDot(t,a+e.getXShift(),d,"blue");var v=e.getFormatterMetrics();if(v.iterations>0){var y=v.space.deviation,g=y>=0?"+":"";t.setFillStyle("red"),t.fillText(g+Math.round(y),a+e.getXShift(),i-10)}t.restore()}},{key:"CATEGORY",get:function(){return"note"}},{key:"STAVEPADDING",get:function(){return 12}}]),gi(e,[{key:"getPlayNote",value:function(){return this.playNote}},{key:"setPlayNote",value:function(t){return this.playNote=t,this}},{key:"isRest",value:function(){return!1}},{key:"addStroke",value:function(t,e){return e.setNote(this),e.setIndex(t),this.modifiers.push(e),this.setPreFormatted(!1),this}},{key:"getStave",value:function(){return this.stave}},{key:"setStave",value:function(t){return this.stave=t,this.setYs([t.getYForLine(0)]),this.context=this.stave.context,this}},{key:"getCategory",value:function(){return e.CATEGORY}},{key:"setContext",value:function(t){return this.context=t,this}},{key:"getExtraLeftPx",value:function(){return this.extraLeftPx}},{key:"getExtraRightPx",value:function(){return this.extraRightPx}},{key:"setExtraLeftPx",value:function(t){return this.extraLeftPx=t,this}},{key:"setExtraRightPx",value:function(t){return this.extraRightPx=t,this}},{key:"shouldIgnoreTicks",value:function(){return this.ignore_ticks}},{key:"getLineNumber",value:function(){return 0}},{key:"getLineForRest",value:function(){return 0}},{key:"getGlyph",value:function(){return this.glyph}},{key:"getGlyphWidth",value:function(){return this.glyph.getWidth(this.render_options.glyph_font_scale)}},{key:"setYs",value:function(t){return this.ys=t,this}},{key:"getYs",value:function(){if(0===this.ys.length)throw new or.RERR("NoYValues","No Y-values calculated for this note.");return this.ys}},{key:"getYForTopText",value:function(t){if(!this.stave)throw new or.RERR("NoStave","No stave attached to this note.");return this.stave.getYForTopText(t)}},{key:"getBoundingBox",value:function(){return null}},{key:"getVoice",value:function(){if(!this.voice)throw new or.RERR("NoVoice","Note has no voice.");return this.voice}},{key:"setVoice",value:function(t){return this.voice=t,this.preFormatted=!1,this}},{key:"getTickContext",value:function(){return this.tickContext}},{key:"setTickContext",value:function(t){return this.tickContext=t,this.preFormatted=!1,this}},{key:"getDuration",value:function(){return this.duration}},{key:"isDotted",value:function(){return this.dots>0}},{key:"hasStem",value:function(){return!1}},{key:"getDots",value:function(){return this.dots}},{key:"getNoteType",value:function(){return this.noteType}},{key:"setBeam",value:function(){return this}},{key:"setModifierContext",value:function(t){return this.modifierContext=t,this}},{key:"addModifier",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return t.setNote(this),t.setIndex(e),this.modifiers.push(t),this.setPreFormatted(!1),this}},{key:"getModifierStartXY",value:function(){if(!this.preFormatted)throw new or.RERR("UnformattedNote","Can't call GetModifierStartXY on an unformatted note");return{x:this.getAbsoluteX(),y:this.ys[0]}}},{key:"getMetrics",value:function(){if(!this.preFormatted)throw new or.RERR("UnformattedNote","Can't call getMetrics on an unformatted note.");var t=0,e=0;null!=this.modifierContext&&(t=this.modifierContext.state.left_shift,e=this.modifierContext.state.right_shift);var i=this.getWidth();return{width:i,noteWidth:i-t-e-this.extraLeftPx-this.extraRightPx,left_shift:this.x_shift,modLeftPx:t,modRightPx:e,extraLeftPx:this.extraLeftPx,extraRightPx:this.extraRightPx}}},{key:"setWidth",value:function(t){this.width=t}},{key:"getWidth",value:function(){if(!this.preFormatted)throw new or.RERR("UnformattedNote","Can't call GetWidth on an unformatted note.");return this.width+(this.modifierContext?this.modifierContext.getWidth():0)}},{key:"setXShift",value:function(t){return this.x_shift=t,this}},{key:"getXShift",value:function(){return this.x_shift}},{key:"getX",value:function(){if(!this.tickContext)throw new or.RERR("NoTickContext","Note needs a TickContext assigned for an X-Value");return this.tickContext.getX()+this.x_shift}},{key:"getAbsoluteX",value:function(){if(!this.tickContext)throw new or.RERR("NoTickContext","Note needs a TickContext assigned for an X-Value");var t=this.tickContext.getX();return this.stave&&(t+=this.stave.getNoteStartX()+this.render_options.stave_padding),this.isCenterAligned()&&(t+=this.getCenterXShift()),t}},{key:"setPreFormatted",value:function(t){if(this.preFormatted=t,this.preFormatted){var e=this.tickContext.getExtraPx();this.left_modPx=Math.max(this.left_modPx,e.left),this.right_modPx=Math.max(this.right_modPx,e.right)}}}]),e}(),mr=function(t){function e(t){fi(this,e);var i=ni(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));if(i.setAttribute("type","NoteHead"),i.index=t.index,i.x=t.x||0,i.y=t.y||0,i.note_type=t.note_type,i.duration=t.duration,i.displaced=t.displaced||!1,i.stem_direction=t.stem_direction||wr.STEM_UP,i.line=t.line,i.glyph=yr.durationToGlyph(i.duration,i.note_type),!i.glyph)throw new or.RuntimeError("BadArguments","No glyph found for duration '"+i.duration+"' and type '"+i.note_type+"'");return i.glyph_code=i.glyph.code_head,i.x_shift=t.x_shift,t.custom_glyph_code&&(i.custom_glyph=!0,i.glyph_code=t.custom_glyph_code),i.style=t.style,i.slashed=t.slashed,or.Merge(i.render_options,{glyph_font_scale:t.glyph_font_scale||yr.DEFAULT_NOTATION_FONT_SCALE,stroke_px:3}),i.setWidth(i.glyph.getWidth(i.render_options.glyph_font_scale)),i}return ci(e,_r),gi(e,null,[{key:"CATEGORY",get:function(){return"notehead"}}]),gi(e,[{key:"getCategory",value:function(){return e.CATEGORY}},{key:"getWidth",value:function(){return this.width}},{key:"isDisplaced",value:function(){return!0===this.displaced}},{key:"getGlyph",value:function(){return this.glyph}},{key:"setX",value:function(t){return this.x=t,this}},{key:"getY",value:function(){return this.y}},{key:"setY",value:function(t){return this.y=t,this}},{key:"getLine",value:function(){return this.line}},{key:"setLine",value:function(t){return this.line=t,this}},{key:"getAbsoluteX",value:function(){var t=this.preFormatted?qn(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"getAbsoluteX",this).call(this):this.x,i=gr.WIDTH/2;return t+(this.displaced?(this.width-i)*this.stem_direction:0)}},{key:"getBoundingBox",value:function(){if(!this.preFormatted)throw new or.RERR("UnformattedNote","Can't call getBoundingBox on an unformatted note.");var t=this.stave.getSpacingBetweenLines(),e=t/2,i=this.y-e;return new yr.BoundingBox(this.getAbsoluteX(),i,this.width,t)}},{key:"setStave",value:function(t){var e=this.getLine();return this.stave=t,this.setY(t.getYForNote(e)),this.context=this.stave.context,this}},{key:"preFormat",value:function(){if(this.preFormatted)return this;var t=this.getWidth()+this.extraLeftPx+this.extraRightPx;return this.setWidth(t),this.setPreFormatted(!0),this}},{key:"draw",value:function(){this.checkContext(),this.setRendered();var t=this.context,e=this.getAbsoluteX(),i=this.y;!function(){for(var t=arguments,e=arguments.length,i=Array(e),n=0;n<e;n++)i[n]=t[n];mr.DEBUG&&or.L("Vex.Flow.NoteHead",i)}("Drawing note head '",this.note_type,this.duration,"' at",e,i);var n=this.stem_direction,r=this.render_options.glyph_font_scale;if(this.style&&this.applyStyle(t),"s"===this.note_type){var o=this.stave.getSpacingBetweenLines();!function(t,e,i,n,r,o){var s=yr.SLASH_NOTEHEAD_WIDTH;t.save(),t.setLineWidth(yr.STEM_WIDTH);var a=!1;if(yr.durationToNumber(e)>2&&(a=!0),a||(i-=yr.STEM_WIDTH/2*r),t.beginPath(),t.moveTo(i,n+o),t.lineTo(i,n+1),t.lineTo(i+s,n-o),t.lineTo(i+s,n),t.lineTo(i,n+o),t.closePath(),a?t.fill():t.stroke(),yr.durationToFraction(e).equals(.5))for(var h=[-3,-1,s+1,s+3],u=0;u<h.length;u++)t.beginPath(),t.moveTo(i+h[u],n-10),t.lineTo(i+h[u],n+11),t.stroke();t.restore()}(t,this.duration,e,i,n,o)}else vr.renderGlyph(t,e,i,r,this.glyph_code);this.style&&this.restoreStyle(t)}}]),e}(),xr=function(t){function e(t){fi(this,e);var i=ni(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return i.setAttribute("type","StemmableNote"),i.stem=null,i.stemExtensionOverride=null,i.beam=null,i}return ci(e,_r),gi(e,[{key:"getStem",value:function(){return this.stem}},{key:"setStem",value:function(t){return this.stem=t,this}},{key:"buildStem",value:function(){var t=new gr;return this.setStem(t),this}},{key:"buildFlag",value:function(){var t=this.glyph,e=null===this.beam;if(t&&t.flag&&e){var i=this.getStemDirection()===gr.DOWN?t.code_flag_downstem:t.code_flag_upstem;this.flag=new vr(i,this.render_options.glyph_font_scale)}}},{key:"getStemLength",value:function(){return gr.HEIGHT+this.getStemExtension()}},{key:"getBeamCount",value:function(){var t=this.getGlyph();return t?t.beam_count:0}},{key:"getStemMinumumLength",value:function(){var t=yr.durationToFraction(this.duration).value()<=1?0:20;switch(this.duration){case"8":null==this.beam&&(t=35);break;case"16":t=null==this.beam?35:25;break;case"32":t=null==this.beam?45:35;break;case"64":t=null==this.beam?50:40;break;case"128":t=null==this.beam?55:45}return t}},{key:"getStemDirection",value:function(){return this.stem_direction}},{key:"setStemDirection",value:function(t){if(t||(t=gr.UP),t!==gr.UP&&t!==gr.DOWN)throw new or.RERR("BadArgument","Invalid stem direction: "+t);return this.stem_direction=t,this.stem&&(this.stem.setDirection(t),this.stem.setExtension(this.getStemExtension())),this.reset(),this.flag&&this.buildFlag(),this.beam=null,this.preFormatted&&this.preFormat(),this}},{key:"getStemX",value:function(){var t=this.getAbsoluteX()+this.x_shift,e=this.getAbsoluteX()+this.x_shift+this.getGlyphWidth();return this.stem_direction===gr.DOWN?t:e}},{key:"getCenterGlyphX",value:function(){return this.getAbsoluteX()+this.x_shift+this.getGlyphWidth()/2}},{key:"getStemExtension",value:function(){var t=this.getGlyph();return null!=this.stemExtensionOverride?this.stemExtensionOverride:t?1===this.getStemDirection()?t.stem_up_extension:t.stem_down_extension:0}},{key:"setStemLength",value:function(t){return this.stemExtensionOverride=t-gr.HEIGHT,this}},{key:"getStemExtents",value:function(){return this.stem.getExtents()}},{key:"setBeam",value:function(t){return this.beam=t,this}},{key:"getYForTopText",value:function(t){var e=this.getStemExtents();return this.hasStem()?Math.min(this.stave.getYForTopText(t),e.topY-this.render_options.annotation_spacing*(t+1)):this.stave.getYForTopText(t)}},{key:"getYForBottomText",value:function(t){var e=this.getStemExtents();return this.hasStem()?Math.max(this.stave.getYForTopText(t),e.baseY+this.render_options.annotation_spacing*t):this.stave.getYForBottomText(t)}},{key:"hasFlag",value:function(){return yr.durationToGlyph(this.duration).flag&&!this.beam}},{key:"postFormat",value:function(){return this.beam&&this.beam.postFormat(),this.postFormatted=!0,this}},{key:"drawStem",value:function(t){this.checkContext(),this.setRendered(),this.setStem(new gr(t)),this.stem.setContext(this.context).draw()}}]),e}(),br=function(t){function e(){fi(this,e);var t=ni(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return t.setAttribute("type","Modifier"),t.width=0,t.note=null,t.index=null,t.text_line=0,t.position=e.Position.LEFT,t.modifier_context=null,t.x_shift=0,t.y_shift=0,t.spacingFromNextModifier=0,t}return ci(e,fr),gi(e,null,[{key:"CATEGORY",get:function(){return"none"}},{key:"Position",get:function(){return{LEFT:1,RIGHT:2,ABOVE:3,BELOW:4}}},{key:"PositionString",get:function(){return{above:e.Position.ABOVE,below:e.Position.BELOW,left:e.Position.LEFT,right:e.Position.RIGHT}}}]),gi(e,[{key:"getCategory",value:function(){return e.CATEGORY}},{key:"getWidth",value:function(){return this.width}},{key:"setWidth",value:function(t){return this.width=t,this}},{key:"getNote",value:function(){return this.note}},{key:"setNote",value:function(t){return this.note=t,this}},{key:"getIndex",value:function(){return this.index}},{key:"setIndex",value:function(t){return this.index=t,this}},{key:"getModifierContext",value:function(){return this.modifier_context}},{key:"setModifierContext",value:function(t){return this.modifier_context=t,this}},{key:"getPosition",value:function(){return this.position}},{key:"setPosition",value:function(t){return this.position="string"==typeof t?e.PositionString[t]:t,this}},{key:"setTextLine",value:function(t){return this.text_line=t,this}},{key:"setYShift",value:function(t){return this.y_shift=t,this}},{key:"setSpacingFromNextModifier",value:function(t){this.spacingFromNextModifier=t}},{key:"getSpacingFromNextModifier",value:function(){return this.spacingFromNextModifier}},{key:"setXShift",value:function(t){this.x_shift=0,this.position===e.Position.LEFT?this.x_shift-=t:this.x_shift+=t}},{key:"getXShift",value:function(){return this.x_shift}},{key:"draw",value:function(){throw this.checkContext(),new or.RERR("MethodNotImplemented","draw() not implemented for this modifier.")}}]),e}(),kr=function(t){function e(){fi(this,e);var t=ni(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return t.setAttribute("type","Dot"),t.note=null,t.index=null,t.position=br.Position.RIGHT,t.radius=2,t.setWidth(5),t.dot_shiftY=0,t}return ci(e,br),gi(e,null,[{key:"format",value:function(t,e){var i=e.right_shift;if(!t||0===t.length)return!1;for(var n=[],r=0;r<t.length;++r){var o=t[r],s=o.getNote(),a=void 0,h=void 0;"function"==typeof s.getKeyProps?h=(a=s.getKeyProps()[o.getIndex()]).displaced?s.getExtraRightPx():0:(a={line:.5},h=0),n.push({line:a.line,shift:h,note:s,dot:o})}n.sort(function(t,e){return e.line-t.line});for(var u=i,l=0,c=null,f=null,d=null,v=0,y=0;y<n.length;++y){var g=n[y],p=g.dot,_=g.note,m=g.shift,x=g.line;x===c&&_===f||(u=m),_.isRest()||x===c||(.5===Math.abs(x%1)?v=0:_.isRest()||(v=.5,null==f||f.isRest()||c-x!=.5?x+v===d&&(v=-.5):v=-.5)),p.dot_shiftY=-v,d=x+v,p.setXShift(u),l=(u+=p.getWidth()+1)>l?u:l,c=x,f=_}return e.right_shift+=l,!0}},{key:"CATEGORY",get:function(){return"dots"}}]),gi(e,[{key:"getCategory",value:function(){return e.CATEGORY}},{key:"setNote",value:function(t){this.note=t,"gracenotes"===this.note.getCategory()&&(this.radius*=.5,this.setWidth(3))}},{key:"setDotShiftY",value:function(t){return this.dot_shiftY=t,this}},{key:"draw",value:function(){if(this.checkContext(),this.setRendered(),!this.note||null===this.index)throw new or.RERR("NoAttachedNote","Can't draw dot without a note and index.");var t=this.note.stave.options.spacing_between_lines_px,e=this.note.getModifierStartXY(this.position,this.index);"tabnotes"===this.note.getCategory()&&(e.y=this.note.getStemExtents().baseY);var i=e.x+this.x_shift+this.width-this.radius,n=e.y+this.y_shift+this.dot_shiftY*t,r=this.context;r.beginPath(),r.arc(i,n,this.radius,0,2*Math.PI,!1),r.fill()}}]),e}(),wr=function(t){function e(t){fi(this,e);var i=ni(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));if(i.setAttribute("type","StaveNote"),i.keys=t.keys,i.clef=t.clef,i.octave_shift=t.octave_shift,i.beam=null,i.glyph=yr.durationToGlyph(i.duration,i.noteType),!i.glyph)throw new or.RuntimeError("BadArguments","Invalid note initialization data (No glyph found): "+JSON.stringify(t));return i.displaced=!1,i.dot_shiftY=0,i.keyProps=[],i.use_default_head_x=!1,i.note_heads=[],i.modifiers=[],or.Merge(i.render_options,{glyph_font_scale:t.glyph_font_scale||yr.DEFAULT_NOTATION_FONT_SCALE,stroke_px:t.stroke_px||e.DEFAULT_LEDGER_LINE_OFFSET}),i.calculateKeyProps(),i.buildStem(),t.auto_stem?i.autoStem():i.setStemDirection(t.stem_direction),i.reset(),i.buildFlag(),i}return ci(e,xr),gi(e,null,[{key:"format",value:function(t,i){if(!t||t.length<2)return!1;if(t[0].getStave())return e.formatByY(t,i);for(var n=[],r=0;r<t.length;r++){var o=t[r].getKeyProps(),s=o[0].line,a=o[o.length-1].line,h=t[r].getStemDirection(),u=t[r].getStemLength()/10,l=t[r].getStemMinumumLength()/10,c=void 0;t[r].isRest()?(c=s+t[r].glyph.line_above,a=s-t[r].glyph.line_below):(c=1===h?o[o.length-1].line+u:o[o.length-1].line,a=1===h?o[0].line:o[0].line-u),n.push({line:o[0].line,maxLine:c,minLine:a,isrest:t[r].isRest(),stemDirection:h,stemMax:u,stemMin:l,voice_shift:t[r].getVoiceShiftWidth(),is_displaced:t[r].isDisplaced(),note:t[r]})}var f=n.length,d=n[0],v=f>2?n[1]:null,y=f>2?n[2]:n[1];2===f&&-1===d.stemDirection&&1===y.stemDirection&&(d=n[1],y=n[0]);var g=Math.max(d.voice_shift,y.voice_shift),p=0,_=void 0;if(2===f){var m=d.stemDirection===y.stemDirection?0:.5;return d.stemDirection===y.stemDirection&&d.minLine<=y.maxLine&&(d.isrest||(_=Math.abs(d.line-(y.maxLine+.5)),_=Math.max(_,d.stemMin),d.minLine=d.line-_,d.note.setStemLength(10*_))),d.minLine<=y.maxLine+m&&(d.isrest?R(d,y,1):y.isrest?R(y,d,-1):(p=g,d.stemDirection===y.stemDirection?d.note.setXShift(p+3):y.note.setXShift(p))),!0}if(null!==v&&v.minLine<y.maxLine+.5&&(v.isrest||(_=Math.abs(v.line-(y.maxLine+.5)),_=Math.max(_,v.stemMin),v.minLine=v.line-_,v.note.setStemLength(10*_))),v.isrest&&!d.isrest&&!y.isrest&&(d.minLine<=v.maxLine||v.minLine<=y.maxLine)){return v.maxLine-v.minLine<d.minLine-y.maxLine?function(t,e,i){var n=t.line-or.MidLine(e.minLine,i.maxLine);t.note.setKeyLine(0,t.note.getKeyLine(0)-n),t.line-=n,t.maxLine-=n,t.minLine-=n}(v,d,y):(p=g+3,v.note.setXShift(p)),!0}return d.isrest&&v.isrest&&y.isrest?(R(d,v,1),R(y,v,-1),!0):(v.isrest&&d.isrest&&v.minLine<=y.maxLine&&R(v,y,1),v.isrest&&y.isrest&&d.minLine<=v.maxLine&&R(v,d,-1),d.isrest&&d.minLine<=v.maxLine&&R(d,v,1),y.isrest&&v.minLine<=y.maxLine&&R(y,v,-1),(!d.isrest&&!v.isrest&&d.minLine<=v.maxLine+.5||!v.isrest&&!y.isrest&&v.minLine<=y.maxLine)&&(p=g+3,v.note.setXShift(p)),!0)}},{key:"formatByY",value:function(t,e){for(var i=!0,n=0;n<t.length;n++)i=i&&null!=t[n].getStave();if(!i)throw new or.RERR("Stave Missing","All notes must have a stave - Vex.Flow.ModifierContext.formatMultiVoice!");for(var r=0,o=0;o<t.length-1;o++){var s=t[o],a=t[o+1];s.getStemDirection()===gr.DOWN&&(s=t[o+1],a=t[o]);var h=s.getKeyProps(),u=a.getKeyProps(),l=s.getStave().getYForLine(5-h[0].line+.5);a.getStave().getYForLine(5-u[u.length-1].line-.5)-l<0&&(r=s.getVoiceShiftWidth()+2,a.setXShift(r))}e.right_shift+=r}},{key:"postFormat",value:function(t){return!!t&&(t.forEach(function(t){return t.postFormat()}),!0)}},{key:"CATEGORY",get:function(){return"stavenotes"}},{key:"STEM_UP",get:function(){return gr.UP}},{key:"STEM_DOWN",get:function(){return gr.DOWN}},{key:"DEFAULT_LEDGER_LINE_OFFSET",get:function(){return 3}}]),gi(e,[{key:"reset",value:function(){var t=this;qn(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"reset",this).call(this);var i=this.note_heads.map(function(t){return t.getStyle()});this.buildNoteHeads(),this.note_heads.forEach(function(t,e){return t.setStyle(i[e])}),this.stave&&this.note_heads.forEach(function(e){return e.setStave(t.stave)}),this.calcExtraPx()}},{key:"getCategory",value:function(){return e.CATEGORY}},{key:"buildStem",value:function(){var t=this.getGlyph(),e="v95"===t.code_head||"v3e"===t.code_head?-4:0;this.setStem(new gr({yExtend:e,hide:!!this.isRest()}))}},{key:"buildNoteHeads",value:function(){this.note_heads=[];var t=this.getStemDirection(),e=this.getKeys(),i=null,n=null,r=!1,o=void 0,s=void 0,a=void 0;t===gr.UP?(o=0,s=e.length,a=1):t===gr.DOWN&&(o=e.length-1,s=-1,a=-1);for(var h=o;h!==s;h+=a){var u=this.keyProps[h],l=u.line;null===i?i=l:0===(n=Math.abs(i-l))||.5===n?r=!r:(r=!1,this.use_default_head_x=!0),i=l;var c=new mr({duration:this.duration,note_type:this.noteType,displaced:r,stem_direction:t,custom_glyph_code:u.code,glyph_font_scale:this.render_options.glyph_font_scale,x_shift:u.shift_right,line:u.line});this.note_heads[h]=c}}},{key:"autoStem",value:function(){this.minLine=this.keyProps[0].line,this.maxLine=this.keyProps[this.keyProps.length-1].line;var t=(this.minLine+this.maxLine)/2<3?gr.UP:gr.DOWN;this.setStemDirection(t)}},{key:"calculateKeyProps",value:function(){for(var t=null,e=0;e<this.keys.length;++e){var i=this.keys[e];this.glyph.rest&&(this.glyph.position=i);var n={octave_shift:this.octave_shift||0},r=yr.keyProperties(i,this.clef,n);if(!r)throw new or.RuntimeError("BadArguments","Invalid key for note properties: "+i);"R"===r.key&&("1"===this.duration||"w"===this.duration?r.line=4:r.line=3);var o=r.line;null===t?t=o:.5===Math.abs(t-o)&&(this.displaced=!0,r.displaced=!0,this.keyProps.length>0&&(this.keyProps[e-1].displaced=!0)),t=o,this.keyProps.push(r)}t=-1/0,this.keyProps.forEach(function(e){e.line<t&&or.W("Unsorted keys in note will be sorted. See https://github.com/0xfe/vexflow/issues/104 for details."),t=e.line}),this.keyProps.sort(function(t,e){return t.line-e.line})}},{key:"getBoundingBox",value:function(){if(!this.preFormatted)throw new or.RERR("UnformattedNote","Can't call getBoundingBox on an unformatted note.");var t=this.getMetrics(),e=t.width,i=t.modLeftPx,n=t.extraLeftPx,r=this.getAbsoluteX()-i-n,o=0,s=0,a=this.getStave().getSpacingBetweenLines()/2,h=2*a;if(this.isRest()){var u=this.ys[0],l=yr.durationToFraction(this.duration);l.equals(1)||l.equals(2)?(o=u-a,s=u+a):(o=u-this.glyph.line_above*h,s=u+this.glyph.line_below*h)}else if(this.glyph.stem){var c=this.getStemExtents();c.baseY+=a*this.stem_direction,o=Math.min(c.topY,c.baseY),s=Math.max(c.topY,c.baseY)}else{o=null,s=null;for(var f=0;f<this.ys.length;++f){var d=this.ys[f];0===f?(o=d,s=d):(o=Math.min(d,o),s=Math.max(d,s))}o-=a,s+=a}return new hr(r,o,e,s-o)}},{key:"getLineNumber",value:function(t){if(!this.keyProps.length)throw new or.RERR("NoKeyProps","Can't get bottom note line, because note is not initialized properly.");for(var e=this.keyProps[0].line,i=0;i<this.keyProps.length;i++){var n=this.keyProps[i].line;t?n>e&&(e=n):n<e&&(e=n)}return e}},{key:"isRest",value:function(){return this.glyph.rest}},{key:"isChord",value:function(){return!this.isRest()&&this.keys.length>1}},{key:"hasStem",value:function(){return this.glyph.stem}},{key:"hasFlag",value:function(){return qn(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"hasFlag",this).call(this)&&!this.isRest()}},{key:"getStemX",value:function(){return"r"===this.noteType?this.getCenterGlyphX():qn(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"getStemX",this).call(this)+function(t){return gr.WIDTH/(2*-t.getStemDirection())}(this)}},{key:"getYForTopText",value:function(t){var e=this.getStemExtents();return Math.min(this.stave.getYForTopText(t),e.topY-this.render_options.annotation_spacing*(t+1))}},{key:"getYForBottomText",value:function(t){var e=this.getStemExtents();return Math.max(this.stave.getYForTopText(t),e.baseY+this.render_options.annotation_spacing*t)}},{key:"setStave",value:function(t){qn(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setStave",this).call(this,t);var i=this.note_heads.map(function(e){return e.setStave(t),e.getY()});if(this.setYs(i),this.stem){var n=this.getNoteHeadBounds(),r=n.y_top,o=n.y_bottom;this.stem.setYBounds(r,o)}return this}},{key:"getKeys",value:function(){return this.keys}},{key:"getKeyProps",value:function(){return this.keyProps}},{key:"isDisplaced",value:function(){return this.displaced}},{key:"setNoteDisplaced",value:function(t){return this.displaced=t,this}},{key:"getTieRightX",value:function(){var t=this.getAbsoluteX();return t+=this.getGlyphWidth()+this.x_shift+this.extraRightPx,this.modifierContext&&(t+=this.modifierContext.getExtraRightPx()),t}},{key:"getTieLeftX",value:function(){var t=this.getAbsoluteX();return t+=this.x_shift-this.extraLeftPx}},{key:"getLineForRest",value:function(){var t=this.keyProps[0].line;if(this.keyProps.length>1){var e=this.keyProps[this.keyProps.length-1].line,i=Math.max(t,e),n=Math.min(t,e);t=or.MidLine(i,n)}return t}},{key:"getModifierStartXY",value:function(t,e){if(!this.preFormatted)throw new or.RERR("UnformattedNote","Can't call GetModifierStartXY on an unformatted note");if(0===this.ys.length)throw new or.RERR("NoYValues","No Y-Values calculated for this note.");var i=br.Position,n=i.ABOVE,r=i.BELOW,o=i.LEFT,s=i.RIGHT,a=0;return t===o?a=-2:t===s?(a=this.getGlyphWidth()+this.x_shift+2,this.stem_direction===gr.UP&&this.hasFlag()&&function(t,e){return e===(t.getStemDirection()===gr.UP?t.keyProps.length-1:0)}(this,e)&&(a+=this.flag.getMetrics().width)):t!==r&&t!==n||(a=this.getGlyphWidth()/2),{x:this.getAbsoluteX()+a,y:this.ys[e]}}},{key:"setStyle",value:function(t){qn(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setStyle",this).call(this,t),this.note_heads.forEach(function(e){return e.setStyle(t)}),this.stem.setStyle(t)}},{key:"setStemStyle",value:function(t){this.getStem().setStyle(t)}},{key:"getStemStyle",value:function(){return this.stem.getStyle()}},{key:"setLedgerLineStyle",value:function(t){this.ledgerLineStyle=t}},{key:"getLedgerLineStyle",value:function(){return this.ledgerLineStyle}},{key:"setFlagStyle",value:function(t){this.flagStyle=t}},{key:"getFlagStyle",value:function(){return this.flagStyle}},{key:"setKeyStyle",value:function(t,e){return this.note_heads[t].setStyle(e),this}},{key:"setKeyLine",value:function(t,e){return this.keyProps[t].line=e,this.reset(),this}},{key:"getKeyLine",value:function(t){return this.keyProps[t].line}},{key:"addToModifierContext",value:function(t){this.setModifierContext(t);for(var e=0;e<this.modifiers.length;++e)this.modifierContext.addModifier(this.modifiers[e]);return this.modifierContext.addModifier(this),this.setPreFormatted(!1),this}},{key:"addModifier",value:function(t,e){return e.setNote(this),e.setIndex(t),this.modifiers.push(e),this.setPreFormatted(!1),this}},{key:"addAccidental",value:function(t,e){return this.addModifier(t,e)}},{key:"addArticulation",value:function(t,e){return this.addModifier(t,e)}},{key:"addAnnotation",value:function(t,e){return this.addModifier(t,e)}},{key:"addDot",value:function(t){var e=new kr;return e.setDotShiftY(this.glyph.dot_shiftY),this.dots++,this.addModifier(t,e)}},{key:"addDotToAll",value:function(){for(var t=0;t<this.keys.length;++t)this.addDot(t);return this}},{key:"getAccidentals",value:function(){return this.modifierContext.getModifiers("accidentals")}},{key:"getDots",value:function(){return this.modifierContext.getModifiers("dots")}},{key:"getVoiceShiftWidth",value:function(){return this.getGlyphWidth()*(this.displaced?2:1)}},{key:"calcExtraPx",value:function(){this.setExtraLeftPx(this.displaced&&this.stem_direction===gr.DOWN?this.getGlyphWidth():0),this.setExtraRightPx(!this.hasFlag()&&this.displaced&&this.stem_direction===gr.UP?this.getGlyphWidth():0)}},{key:"preFormat",value:function(){if(!this.preFormatted){this.modifierContext&&this.modifierContext.preFormat();var t=this.getGlyphWidth()+this.extraLeftPx+this.extraRightPx;this.glyph.flag&&null===this.beam&&this.stem_direction===gr.UP&&(t+=this.getGlyphWidth()),this.setWidth(t),this.setPreFormatted(!0)}}},{key:"getNoteHeadBounds",value:function(){var t=null,e=null,i=null,n=null,r=this.stave.getNumLines(),o=1,s=!1,a=!1,h=r,u=o;return this.note_heads.forEach(function(l){var c=l.getLine(),f=l.getY();(null===t||f<t)&&(t=f),(null===e||f>e)&&(e=f),null===n&&l.isDisplaced()&&(n=l.getAbsoluteX()),null!==i||l.isDisplaced()||(i=l.getAbsoluteX()),r=c>r?c:r,o=c<o?c:o,l.isDisplaced()?(s=!1===s?c:Math.max(c,s),a=!1===a?c:Math.min(c,a)):(h=Math.max(c,h),u=Math.min(c,u))},this),{y_top:t,y_bottom:e,displaced_x:n,non_displaced_x:i,highest_line:r,lowest_line:o,highest_displaced_line:s,lowest_displaced_line:a,highest_non_displaced_line:h,lowest_non_displaced_line:u}}},{key:"getNoteHeadBeginX",value:function(){return this.getAbsoluteX()+this.x_shift}},{key:"getNoteHeadEndX",value:function(){return this.getNoteHeadBeginX()+this.getGlyphWidth()}},{key:"drawLedgerLines",value:function(){var t=this.stave,e=this.glyph,i=this.render_options.stroke_px,n=this.context,r=e.getWidth()+2*i,o=2*(e.getWidth()+i)-gr.WIDTH/2;if(!this.isRest()){if(!n)throw new or.RERR("NoCanvasContext","Can't draw without a canvas context.");var s=this.getNoteHeadBounds(),a=s.highest_line,h=s.lowest_line,u=s.highest_displaced_line,l=s.highest_non_displaced_line,c=s.lowest_displaced_line,f=s.lowest_non_displaced_line,d=s.displaced_x,v=s.non_displaced_x,y=Math.min(d,v),g=function(t,e,s){var a=void 0;a=s&&e?y-i:e?v-i:d-i;var h=e&&s?o:r;n.beginPath(),n.moveTo(a,t),n.lineTo(a+h,t),n.stroke()},p=Object.assign({},t.getStyle()||{},this.getLedgerLineStyle()||{});this.applyStyle(n,p);for(var _=6;_<=a;++_){var m=null!==v&&_<=l,x=null!==d&&_<=u;g(t.getYForNote(_),m,x)}for(var b=0;b>=h;--b){var k=null!==v&&b>=f,w=null!==d&&b>=c;g(t.getYForNote(b),k,w)}this.restoreStyle(n,p)}}},{key:"drawModifiers",value:function(){if(!this.context)throw new or.RERR("NoCanvasContext","Can't draw without a canvas context.");var t=this.context;t.openGroup("modifiers");for(var e=0;e<this.modifiers.length;e++){var i=this.modifiers[e],n=this.note_heads[i.getIndex()],r=n.getStyle();r&&(t.save(),n.applyStyle(t)),i.setContext(t),i.draw(),r&&t.restore()}t.closeGroup()}},{key:"drawFlag",value:function(){var t=this.stem,e=this.beam,i=this.context;if(!i)throw new or.RERR("NoCanvasContext","Can't draw without a canvas context.");var n=null===e;if(this.getGlyph().flag&&n){var r=this.getNoteHeadBounds(),o=r.y_top,s=r.y_bottom,a=t.getHeight(),h=this.getStemX(),u=this.getStemDirection()===gr.DOWN?o-a+2:s-a-2;i.openGroup("flag",null,{pointerBBox:!0}),this.applyStyle(i,this.getFlagStyle()||!1),this.flag.render(i,h,u),this.restoreStyle(i,this.getFlagStyle()||!1),i.closeGroup()}}},{key:"drawNoteHeads",value:function(){var t=this;this.note_heads.forEach(function(e){t.context.openGroup("notehead",null,{pointerBBox:!0}),e.setContext(t.context).draw(),t.context.closeGroup()})}},{key:"drawStem",value:function(t){if(!this.context)throw new or.RERR("NoCanvasContext","Can't draw without a canvas context.");t&&this.setStem(new gr(t)),this.context.openGroup("stem",null,{pointerBBox:!0}),this.stem.setContext(this.context).draw(),this.context.closeGroup()}},{key:"draw",value:function(){if(!this.context)throw new or.RERR("NoCanvasContext","Can't draw without a canvas context.");if(!this.stave)throw new or.RERR("NoStave","Can't draw without a stave.");if(0===this.ys.length)throw new or.RERR("NoYValues","Can't draw note without Y values.");var t=this.getNoteHeadBeginX(),e=this.hasStem()&&!this.beam;this.note_heads.forEach(function(e){return e.setX(t)});var i=this.getStemX();this.stem.setNoteHeadXBounds(i,i),function(){for(var t=arguments,e=arguments.length,i=Array(e),n=0;n<e;n++)i[n]=t[n];wr.DEBUG&&or.L("Vex.Flow.StaveNote",i)}("Rendering ",this.isChord()?"chord :":"note :",this.keys),this.drawLedgerLines(),this.applyStyle(),this.setAttribute("el",this.context.openGroup("stavenote",this.getAttribute("id"))),this.context.openGroup("note",null,{pointerBBox:!0}),e&&this.drawStem(),this.drawNoteHeads(),this.drawFlag(),this.context.closeGroup(),this.drawModifiers(),this.context.closeGroup(),this.restoreStyle(),this.setRendered()}}]),e}(),Tr=4,Sr=function(){function t(e){fi(this,t),this.duration=(Tr/e).toFixed()}return gi(t,[{key:"toString",value:function(){return""}}]),t}(),Er=function(t){function e(){return fi(this,e),ni(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return ci(e,Sr),gi(e,[{key:"toString",value:function(){return"[r "+this.duration+"]"}}]),e}(),Rr=function(t){function e(t){fi(this,e);var i=t.iterate().next().value,n=ni(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,i.end-i.start));n.noteGroup=t,n.noteNames=[];var r=!0,o=!1,s=void 0;try{for(var a,h=n.noteGroup.iterate()[Symbol.iterator]();!(r=(a=h.next()).done);r=!0){var u=a.value;n.noteNames.push(u.note.vexflowNoteName())}}catch(t){o=!0,s=t}finally{try{!r&&h.return&&h.return()}finally{if(o)throw s}}return n}return ci(e,Sr),gi(e,[{key:"toString",value:function(){return"["+this.noteNames.join(",")+" "+this.duration+"]"}}]),e}(),Cr=function(){function t(e,i){fi(this,t),this.noteGroup=e,this.intervals=i}return gi(t,[{key:"length",value:function(){return this.noteGroup.length()}}]),t}(),Or=function(){function t(e){fi(this,t),this.voices=e,this.length=this.voices.length}return gi(t,[{key:"toProperVoices",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:4,e=[],i=function(t,i){t>e.length-1&&e.push([]),e[t].push(new function t(e){fi(this,t),this.scoreObjects=e}(i))},n=!0,r=!1,o=void 0;try{for(var s,a=this.voices[Symbol.iterator]();!(n=(s=a.next()).done);n=!0){var h=t,u=[],l=0,c=0,f=s.value.noteGroup.subgroups;f.sort(function(t,e){var i=t.events[0].start,n=e.events[0].start;return i<n?-1:i>n?1:0});var d=!0,v=!1,y=void 0;try{for(var g,p=f[Symbol.iterator]();!(d=(g=p.next()).done);d=!0){var _=g.value,m=_.events[0].start,x=_.events[0].end;m>l&&m>=h&&(u.push(new Er(h-l)),i(c,u),u=[],l=h,c++,h+=t),m>l&&u.push(new Er(m-l)),m>=h&&(i(c,u),u=[],c++,h+=t),u.push(new Rr(_,x-m)),l=x}}catch(t){v=!0,y=t}finally{try{!d&&p.return&&p.return()}finally{if(v)throw y}}h>l&&u.push(new Er(h-l)),0!=u.length&&i(c,u)}}catch(t){r=!0,o=t}finally{try{!n&&a.return&&a.return()}finally{if(r)throw o}}return e}},{key:"toProperStrings",value:function(){return this.toProperVoices().map(function(t){return t.map(function(t){return t.scoreObjects.map(function(t){return t.toString()}).join("")})})}}],[{key:"fromNoteGroup",value:function(e){var i=new Map,n=!0,r=!1,o=void 0;try{for(var s,a=e.iterate()[Symbol.iterator]();!(n=(s=a.next()).done);n=!0){var h=s.value,u=h.timeKey();i.has(u)?i.get(u).addEvent(h):i.set(u,new cn(h))}}catch(t){r=!0,o=t}finally{try{!n&&a.return&&a.return()}finally{if(r)throw o}}var l=function(t){return t.split(",").map(function(t){return parseFloat(t)})},c=[],f=!0,d=!1,v=void 0;try{for(var y,g=i.entries()[Symbol.iterator]();!(f=(y=g.next()).done);f=!0){var p=y.value,_=nn(p,2),m=_[0],x=_[1],b=(u=l(m),nn(u,2)),k=b[0],w=b[1],T=!1,S=!0,E=!1,R=void 0;try{for(var C,O=c[Symbol.iterator]();!(S=(C=O.next()).done);S=!0){var N=C.value,P=!1,A=!0,L=!1,M=void 0;try{for(var F,B=N.intervals[Symbol.iterator]();!(A=(F=B.next()).done);A=!0){var I=F.value,G=nn(I,2),D=G[0],Y=G[1];if(w>D&&k<Y){P=!0;break}}}catch(t){L=!0,M=t}finally{try{!A&&B.return&&B.return()}finally{if(L)throw M}}if(!P){var W=new cn,V=!0,H=!1,j=void 0;try{for(var U,X=x.iterate()[Symbol.iterator]();!(V=(U=X.next()).done);V=!0){var z=U.value;W.addEvent(z)}}catch(t){H=!0,j=t}finally{try{!V&&X.return&&X.return()}finally{if(H)throw j}}N.noteGroup.addGroup(W),N.intervals.push(u),T=!0;break}}}catch(t){E=!0,R=t}finally{try{!S&&O.return&&O.return()}finally{if(E)throw R}}T||c.push(new Cr(new cn(x),[u]))}}catch(t){d=!0,v=t}finally{try{!f&&g.return&&g.return()}finally{if(d)throw v}}return new t(c)}}]),t}(),Nr=function(t){function e(t,i,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;fi(this,e);var s=ni(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));s.tapComposeScore=t,s.renderedNote=i,s.index=n,s.leftNote=r,s.rightNote=o;var a=s.renderedNote.noteGroup.iterate().next().value;return s.start=a.start,s.end=a.end,s.selected=!1,s.playing=!1,s.suggested=!1,s.hovered=!1,s.element=s.renderedNote.staveNote.attrs.el,s.x=s.element.getBBox().x,s.onceOffScheduler=new sn(s.tapComposeScore.scheduler.timing),s.registerListener(s.element,"mouseover",s.mouseOver.bind(s)),s.registerListener(s.element,"mouseout",s.mouseOut.bind(s)),s.registerListener(s.element,"click",s.clickPlayback.bind(s)),s.registerListener(s.element,"touchstart",s.clickPlayback.bind(s)),s.initialize(),s.preventDoubleClick=!1,s}return ci(e,nr),gi(e,[{key:"initialize",value:function(){this.element.style.cursor="pointer"}},{key:"select",value:function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0]&&this.playOnceOff(this.renderedNote.noteGroup),this.selected||(this.selected=!0,this.render())}},{key:"deselect",value:function(){this.selected&&(this.selected=!1,this.render())}},{key:"play",value:function(){this.playing||(this.playing=!0,this.render())}},{key:"stopPlaying",value:function(){this.playing&&(this.playing=!1,this.render())}},{key:"tearDown",value:function(){qn(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"tearDown",this).call(this),this.cancelOnceOff()}},{key:"mouseOver",value:function(){this.hovered=!0,this.render()}},{key:"mouseOut",value:function(){this.hovered=!1,this.render()}},{key:"clickPlayback",value:function(t){var e=this;this.preventDoubleClick||(this.preventDoubleClick=!0,setTimeout(function(){return e.preventDoubleClick=!1},100),this.tapComposeScore.scheduler.playing||this.playOnceOff(this.renderedNote.noteGroup),this.tapComposeScore.select(this),t.stopPropagation())}},{key:"playOnceOff",value:function(t){this.cancelOnceOff();var e=t.toPerformanceGroup(this.tapComposeScore.instrument,!0,"onceOff-");this.onceOffScheduler.add(e),this.onceOffScheduler.initialize(),this.onceOffScheduler.play()}},{key:"cancelOnceOff",value:function(){if(!(arguments.length>0&&void 0!==arguments[0])||arguments[0]){var t=!0,e=!1,i=void 0;try{for(var n,r=this.tapComposeScore.interactiveNotes[Symbol.iterator]();!(t=(n=r.next()).done);t=!0){n.value.cancelOnceOff(!1)}}catch(t){e=!0,i=t}finally{try{!t&&r.return&&r.return()}finally{if(e)throw i}}}else this.onceOffScheduler.clear(),this.tapComposeScore.instrument.allOff()}},{key:"render",value:function(){this.selected?(this.fill("#4F1DB8"),this.opacity(1)):(this.playing?this.fill("#C2ADED"):this.suggested?this.fill("#ccc",!0):this.fill("#000"),this.hovered?this.opacity(.65):this.opacity(1))}},{key:"fill",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=Array.from(this.element.getElementsByTagName("*"));if(e)for(var n=this.element.nextSibling;n;)"path"==n.tagName.toLowerCase()&&i.push(n),n=n.nextSibling;i.forEach(function(e){e.getAttribute("fill")&&e.setAttribute("fill",t),e.getAttribute("stroke")&&e.setAttribute("stroke",t)})}},{key:"opacity",value:function(t){this.element.setAttribute("opacity",t)}}]),e}(),Pr=function(){function t(e,i){fi(this,t),this.noteGroup=e,this.namedChords=i}return gi(t,[{key:"serialize",value:function(){return this.namedChords.map(function(t){return t.name}).join(",")+"-"+this.noteGroup.serialize()}}],[{key:"deserialize",value:function(e,i){var n=e.split("-"),r=nn(n,2),o=r[0],s=r[1],a=o.split(",").map(function(t){return i.getChordByName(t)});return new t(cn.deserialize(s),a)}}]),t}(),Ar=function(){function t(e,i){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:6;fi(this,t),this.tapComposeScore=e,this.interactiveNotes=i,this.width=r,this.rect=null,this.initialize(n)}return gi(t,[{key:"initialize",value:function(t){this.rect=document.createElementNS("http://www.w3.org/2000/svg","rect"),this.rect.setAttributeNS(null,"y",0),this.rect.setAttributeNS(null,"width",6),this.rect.setAttributeNS(null,"height",300),this.rect.setAttributeNS(null,"class","cursor");this.tapComposeScore.scoreRenderer.scoreElem.querySelector("svg").appendChild(this.rect),this.setPosition(t)}},{key:"setPosition",value:function(t){var e=!0,i=!1,n=void 0;try{for(var r,o=this.interactiveNotes[Symbol.iterator]();!(e=(r=o.next()).done);e=!0){var s=r.value;if(t>=s.start&&t<=s.end){var a=s.x,h=s.x;null!=s.rightNote&&(h=s.rightNote.x);var u=a+(t-s.start)/(s.end-s.start)*(h-a);this.rect.setAttributeNS(null,"x",u+this.width/2)}}}catch(t){i=!0,n=t}finally{try{!e&&o.return&&o.return()}finally{if(i)throw n}}}}]),t}(),Lr=function(t){function e(t,i,n,r,o,s){var a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;fi(this,e);var h=ni(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));if(h.scoreRenderer=t,h.scheduler=i,h.instrument=n,h.arpeggioApp=r,h.suggester=o,h.chordDictionary=s,h.playing=!1,h.interactiveNotes=[],h.selected=null,h.playing=null,h.acceptedBars=-1,null!=a)try{h.deserialize(a)}catch(t){console.error("Deserialization failed"),console.error(t)}return h.acceptedBars<0&&h.shuffle(),h}return ci(e,nr),gi(e,[{key:"deserialize",value:function(t){var e=Pr.deserialize(t,this.chordDictionary),i=Or.fromNoteGroup(e.noteGroup).toProperVoices(),n=!0,r=!1,o=void 0;try{for(var s,a=i[Symbol.iterator]();!(n=(s=a.next()).done);n=!0){var h=s.value,u=new cn,l=!0,c=!1,f=void 0;try{for(var d,v=h[Symbol.iterator]();!(l=(d=v.next()).done);l=!0){var y=d.value,g=!0,p=!1,_=void 0;try{for(var m,x=y.scoreObjects[Symbol.iterator]();!(g=(m=x.next()).done);g=!0){var b=m.value;u.addGroup(b.noteGroup)}}catch(t){p=!0,_=t}finally{try{!g&&x.return&&x.return()}finally{if(p)throw _}}}}catch(t){c=!0,f=t}finally{try{!l&&v.return&&v.return()}finally{if(c)throw f}}var k=e.namedChords[this.suggester.history.length],w=new _n(k,new vn);this.suggester.history.push(Jn.fixed(new mn(w,u))),this.suggester.currentBeat=4*(this.suggester.history.length-1)}}catch(t){r=!0,o=t}finally{try{!n&&a.return&&a.return()}finally{if(r)throw o}}0!=this.suggester.history.length&&(this.suggester.acceptIndex=this.suggester.history.length-1,this.acceptedBars=this.suggester.acceptIndex)}},{key:"serialize",value:function(){var t=this.suggester.history.map(function(t){return t.value}),e=new cn(t.map(function(t){return t.noteGroup})),i=t.map(function(t){return t.contextualChord.namedChord});return new Pr(e,i).serialize()}},{key:"shuffle",value:function(){this.suggester.suggest(),this.render(),this.setBeatOffset(4*(this.acceptedBars+1)),this.playScheduler()}},{key:"accept",value:function(){this.suggester.accept(),this.acceptedBars++,this.shuffle()}},{key:"setBeatOffset",value:function(t){this.scheduler.playing&&this.allOff(),this.scheduler.setBeatOffset(t)}},{key:"select",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.deselect(),this.setBeatOffset(t.start),this.selected=t,this.selected.select(e)}},{key:"deselect",value:function(){null!=this.selected&&(this.selected.deselect(),this.selected=null)}},{key:"play",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];null!=this.playing&&(this.playing.stopPlaying(),this.playing=null),e&&(this.playing=t,this.playing.play())}},{key:"selectAdjacent",value:function(t){if(null!=this.selected){var e=t?this.selected.leftNote:this.selected.rightNote;null!=e&&this.select(e,!0)}}},{key:"mutate",value:function(t,e){var i=!0,n=!1,r=void 0;try{for(var o,s=this.suggester.history[Symbol.iterator]();!(i=(o=s.next()).done);i=!0){var a=o.value,h=!0,u=!1,l=void 0;try{for(var c,f=a.value.noteGroup.subgroups[Symbol.iterator]();!(h=(c=f.next()).done);h=!0){var d=c.value,v=!0,y=!1,g=void 0;try{for(var p,_=d.events[Symbol.iterator]();!(v=(p=_.next()).done);v=!0){var m=p.value;if(m.toString()==t.toString())return void(m.note=e)}}catch(t){y=!0,g=t}finally{try{!v&&_.return&&_.return()}finally{if(y)throw g}}}}catch(t){u=!0,l=t}finally{try{!h&&f.return&&f.return()}finally{if(u)throw l}}var x=!0,b=!1,k=void 0;try{for(var w,T=a.value.noteGroup.events[Symbol.iterator]();!(x=(w=T.next()).done);x=!0){var S=w.value;if(S.toString()==t.toString())return void(S.note=e)}}catch(t){b=!0,k=t}finally{try{!x&&T.return&&T.return()}finally{if(b)throw k}}}}catch(t){n=!0,r=t}finally{try{!i&&s.return&&s.return()}finally{if(n)throw r}}throw new Error("Mutation not found")}},{key:"shiftSelected",value:function(t,e){if(null!=this.selected){var i=!0,n=!1,r=void 0;try{for(var o,s=this.selected.renderedNote.noteGroup.events[Symbol.iterator]();!(i=(o=s.next()).done);i=!0){var a=o.value;e?this.mutate(a,a.note.accidentalShift(t,2)):this.mutate(a,a.note.baseShift(t))}}catch(t){n=!0,r=t}finally{try{!i&&s.return&&s.return()}finally{if(n)throw r}}this.render(!0)}}},{key:"click",value:function(){this.deselect()}},{key:"playScheduler",value:function(){this.deselect(),this.scheduler.play()}},{key:"allOff",value:function(){this.scheduler.pause(),this.instrument.allOff();var t=!0,e=!1,i=void 0;try{for(var n,r=this.interactiveNotes[Symbol.iterator]();!(t=(n=r.next()).done);t=!0){n.value.cancelOnceOff(!1)}}catch(t){e=!0,i=t}finally{try{!t&&r.return&&r.return()}finally{if(e)throw i}}this.play(null,!1)}},{key:"keydown",value:function(t){"ArrowLeft"==t.code||"ArrowRight"==t.code?(null!=this.selected&&t.preventDefault(),this.selectAdjacent("ArrowLeft"==t.code),t.stopPropagation()):"ArrowUp"==t.code||"ArrowDown"==t.code?(null!=this.selected&&t.preventDefault(),this.shiftSelected("ArrowDown"==t.code?-1:1,t.shiftKey),t.stopPropagation()):"Enter"==t.code?this.shuffle():"KeyA"==t.code?this.accept():"KeyR"==t.code?(this.allOff(),this.scheduler.beatOffset=0,this.playScheduler()):"Space"==t.code&&(this.scheduler.playing?(this.scheduler.pause(),this.allOff()):this.playScheduler(),t.preventDefault(),t.stopPropagation())}},{key:"tearDown",value:function(){qn(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"tearDown",this).call(this),this.interactiveNotes.forEach(function(t){return t.tearDown()})}},{key:"render",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],i=this.serialize();location.hash=i.replace("#","_");var n=void 0;e&&this.selected&&(n=this.selected.index),this.tearDown(),this.interactiveNotes=[],this.selected=null;var r=this.suggester.history.map(function(t){return t.value}),o=new cn(r.map(function(t){return t.noteGroup})),s=r.map(function(t){return t.contextualChord});this.scheduler.clear(),this.instrument.allOff(),this.scoreRenderer.clear();for(var a=this.scoreRenderer.render(o,s),h=0;h<a.length;h++){var u=a[h],l=h==a.length-1,c=function(e){var i=new Nr(t,e,t.interactiveNotes.length);t.interactiveNotes.push(i);var n=i.renderedNote.noteGroup.toPerformanceGroup(t.instrument);n.addEvent(new hn(function(){t.play(i,!0)},i.start)),n.addEvent(new hn(function(){t.play(i,!1)},i.end)),t.scheduler.add(n),i.suggested=l},f=!0,d=!1,v=void 0;try{for(var y,g=u.renderedNotes[Symbol.iterator]();!(f=(y=g.next()).done);f=!0){c(y.value)}}catch(t){d=!0,v=t}finally{try{!f&&g.return&&g.return()}finally{if(d)throw v}}}for(var p=0;p<this.interactiveNotes.length;p++)0!=p&&(this.interactiveNotes[p].leftNote=this.interactiveNotes[p-1]),p!=this.interactiveNotes.length-1&&(this.interactiveNotes[p].rightNote=this.interactiveNotes[p+1]),this.interactiveNotes[p].render();var _=new cn;_.name="arpeggio";this.arpeggioApp.observe("styleIndex",function(){t.allOff(),t.scheduler.pause(),t.scheduler.schedule.removeGroupByName("arpeggio"),(_=new cn).name="arpeggio";for(var e=0;e<s.length;e++){var i=t.arpeggioApp.get("arpeggios")[t.arpeggioApp.get("styleIndex")],n=i.arpeggio,r=i.beatsPerStep,o=s[e].namedChord.chord,a=new In(n,o,r,4*e,4*(e+1)).toNoteGroup().toPerformanceGroup(t.instrument);a.setOffset(4*e),_.addGroup(a)}t.scheduler.add(_),t.scheduler.initialize()});var m=e?new Ar(this,this.interactiveNotes,this.interactiveNotes[n].start):new Ar(this,this.interactiveNotes);this.scheduler.setBeatOffsetCallback(function(t){return m.setPosition(t)}),e&&this.select(this.interactiveNotes[n],!0),this.registerListener(this.scoreRenderer.scoreElem,"click",this.click.bind(this)),this.registerListener(this.scoreRenderer.scoreElem,"touchstart",this.click.bind(this)),this.registerListener(document.body,"keydown",this.keydown.bind(this))}}]),e}(),Mr=function(t,e,i,n){try{return n?e(V(i)[0],i[1]):e(i)}catch(e){var r=t.return;throw void 0!==r&&V(r.call(t)),e}},Fr=Bt("iterator"),Br=Array.prototype,Ir=function(t,e,i){e in t?Q.f(t,e,Z(0,i)):t[e]=i},Gr=Bt("iterator"),Dr=!1;try{[7][Gr]().return=function(){Dr=!0}}catch(t){}it(it.S+it.F*!function(t,e){if(!e&&!Dr)return!1;var i=!1;try{var n=[7],r=n[Gr]();r.next=function(){return{done:i=!0}},n[Gr]=function(){return r},t(n)}catch(t){}return i}(function(t){}),"Array",{from:function(t){var e,i,n,r,o=Wt(t),s="function"==typeof this?this:Array,a=arguments.length,h=a>1?arguments[1]:void 0,u=void 0!==h,l=0,c=$i(o);if(u&&(h=Y(h,a>2?arguments[2]:void 0,2)),void 0==c||s==Array&&function(t){return void 0!==t&&(st.Array===t||Br[Fr]===t)}(c))for(i=new s(e=ft(o.length));e>l;l++)Ir(i,l,u?h(o[l],l):o[l]);else for(r=c.call(o),i=new s;!(n=r.next()).done;l++)Ir(i,l,u?Mr(r,h,[n.value,l],!0):n.value);return i.length=l,i}});var Yr=D.Array.from,Wr=e(function(t){t.exports={default:Yr,__esModule:!0}});t(Wr);var Vr=t(e(function(t,e){e.__esModule=!0;var i=function(t){return t&&t.__esModule?t:{default:t}}(Wr);e.default=function(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return(0,i.default)(t)}})),Hr=function(){function t(){fi(this,t)}return gi(t,[{key:"isValidNoteValue",value:function(e){return!(null==e||e<0||e>=t.NUM_TONES)}},{key:"isValidIntervalValue",value:function(t){return this.isValidNoteValue(t)}},{key:"getNoteParts",value:function(t){if(!t||t.length<1)throw new or.RERR("BadArguments","Invalid note name: "+t);if(t.length>3)throw new or.RERR("BadArguments","Invalid note name: "+t);var e=t.toLowerCase(),i=/^([cdefgab])(b|bb|n|#|##)?$/.exec(e);if(null!=i){return{root:i[1],accidental:i[2]}}throw new or.RERR("BadArguments","Invalid note name: "+t)}},{key:"getKeyParts",value:function(t){if(!t||t.length<1)throw new or.RERR("BadArguments","Invalid key: "+t);var e=t.toLowerCase(),i=/^([cdefgab])(b|#)?(mel|harm|m|M)?$/.exec(e);if(null!=i){var n=i[1],r=i[2],o=i[3];return o||(o="M"),{root:n,accidental:r,type:o}}throw new or.RERR("BadArguments","Invalid key: "+t)}},{key:"getNoteValue",value:function(e){var i=t.noteValues[e];if(null==i)throw new or.RERR("BadArguments","Invalid note name: "+e);return i.int_val}},{key:"getIntervalValue",value:function(e){var i=t.intervals[e];if(null==i)throw new or.RERR("BadArguments","Invalid interval name: ${intervalString}");return i}},{key:"getCanonicalNoteName",value:function(e){if(!this.isValidNoteValue(e))throw new or.RERR("BadArguments","Invalid note value: "+e);return t.canonical_notes[e]}},{key:"getCanonicalIntervalName",value:function(e){if(!this.isValidIntervalValue(e))throw new or.RERR("BadArguments","Invalid interval value: "+e);return t.diatonic_intervals[e]}},{key:"getRelativeNoteValue",value:function(e,i,n){if(null==n&&(n=1),1!==n&&-1!==n)throw new or.RERR("BadArguments","Invalid direction: "+n);var r=(e+n*i)%t.NUM_TONES;return r<0&&(r+=t.NUM_TONES),r}},{key:"getRelativeNoteName",value:function(e,i){var n=this.getNoteParts(e),r=this.getNoteValue(n.root),o=i-r;if(Math.abs(o)>t.NUM_TONES-3){var s=1;o>0&&(s=-1);var a=(i+1+(r+1))%t.NUM_TONES*s;if(Math.abs(a)>2)throw new or.RERR("BadArguments","Notes not related: "+e+", "+i+")");o=a}if(Math.abs(o)>2)throw new or.RERR("BadArguments","Notes not related: "+e+", "+i+")");var h=n.root;if(o>0)for(var u=1;u<=o;++u)h+="#";else if(o<0)for(var l=-1;l>=o;--l)h+="b";return h}},{key:"getScaleTones",value:function(t,e){for(var i=[t],n=t,r=0;r<e.length;r+=1)(n=this.getRelativeNoteValue(n,e[r]))!==t&&i.push(n);return i}},{key:"getIntervalBetween",value:function(e,i,n){if(null==n&&(n=1),1!==n&&-1!==n)throw new or.RERR("BadArguments","Invalid direction: "+n);if(!this.isValidNoteValue(e)||!this.isValidNoteValue(i))throw new or.RERR("BadArguments","Invalid notes: "+e+", "+i);var r=1===n?i-e:e-i;return r<0&&(r+=t.NUM_TONES),r}},{key:"createScaleMap",value:function(e){var i=this.getKeyParts(e),n=t.scaleTypes[i.type],r=i.root;if(i.accidental&&(r+=i.accidental),!n)throw new or.RERR("BadArguments","Unsupported key type: "+e);for(var o=this.getScaleTones(this.getNoteValue(r),n),s=t.root_indices[i.root],a={},h=0;h<t.roots.length;++h){var u=(s+h)%t.roots.length,l=t.roots[u],c=this.getRelativeNoteName(l,o[h]);1===c.length&&(c+="n"),a[l]=c}return a}}],[{key:"NUM_TONES",get:function(){return 12}},{key:"roots",get:function(){return["c","d","e","f","g","a","b"]}},{key:"root_values",get:function(){return[0,2,4,5,7,9,11]}},{key:"root_indices",get:function(){return{c:0,d:1,e:2,f:3,g:4,a:5,b:6}}},{key:"canonical_notes",get:function(){return["c","c#","d","d#","e","f","f#","g","g#","a","a#","b"]}},{key:"diatonic_intervals",get:function(){return["unison","m2","M2","m3","M3","p4","dim5","p5","m6","M6","b7","M7","octave"]}},{key:"diatonic_accidentals",get:function(){return{unison:{note:0,accidental:0},m2:{note:1,accidental:-1},M2:{note:1,accidental:0},m3:{note:2,accidental:-1},M3:{note:2,accidental:0},p4:{note:3,accidental:0},dim5:{note:4,accidental:-1},p5:{note:4,accidental:0},m6:{note:5,accidental:-1},M6:{note:5,accidental:0},b7:{note:6,accidental:-1},M7:{note:6,accidental:0},octave:{note:7,accidental:0}}}},{key:"intervals",get:function(){return{u:0,unison:0,m2:1,b2:1,min2:1,S:1,H:1,2:2,M2:2,maj2:2,T:2,W:2,m3:3,b3:3,min3:3,M3:4,3:4,maj3:4,4:5,p4:5,"#4":6,b5:6,aug4:6,dim5:6,5:7,p5:7,"#5":8,b6:8,aug5:8,6:9,M6:9,maj6:9,b7:10,m7:10,min7:10,dom7:10,M7:11,maj7:11,8:12,octave:12}}},{key:"scales",get:function(){return{major:[2,2,1,2,2,2,1],dorian:[2,1,2,2,2,1,2],mixolydian:[2,2,1,2,2,1,2],minor:[2,1,2,2,1,2,2]}}},{key:"scaleTypes",get:function(){return{M:t.scales.major,m:t.scales.minor}}},{key:"accidentals",get:function(){return["bb","b","n","#","##"]}},{key:"noteValues",get:function(){return{c:{root_index:0,int_val:0},cn:{root_index:0,int_val:0},"c#":{root_index:0,int_val:1},"c##":{root_index:0,int_val:2},cb:{root_index:0,int_val:11},cbb:{root_index:0,int_val:10},d:{root_index:1,int_val:2},dn:{root_index:1,int_val:2},"d#":{root_index:1,int_val:3},"d##":{root_index:1,int_val:4},db:{root_index:1,int_val:1},dbb:{root_index:1,int_val:0},e:{root_index:2,int_val:4},en:{root_index:2,int_val:4},"e#":{root_index:2,int_val:5},"e##":{root_index:2,int_val:6},eb:{root_index:2,int_val:3},ebb:{root_index:2,int_val:2},f:{root_index:3,int_val:5},fn:{root_index:3,int_val:5},"f#":{root_index:3,int_val:6},"f##":{root_index:3,int_val:7},fb:{root_index:3,int_val:4},fbb:{root_index:3,int_val:3},g:{root_index:4,int_val:7},gn:{root_index:4,int_val:7},"g#":{root_index:4,int_val:8},"g##":{root_index:4,int_val:9},gb:{root_index:4,int_val:6},gbb:{root_index:4,int_val:5},a:{root_index:5,int_val:9},an:{root_index:5,int_val:9},"a#":{root_index:5,int_val:10},"a##":{root_index:5,int_val:11},ab:{root_index:5,int_val:8},abb:{root_index:5,int_val:7},b:{root_index:6,int_val:11},bn:{root_index:6,int_val:11},"b#":{root_index:6,int_val:0},"b##":{root_index:6,int_val:1},bb:{root_index:6,int_val:10},bbb:{root_index:6,int_val:9}}}}]),t}(),jr=function(t){return t.getMetrics().width},Ur=function(t){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;fi(this,e);var i=ni(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));if(i.setAttribute("type","Accidental"),C("New accidental: ",t),i.note=null,i.index=null,i.type=t,i.position=br.Position.LEFT,i.render_options={font_scale:38,stroke_px:3,parenLeftPadding:2,parenRightPadding:2},i.accidental=yr.accidentalCodes(i.type),!i.accidental)throw new or.RERR("ArgumentError","Unknown accidental type: "+t);return i.cautionary=!1,i.parenLeft=null,i.parenRight=null,i.reset(),i}return ci(e,br),gi(e,null,[{key:"format",value:function(t,e){var i=this,n=e.left_shift+1;if(t&&0!==t.length){for(var r=[],o=null,s=0,a=0;a<t.length;++a){var h=t[a],u=h.getNote(),l=u.getStave(),c=u.getKeyProps()[h.getIndex()];if(u!==o){for(var f=0;f<u.keys.length;++f)s=u.getKeyProps()[f].displaced?u.getExtraLeftPx():s;o=u}if(null!==l){var d=l.options.spacing_between_lines_px,v=l.getYForLine(c.line),y=Math.round(v/d*2)/2;r.push({y:v,line:y,shift:s,acc:h,lineSpace:d})}else r.push({line:c.line,shift:s,acc:h})}r.sort(function(t,e){return e.line-t.line});for(var g=[],p=0,_=null,m=0;m<r.length;m++){var x=r[m];null!==_&&_===x.line||g.push({line:x.line,flatLine:!0,dblSharpLine:!0,numAcc:0,width:0}),"b"!==x.acc.type&&"bb"!==x.acc.type&&(g[g.length-1].flatLine=!1),"##"!==x.acc.type&&(g[g.length-1].dblSharpLine=!1),g[g.length-1].numAcc++,g[g.length-1].width+=x.acc.getWidth()+3,p=x.shift>p?x.shift:p,_=x.line}for(var b=0,k=function(t){for(var e=!1,n=t,r=t;r+1<g.length&&!e;)i.checkCollision(g[r],g[r+1])?r++:e=!0;var o=function(t){return g[n+t]},s=function(t){return t.map(o)},a=function(t,e){var i=s([t,e]).map(function(t){return t.line}),n=nn(i,2);return n[0]-n[1]},h=function(){for(var t=arguments,e=arguments.length,n=Array(e),r=0;r<e;r++)n[r]=t[r];return n.map(s).every(function(t){return!i.checkCollision.apply(i,Vr(t))})},u=r-n+1,l=i.checkCollision(g[n],g[r])?"a":"b";switch(u){case 3:"a"===l&&.5===a(1,2)&&.5!==a(0,1)&&(l="second_on_bottom");break;case 4:h([0,2],[1,3])&&(l="spaced_out_tetrachord");break;case 5:"b"===l&&h([1,3])&&(l="spaced_out_pentachord",h([0,2],[2,4])&&(l="very_spaced_out_pentachord"));break;case 6:h([0,3],[1,4],[2,5])&&(l="spaced_out_hexachord"),h([0,2],[2,4],[1,3],[3,5])&&(l="very_spaced_out_hexachord")}var c=void 0,f=void 0;if(u>=7){for(var d=2,v=!0;!0===v;){v=!1;for(var y=0;y+d<g.length;y++)if(i.checkCollision(g[y],g[y+d])){v=!0,d++;break}}for(c=t;c<=r;c++)f=(c-t)%d+1,g[c].column=f,b=b>f?b:f}else for(c=t;c<=r;c++)f=yr.accidentalColumnsTable[u][l][c-t],g[c].column=f,b=b>f?b:f;w=t=r},w=0;w<g.length;w++)k(w);for(var T=[],S=[],E=0;E<=b;E++)T[E]=0,S[E]=0;T[0]=p+n,S[0]=p+n,g.forEach(function(t){t.width>T[t.column]&&(T[t.column]=t.width)});for(var R=1;R<T.length;R++)S[R]=T[R]+S[R-1];var O=S[S.length-1],N=0;g.forEach(function(t){for(var e=0,i=N+t.numAcc;N<i;N++){var n=S[t.column-1]+e;r[N].acc.setXShift(n),e+=r[N].acc.getWidth()+3,C("Line, accCount, shift: ",t.line,N,n)}}),e.left_shift+=O}}},{key:"checkCollision",value:function(t,e){var i=e.line-t.line,n=3;i>0?(n=e.flatLine||e.dblSharpLine?2.5:3,t.dblSharpLine&&(i-=.5)):(n=t.flatLine||t.dblSharpLine?2.5:3,e.dblSharpLine&&(i-=.5));var r=Math.abs(i)<n;return C("Line_1, Line_2, Collision: ",t.line,e.line,r),r}},{key:"applyAccidentals",value:function(t,i){var n=[],r={};t.forEach(function(t){var e=new ar(0,1);t.getTickables().forEach(function(t){if(!t.shouldIgnoreTicks()){var i=r[e.value()];i?i.push(t):(n.push(e.value()),r[e.value()]=[t]),e.add(t.getTicks())}})});var o=new Hr;i||(i="C");var s=o.createScaleMap(i);n.forEach(function(t){var i=[];r[t].forEach(function t(n){n.isRest()||n.shouldIgnoreTicks()||(n.keys.forEach(function(t,r){var a=o.getNoteParts(t.split("/")[0]),h=a.accidental||"n",u=a.root+h,l=s[a.root]===u,c=i.indexOf(u)>-1;if(!l||l&&c){s[a.root]=u;var f=new e(h);n.addAccidental(r,f),i.push(u)}}),n.getModifiers().forEach(function(e){"gracenotegroups"===e.getCategory()&&e.getGraceNotes().forEach(t)}))})})}},{key:"CATEGORY",get:function(){return"accidentals"}}]),gi(e,[{key:"reset",value:function(){var t=this.render_options.font_scale;this.glyph=new vr(this.accidental.code,t),this.glyph.setOriginX(1),this.cautionary&&(this.parenLeft=new vr(yr.accidentalCodes("{").code,t),this.parenRight=new vr(yr.accidentalCodes("}").code,t),this.parenLeft.setOriginX(1),this.parenRight.setOriginX(1))}},{key:"getCategory",value:function(){return e.CATEGORY}},{key:"getWidth",value:function(){var t=this.cautionary?jr(this.parenLeft)+jr(this.parenRight)+this.render_options.parenLeftPadding+this.render_options.parenRightPadding:0;return jr(this.glyph)+t}},{key:"setNote",value:function(t){if(!t)throw new or.RERR("ArgumentError","Bad note value: "+t);this.note=t,"gracenotes"===this.note.getCategory()&&(this.render_options.font_scale=25,this.reset())}},{key:"setAsCautionary",value:function(){return this.cautionary=!0,this.render_options.font_scale=28,this.reset(),this}},{key:"draw",value:function(){var t=this.context,e=this.type,i=this.position,n=this.note,r=this.index,o=this.cautionary,s=this.x_shift,a=this.y_shift,h=this.glyph,u=this.parenLeft,l=this.parenRight,c=this.render_options,f=c.parenLeftPadding,d=c.parenRightPadding;if(this.checkContext(),!n||null==r)throw new or.RERR("NoAttachedNote","Can't draw accidental without a note and index.");var v=n.getModifierStartXY(i,r),y=v.x+s,g=v.y+a;C("Rendering: ",e,y,g),o?(l.render(t,y,g),y-=jr(l),y-=d,y-=this.accidental.parenRightPaddingAdjustment,h.render(t,y,g),y-=jr(h),y-=f,u.render(t,y,g)):h.render(t,y,g),this.setRendered()}}]),e}(),Xr=function(t){function e(t){fi(this,e);var i=ni(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));if(i.setAttribute("type","Voice"),"string"==typeof t){var n=t.match(/(\d+)\/(\d+)/);n&&(t={num_beats:n[1],beat_value:n[2],resolution:yr.RESOLUTION})}return i.time=or.Merge({num_beats:4,beat_value:4,resolution:yr.RESOLUTION},t),i.totalTicks=new ar(i.time.num_beats*(i.time.resolution/i.time.beat_value),1),i.resolutionMultiplier=1,i.tickables=[],i.ticksUsed=new ar(0,1),i.smallestTickCount=i.totalTicks.clone(),i.largestTickWidth=0,i.stave=null,i.mode=e.Mode.STRICT,i.voiceGroup=null,i}return ci(e,fr),gi(e,null,[{key:"Mode",get:function(){return{STRICT:1,SOFT:2,FULL:3}}}]),gi(e,[{key:"getTotalTicks",value:function(){return this.totalTicks}},{key:"getTicksUsed",value:function(){return this.ticksUsed}},{key:"getLargestTickWidth",value:function(){return this.largestTickWidth}},{key:"getSmallestTickCount",value:function(){return this.smallestTickCount}},{key:"getTickables",value:function(){return this.tickables}},{key:"getMode",value:function(){return this.mode}},{key:"setMode",value:function(t){return this.mode=t,this}},{key:"getResolutionMultiplier",value:function(){return this.resolutionMultiplier}},{key:"getActualResolution",value:function(){return this.resolutionMultiplier*this.time.resolution}},{key:"setStave",value:function(t){return this.stave=t,this.boundingBox=null,this}},{key:"getBoundingBox",value:function(){var t=void 0,e=void 0,i=void 0,n=void 0;if(!this.boundingBox){if(!this.stave)throw new or.RERR("NoStave","Can't get bounding box without stave.");for(t=this.stave,e=null,n=0;n<this.tickables.length;++n)this.tickables[n].setStave(t),(i=this.tickables[n].getBoundingBox())&&(e=e?e.mergeWith(i):i);this.boundingBox=e}return this.boundingBox}},{key:"getVoiceGroup",value:function(){if(!this.voiceGroup)throw new or.RERR("NoVoiceGroup","No voice group for voice.");return this.voiceGroup}},{key:"setVoiceGroup",value:function(t){return this.voiceGroup=t,this}},{key:"setStrict",value:function(t){return this.mode=t?e.Mode.STRICT:e.Mode.SOFT,this}},{key:"isComplete",value:function(){return this.mode!==e.Mode.STRICT&&this.mode!==e.Mode.FULL||this.ticksUsed.equals(this.totalTicks)}},{key:"addTickable",value:function(t){if(!t.shouldIgnoreTicks()){var i=t.getTicks();if(this.ticksUsed.add(i),(this.mode===e.Mode.STRICT||this.mode===e.Mode.FULL)&&this.ticksUsed.greaterThan(this.totalTicks))throw this.totalTicks.subtract(i),new or.RERR("BadArgument","Too many ticks.");i.lessThan(this.smallestTickCount)&&(this.smallestTickCount=i.clone()),this.resolutionMultiplier=this.ticksUsed.denominator,this.totalTicks.add(0,this.ticksUsed.denominator)}return this.tickables.push(t),t.setVoice(this),this}},{key:"addTickables",value:function(t){for(var e=0;e<t.length;++e)this.addTickable(t[e]);return this}},{key:"preFormat",value:function(){var t=this;return this.preFormatted?this:(this.tickables.forEach(function(e){e.getStave()||e.setStave(t.stave)}),this.preFormatted=!0,this)}},{key:"draw",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.context,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.stave;this.setRendered();for(var i=null,n=0;n<this.tickables.length;++n){var r=this.tickables[n];if(e&&r.setStave(e),!r.getStave())throw new or.RuntimeError("MissingStave","The voice cannot draw tickables without staves.");if(0===n&&(i=r.getBoundingBox()),n>0&&i){var o=r.getBoundingBox();o&&i.mergeWith(o)}r.setContext(t),r.draw()}this.boundingBox=i}}]),e}(),zr=function(t){function e(t,i){fi(this,e);var n=ni(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return n.setAttribute("type","StaveConnector"),n.thickness=yr.STAVE_LINE_THICKNESS,n.width=3,n.top_stave=t,n.bottom_stave=i,n.type=e.type.DOUBLE,n.font={family:"times",size:16,weight:"normal"},n.x_shift=0,n.texts=[],n}return ci(e,fr),gi(e,null,[{key:"type",get:function(){return{SINGLE_RIGHT:0,SINGLE_LEFT:1,SINGLE:1,DOUBLE:2,BRACE:3,BRACKET:4,BOLD_DOUBLE_LEFT:5,BOLD_DOUBLE_RIGHT:6,THIN_DOUBLE:7,NONE:8}}},{key:"typeString",get:function(){return{singleRight:e.type.SINGLE_RIGHT,singleLeft:e.type.SINGLE_LEFT,single:e.type.SINGLE,double:e.type.DOUBLE,brace:e.type.BRACE,bracket:e.type.BRACKET,boldDoubleLeft:e.type.BOLD_DOUBLE_LEFT,boldDoubleRight:e.type.BOLD_DOUBLE_RIGHT,thinDouble:e.type.THIN_DOUBLE,none:e.type.NONE}}}]),gi(e,[{key:"setType",value:function(t){return(t="string"==typeof t?e.typeString[t]:t)>=e.type.SINGLE_RIGHT&&t<=e.type.NONE&&(this.type=t),this}},{key:"setText",value:function(t,e){return this.texts.push({content:t,options:or.Merge({shift_x:0,shift_y:0},e)}),this}},{key:"setFont",value:function(t){or.Merge(this.font,t)}},{key:"setXShift",value:function(t){if("number"!=typeof t)throw or.RERR("InvalidType","x_shift must be a Number");return this.x_shift=t,this}},{key:"draw",value:function(){var t=this.checkContext();this.setRendered();var i=this.top_stave.getYForLine(0),n=this.bottom_stave.getYForLine(this.bottom_stave.getNumLines()-1)+this.thickness,r=this.width,o=this.top_stave.getX();(this.type===e.type.SINGLE_RIGHT||this.type===e.type.BOLD_DOUBLE_RIGHT||this.type===e.type.THIN_DOUBLE)&&(o=this.top_stave.getX()+this.top_stave.width);var s=n-i;switch(this.type){case e.type.SINGLE:case e.type.SINGLE_LEFT:case e.type.SINGLE_RIGHT:r=1;break;case e.type.DOUBLE:o-=this.width+2;break;case e.type.BRACE:r=12;var a=this.top_stave.getX()-2+this.x_shift,h=i,u=a,l=n,c=a-r,f=h+s/2,d=c-.9*r,v=h+.2*s,y=a+1.1*r,g=f-.135*s,p=y,_=f+.135*s,m=d,x=l-.2*s,b=c-r,k=x,w=a+.4*r,T=f+.135*s,S=w,E=f-.135*s,R=b,C=v;t.beginPath(),t.moveTo(a,h),t.bezierCurveTo(d,v,y,g,c,f),t.bezierCurveTo(p,_,m,x,u,l),t.bezierCurveTo(b,k,w,T,c,f),t.bezierCurveTo(S,E,R,C,a,h),t.fill(),t.stroke();break;case e.type.BRACKET:s=(n+=4)-(i-=4),vr.renderGlyph(t,o-5,i-3,40,"v1b",!0),vr.renderGlyph(t,o-5,n+3,40,"v10",!0),o-=this.width+2;break;case e.type.BOLD_DOUBLE_LEFT:O(t,this.type,o+this.x_shift,i,n);break;case e.type.BOLD_DOUBLE_RIGHT:O(t,this.type,o,i,n);break;case e.type.THIN_DOUBLE:r=1;break;case e.type.NONE:break;default:throw new or.RERR("InvalidType","The provided StaveConnector.type ("+this.type+") is invalid")}this.type!==e.type.BRACE&&this.type!==e.type.BOLD_DOUBLE_LEFT&&this.type!==e.type.BOLD_DOUBLE_RIGHT&&this.type!==e.type.NONE&&t.fillRect(o,i,r,s),this.type===e.type.THIN_DOUBLE&&t.fillRect(o-3,i,r,s),t.save(),t.lineWidth=2,t.setFont(this.font.family,this.font.size,this.font.weight);for(var N=0;N<this.texts.length;N++){var P=this.texts[N],A=t.measureText(""+P.content).width,L=this.top_stave.getX()-A-24+P.options.shift_x,M=(this.top_stave.getYForLine(0)+this.bottom_stave.getBottomLineY())/2+P.options.shift_y;t.fillText(""+P.content,L,M+4)}t.restore()}}]),e}(),Kr=function(t){function e(t){fi(this,e);var i=ni(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return i.setAttribute("type","FretHandFinger"),i.note=null,i.index=null,i.finger=t,i.width=7,i.position=br.Position.LEFT,i.x_shift=0,i.y_shift=0,i.x_offset=0,i.y_offset=0,i.font={family:"sans-serif",size:9,weight:"bold"},i}return ci(e,br),gi(e,null,[{key:"format",value:function(t,e){var i=e.left_shift,n=e.right_shift;if(!t||0===t.length)return!1;for(var r=[],o=null,s=0,a=0,h=0;h<t.length;++h){var u=t[h],l=u.getNote(),c=u.getPosition(),f=l.getKeyProps()[u.getIndex()];if(l!==o){for(var d=0;d<l.keys.length;++d){var v=l.getKeyProps()[d];0===i&&(s=v.displaced?l.getExtraLeftPx():s),0===n&&(a=v.displaced?l.getExtraRightPx():a)}o=l}r.push({note:l,num:u,pos:c,line:f.line,shiftL:s,shiftR:a})}r.sort(function(t,e){return e.line-t.line});for(var y=0,g=0,p=0,_=0,m=null,x=null,b=0;b<r.length;++b){var k=0,w=r[b],T=w.note,S=w.pos,E=w.num,R=w.line,C=w.shiftL,O=w.shiftR;R===m&&T===x||(y=i+C,g=n+O);var N=E.getWidth()+1;S===br.Position.LEFT?(E.setXShift(i+y),p=(k=i+N)>p?k:p):S===br.Position.RIGHT&&(E.setXShift(g),_=(k=a+N)>_?k:_),m=R,x=T}return e.left_shift+=p,e.right_shift+=_,!0}},{key:"CATEGORY",get:function(){return"frethandfinger"}}]),gi(e,[{key:"getCategory",value:function(){return e.CATEGORY}},{key:"setFretHandFinger",value:function(t){return this.finger=t,this}},{key:"setOffsetX",value:function(t){return this.x_offset=t,this}},{key:"setOffsetY",value:function(t){return this.y_offset=t,this}},{key:"draw",value:function(){if(this.checkContext(),!this.note||null==this.index)throw new or.RERR("NoAttachedNote","Can't draw string number without a note and index.");this.setRendered();var t=this.context,e=this.note.getModifierStartXY(this.position,this.index),i=e.x+this.x_shift+this.x_offset,n=e.y+this.y_shift+this.y_offset+5;switch(this.position){case br.Position.ABOVE:i-=4,n-=12;break;case br.Position.BELOW:i-=2,n+=10;break;case br.Position.LEFT:i-=this.width;break;case br.Position.RIGHT:i+=1;break;default:throw new or.RERR("InvalidPostion","The position "+this.position+" does not exist")}t.save(),t.setFont(this.font.family,this.font.size,this.font.weight),t.fillText(""+this.finger,i,n),t.restore()}}]),e}(),qr=function(t){function e(t){var i;fi(this,e);var n=ni(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return n.setAttribute("type","NoteSubGroup"),n.note=null,n.index=null,n.position=br.Position.LEFT,n.subNotes=t,n.subNotes.forEach(function(t){t.ignore_ticks=!1}),n.width=0,n.preFormatted=!1,n.formatter=new bo,n.voice=new Xr({num_beats:4,beat_value:4,resolution:yr.RESOLUTION}).setStrict(!1),n.voice.addTickables(n.subNotes),i=n,ni(n,i)}return ci(e,br),gi(e,null,[{key:"format",value:function(t,e){if(!t||0===t.length)return!1;for(var i=0,n=0;n<t.length;++n){var r=t[n];r.preFormat(),i+=r.getWidth()}return e.left_shift+=i,!0}},{key:"CATEGORY",get:function(){return"notesubgroup"}}]),gi(e,[{key:"getCategory",value:function(){return e.CATEGORY}},{key:"preFormat",value:function(){this.preFormatted||(this.formatter.joinVoices([this.voice]).format([this.voice],0),this.setWidth(this.formatter.getMinTotalWidth()),this.preFormatted=!0)}},{key:"setNote",value:function(t){this.note=t}},{key:"setWidth",value:function(t){this.width=t}},{key:"getWidth",value:function(){return this.width}},{key:"draw",value:function(){var t=this;this.checkContext();var e=this.getNote();if(!e||null===this.index)throw new or.RuntimeError("NoAttachedNote","Can't draw notes without a parent note and parent note index.");this.setRendered();!function(e,i){var n=i.getTickContext(),r=n.getExtraPx(),o=n.getX()-r.left-r.extraLeft+t.getSpacingFromNextModifier();e.forEach(function(t){var e=t.getTickContext(),n=e.getX();t.setStave(i.stave),e.setX(o+n)})}(this.subNotes,e,this.width),this.subNotes.forEach(function(e){return e.setContext(t.context).draw()})}}]),e}(),Jr=function(t){function e(t,i){fi(this,e);var n=ni(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return n.setAttribute("type","StaveTie"),n.notes=t,n.context=null,n.text=i,n.direction=null,n.render_options={cp1:8,cp2:12,text_shift_x:0,first_x_shift:0,last_x_shift:0,y_shift:7,tie_spacing:0,font:{family:"Arial",size:10,style:""}},n.font=n.render_options.font,n.setNotes(t),n}return ci(e,fr),gi(e,[{key:"setFont",value:function(t){return this.font=t,this}},{key:"setDirection",value:function(t){return this.direction=t,this}},{key:"setNotes",value:function(t){if(!t.first_note&&!t.last_note)throw new or.RuntimeError("BadArguments","Tie needs to have either first_note or last_note set.");if(t.first_indices||(t.first_indices=[0]),t.last_indices||(t.last_indices=[0]),t.first_indices.length!==t.last_indices.length)throw new or.RuntimeError("BadArguments","Tied notes must have similar index sizes");return this.first_note=t.first_note,this.first_indices=t.first_indices,this.last_note=t.last_note,this.last_indices=t.last_indices,this}},{key:"isPartial",value:function(){return!this.first_note||!this.last_note}},{key:"renderTie",value:function(t){if(0===t.first_ys.length||0===t.last_ys.length)throw new or.RERR("BadArguments","No Y-values to render");var e=this.context,i=this.render_options.cp1,n=this.render_options.cp2;Math.abs(t.last_x_px-t.first_x_px)<10&&(i=2,n=8);for(var r=this.render_options.first_x_shift,o=this.render_options.last_x_shift,s=this.render_options.y_shift*t.direction,a=0;a<this.first_indices.length;++a){var h=(t.last_x_px+o+(t.first_x_px+r))/2,u=t.first_ys[this.first_indices[a]]+s,l=t.last_ys[this.last_indices[a]]+s;if(isNaN(u)||isNaN(l))throw new or.RERR("BadArguments","Bad indices for tie rendering.");var c=(u+l)/2+i*t.direction,f=(u+l)/2+n*t.direction;e.beginPath(),e.moveTo(t.first_x_px+r,u),e.quadraticCurveTo(h,c,t.last_x_px+o,l),e.quadraticCurveTo(h,f,t.first_x_px+r,u),e.closePath(),e.fill()}}},{key:"renderText",value:function(t,e){if(this.text){var i=(t+e)/2;i-=this.context.measureText(this.text).width/2,this.context.save(),this.context.setFont(this.font.family,this.font.size,this.font.style),this.context.fillText(this.text,i+this.render_options.text_shift_x,(this.first_note||this.last_note).getStave().getYForTopText()-1),this.context.restore()}}},{key:"draw",value:function(){this.checkContext(),this.setRendered();var t=this.first_note,e=this.last_note,i=void 0,n=void 0,r=void 0,o=void 0,s=void 0;return t?(i=t.getTieRightX()+this.render_options.tie_spacing,s=t.getStemDirection(),r=t.getYs()):(i=e.getStave().getTieStartX(),r=e.getYs(),this.first_indices=this.last_indices),e?(n=e.getTieLeftX()+this.render_options.tie_spacing,s=e.getStemDirection(),o=e.getYs()):(n=t.getStave().getTieEndX(),o=t.getYs(),this.last_indices=this.first_indices),this.direction&&(s=this.direction),this.renderTie({first_x_px:i,last_x_px:n,first_ys:r,last_ys:o,direction:s}),this.renderText(i,n),!0}}]),e}(),Qr=function(t){function e(t,i){fi(this,e);var n=ni(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,i));return n.setAttribute("type","TabTie"),n.render_options.cp1=9,n.render_options.cp2=11,n.render_options.y_shift=3,n.setNotes(t),n}return ci(e,Jr),gi(e,null,[{key:"createHammeron",value:function(t){return new e(t,"H")}},{key:"createPulloff",value:function(t){return new e(t,"P")}}]),gi(e,[{key:"draw",value:function(){this.checkContext(),this.setRendered();var t=this.first_note,e=this.last_note,i=void 0,n=void 0,r=void 0,o=void 0;return t?(i=t.getTieRightX()+this.render_options.tie_spacing,r=t.getYs()):(i=e.getStave().getTieStartX(),r=e.getYs(),this.first_indices=this.last_indices),e?(n=e.getTieLeftX()+this.render_options.tie_spacing,o=e.getYs()):(n=t.getStave().getTieEndX(),o=t.getYs(),this.last_indices=this.first_indices),this.renderTie({first_x_px:i,last_x_px:n,first_ys:r,last_ys:o,direction:-1}),this.renderText(i,n),!0}}]),e}(),Zr=function(t){function e(t,i){var n;fi(this,e);var r=ni(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return r.setAttribute("type","GraceNoteGroup"),r.note=null,r.index=null,r.position=br.Position.LEFT,r.grace_notes=t,r.width=0,r.preFormatted=!1,r.show_slur=i,r.slur=null,r.formatter=new bo,r.voice=new Xr({num_beats:4,beat_value:4,resolution:yr.RESOLUTION}).setStrict(!1),r.render_options={slur_y_shift:0},r.voice.addTickables(r.grace_notes),n=r,ni(r,n)}return ci(e,br),gi(e,null,[{key:"format",value:function(t,e){if(!t||0===t.length)return!1;for(var i=[],n=null,r=0,o=0;o<t.length;++o){var s=t[o],a=s.getNote(),h=a.getCategory()===wr.CATEGORY,u=h?4:0;if(h&&a!==n){for(var l=0;l<a.keys.length;++l){r=a.getKeyProps()[l].displaced?a.getExtraLeftPx():r}n=a}i.push({shift:r,gracenote_group:s,spacing:u})}for(var c=i[0].shift,f=void 0,d=0;d<i.length;++d){var v=i[d].gracenote_group;v.preFormat(),f=v.getWidth()+i[d].spacing,c=Math.max(f,c)}for(var y=0;y<i.length;++y){var g=i[y].gracenote_group;f=g.getWidth()+i[y].spacing,g.setSpacingFromNextModifier(c-Math.min(f,c))}return e.left_shift+=c,!0}},{key:"CATEGORY",get:function(){return"gracenotegroups"}}]),gi(e,[{key:"getCategory",value:function(){return e.CATEGORY}},{key:"preFormat",value:function(){this.preFormatted||(this.formatter.joinVoices([this.voice]).format([this.voice],0),this.setWidth(this.formatter.getMinTotalWidth()),this.preFormatted=!0)}},{key:"beamNotes",value:function(){if(this.grace_notes.length>1){var t=new wo(this.grace_notes);t.render_options.beam_width=3,t.render_options.partial_beam_length=4,this.beam=t}return this}},{key:"setNote",value:function(t){this.note=t}},{key:"setWidth",value:function(t){this.width=t}},{key:"getWidth",value:function(){return this.width}},{key:"getGraceNotes",value:function(){return this.grace_notes}},{key:"draw",value:function(){var t=this;this.checkContext();var e=this.getNote();if(function(){for(var t=arguments,e=arguments.length,i=Array(e),n=0;n<e;n++)i[n]=t[n];Zr.DEBUG&&or.L("Vex.Flow.GraceNoteGroup",i)}("Drawing grace note group for:",e),!e||null===this.index)throw new or.RuntimeError("NoAttachedNote","Can't draw grace note without a parent note and parent note index.");this.setRendered();var i=this;if(function(t,e){var n=e.getTickContext(),r=n.getExtraPx(),o=n.getX()-r.left-r.extraLeft+i.getSpacingFromNextModifier();t.forEach(function(t){var i=t.getTickContext(),n=i.getX();t.setStave(e.stave),i.setX(o+n)})}(this.grace_notes,e,this.width),this.grace_notes.forEach(function(e){e.setContext(t.context).draw()}),this.beam&&this.beam.setContext(this.context).draw(),this.show_slur){var n=this.getNote().getCategory()===wr.CATEGORY,r=n?Jr:Qr;this.slur=new r({last_note:this.grace_notes[0],first_note:e,first_indices:[0],last_indices:[0]}),this.slur.render_options.cp2=12,this.slur.render_options.y_shift=(n?7:5)+this.render_options.slur_y_shift,this.slur.setContext(this.context).draw()}}}]),e}(),$r=function(t){function e(t,i){fi(this,e);var n=ni(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return n.setAttribute("type","Stroke"),n.note=null,n.options=or.Merge({},i),n.all_voices=!("all_voices"in n.options)||n.options.all_voices,n.note_end=null,n.index=null,n.type=t,n.position=br.Position.LEFT,n.render_options={font_scale:38,stroke_px:3,stroke_spacing:10},n.font={family:"serif",size:10,weight:"bold italic"},n.setXShift(0),n.setWidth(10),n}return ci(e,br),gi(e,null,[{key:"format",value:function(t,e){var i=e.left_shift;if(!t||0===t.length)return this;var n=i,r=t.map(function(t){var e=t.getNote();if(e instanceof wr){var i=e.getKeyProps()[t.getIndex()];return{line:i.line,shift:i.displaced?e.getExtraLeftPx():0,stroke:t}}return{line:e.getPositions()[t.getIndex()].str,shift:0,stroke:t}}).reduce(function(t,e){var i=e.stroke,r=e.shift;return i.setXShift(n+r),Math.max(i.getWidth()+0,t)},0);return e.left_shift+=r,!0}},{key:"CATEGORY",get:function(){return"strokes"}},{key:"Type",get:function(){return{BRUSH_DOWN:1,BRUSH_UP:2,ROLL_DOWN:3,ROLL_UP:4,RASQUEDO_DOWN:5,RASQUEDO_UP:6}}}]),gi(e,[{key:"getCategory",value:function(){return e.CATEGORY}},{key:"getPosition",value:function(){return this.position}},{key:"addEndNote",value:function(t){return this.note_end=t,this}},{key:"draw",value:function(){if(this.checkContext(),this.setRendered(),!this.note||null==this.index)throw new or.RERR("NoAttachedNote","Can't draw stroke without a note and index.");for(var t=this.note.getModifierStartXY(this.position,this.index),i=this.note.getYs(),n=t.y,r=t.y,o=t.x-5,s=this.note.stave.options.spacing_between_lines_px,a=this.getModifierContext().getModifiers(this.note.getCategory()),h=0;h<a.length;h++){i=a[h].getYs();for(var u=0;u<i.length;u++)(this.note===a[h]||this.all_voices)&&(n=or.Min(n,i[u]),r=or.Max(r,i[u]))}var l=void 0,c=void 0,f=void 0,d=void 0,v=void 0;switch(this.type){case e.Type.BRUSH_DOWN:l="vc3",c=-3,f=n-s/2+10,r+=s/2;break;case e.Type.BRUSH_UP:l="v11",c=.5,f=r+s/2,n-=s/2;break;case e.Type.ROLL_DOWN:case e.Type.RASQUEDO_DOWN:l="vc3",c=-3,d=this.x_shift+c-2,this.note instanceof wr?(f=(n+=1.5*s)-s,v=(r+=(r-n)%2!=0?.5*s:s)+s+2):(f=(n+=1.5*s)-.75*s,v=(r+=s)+.25*s);break;case e.Type.ROLL_UP:case e.Type.RASQUEDO_UP:l="v52",c=-4,d=this.x_shift+c-1,this.note instanceof wr?(f=s/2,(r-(n+=.5*s))%2==0&&(r+=s/2),f=r+.5*s,v=n-1.25*s):(f=(r+=.5*s)+.25*s,v=(n+=.25*s)-s);break;default:throw new or.RERR("InvalidType","The stroke type "+this.type+" does not exist")}if(this.type===e.Type.BRUSH_DOWN||this.type===e.Type.BRUSH_UP)this.context.fillRect(o+this.x_shift,n,1,r-n);else if(this.note instanceof wr)for(var y=n;y<=r;y+=s)vr.renderGlyph(this.context,o+this.x_shift-4,y,this.render_options.font_scale,"va3");else{var g=void 0;for(g=n;g<=r;g+=10)vr.renderGlyph(this.context,o+this.x_shift-4,g,this.render_options.font_scale,"va3");this.type===e.Type.RASQUEDO_DOWN&&(v=g+.25*s)}vr.renderGlyph(this.context,o+this.x_shift+c,f,this.render_options.font_scale,l),this.type!==e.Type.RASQUEDO_DOWN&&this.type!==e.Type.RASQUEDO_UP||(this.context.save(),this.context.setFont(this.font.family,this.font.size,this.font.weight),this.context.fillText("R",o+d,v),this.context.restore())}}]),e}(),to=function(){function t(e){fi(this,t),this.vexFlowCanvasContext=e,e.canvas?this.canvas=e.canvas:this.canvas={width:t.WIDTH,height:t.HEIGHT}}return gi(t,null,[{key:"WIDTH",get:function(){return 600}},{key:"HEIGHT",get:function(){return 400}}]),gi(t,[{key:"clear",value:function(){this.vexFlowCanvasContext.clearRect(0,0,this.canvas.width,this.canvas.height)}},{key:"openGroup",value:function(){}},{key:"closeGroup",value:function(){}},{key:"add",value:function(){}},{key:"setFont",value:function(t,e,i){return this.vexFlowCanvasContext.font=(i||"")+" "+e+"pt "+t,this}},{key:"setRawFont",value:function(t){return this.vexFlowCanvasContext.font=t,this}},{key:"setFillStyle",value:function(t){return this.vexFlowCanvasContext.fillStyle=t,this}},{key:"setBackgroundFillStyle",value:function(t){return this.background_fillStyle=t,this}},{key:"setStrokeStyle",value:function(t){return this.vexFlowCanvasContext.strokeStyle=t,this}},{key:"setShadowColor",value:function(t){return this.vexFlowCanvasContext.shadowColor=t,this}},{key:"setShadowBlur",value:function(t){return this.vexFlowCanvasContext.shadowBlur=t,this}},{key:"setLineWidth",value:function(t){return this.vexFlowCanvasContext.lineWidth=t,this}},{key:"setLineCap",value:function(t){return this.vexFlowCanvasContext.lineCap=t,this}},{key:"setLineDash",value:function(t){return this.vexFlowCanvasContext.lineDash=t,this}},{key:"scale",value:function(t,e){return this.vexFlowCanvasContext.scale(parseFloat(t),parseFloat(e))}},{key:"resize",value:function(t,e){return this.vexFlowCanvasContext.resize(parseInt(t,10),parseInt(e,10))}},{key:"rect",value:function(t,e,i,n){return this.vexFlowCanvasContext.rect(t,e,i,n)}},{key:"fillRect",value:function(t,e,i,n){return this.vexFlowCanvasContext.fillRect(t,e,i,n)}},{key:"clearRect",value:function(t,e,i,n){return this.vexFlowCanvasContext.clearRect(t,e,i,n)}},{key:"beginPath",value:function(){return this.vexFlowCanvasContext.beginPath()}},{key:"moveTo",value:function(t,e){return this.vexFlowCanvasContext.moveTo(t,e)}},{key:"lineTo",value:function(t,e){return this.vexFlowCanvasContext.lineTo(t,e)}},{key:"bezierCurveTo",value:function(t,e,i,n,r,o){return this.vexFlowCanvasContext.bezierCurveTo(t,e,i,n,r,o)}},{key:"quadraticCurveTo",value:function(t,e,i,n){return this.vexFlowCanvasContext.quadraticCurveTo(t,e,i,n)}},{key:"arc",value:function(t,e,i,n,r,o){return this.vexFlowCanvasContext.arc(t,e,i,n,r,o)}},{key:"glow",value:function(){return this.vexFlowCanvasContext.glow()}},{key:"fill",value:function(){return this.vexFlowCanvasContext.fill()}},{key:"stroke",value:function(){return this.vexFlowCanvasContext.stroke()}},{key:"closePath",value:function(){return this.vexFlowCanvasContext.closePath()}},{key:"measureText",value:function(t){return this.vexFlowCanvasContext.measureText(t)}},{key:"fillText",value:function(t,e,i){return this.vexFlowCanvasContext.fillText(t,e,i)}},{key:"save",value:function(){return this.vexFlowCanvasContext.save()}},{key:"restore",value:function(){return this.vexFlowCanvasContext.restore()}}]),t}(),eo=function(){function t(e){fi(this,t),this.element=e,this.paper=Raphael(e),this.path="",this.pen={x:0,y:0},this.lineWidth=1,this.state={scale:{x:1,y:1},font_family:"Arial",font_size:8,font_weight:800},this.attributes={"stroke-width":.3,fill:"black",stroke:"black",font:"10pt Arial"},this.background_attributes={"stroke-width":0,fill:"white",stroke:"white",font:"10pt Arial"},this.shadow_attributes={width:0,color:"black"},this.state_stack=[]}return gi(t,[{key:"openGroup",value:function(){}},{key:"closeGroup",value:function(){}},{key:"add",value:function(){}},{key:"setFont",value:function(t,e,i){return this.state.font_family=t,this.state.font_size=e,this.state.font_weight=i,this.attributes.font=(this.state.font_weight||"")+" "+this.state.font_size*this.state.scale.x+"pt "+this.state.font_family,this}},{key:"setRawFont",value:function(t){return this.attributes.font=t,this}},{key:"setFillStyle",value:function(t){return this.attributes.fill=t,this}},{key:"setBackgroundFillStyle",value:function(t){return this.background_attributes.fill=t,this.background_attributes.stroke=t,this}},{key:"setStrokeStyle",value:function(t){return this.attributes.stroke=t,this}},{key:"setShadowColor",value:function(t){return this.shadow_attributes.color=t,this}},{key:"setShadowBlur",value:function(t){return this.shadow_attributes.width=t,this}},{key:"setLineWidth",value:function(t){this.attributes["stroke-width"]=t,this.lineWidth=t}},{key:"setLineDash",value:function(){return this}},{key:"setLineCap",value:function(){return this}},{key:"scale",value:function(t,e){return this.state.scale={x:t,y:e},this.attributes.transform="S"+t+","+e+",0,0",this.attributes.scale=t+","+e+",0,0",this.attributes.font=this.state.font_size*this.state.scale.x+"pt "+this.state.font_family,this.background_attributes.transform="S"+t+","+e+",0,0",this.background_attributes.font=this.state.font_size*this.state.scale.x+"pt "+this.state.font_family,this}},{key:"clear",value:function(){this.paper.clear()}},{key:"resize",value:function(t,e){return this.element.style.width=t,this.paper.setSize(t,e),this}},{key:"setViewBox",value:function(t){this.paper.canvas.setAttribute("viewBox",t)}},{key:"rect",value:function(t,e,i,n){return n<0&&(e+=n,n=-n),this.paper.rect(t,e,i-.5,n-.5).attr(this.attributes).attr("fill","none").attr("stroke-width",this.lineWidth),this}},{key:"fillRect",value:function(t,e,i,n){return n<0&&(e+=n,n=-n),this.paper.rect(t,e,i-.5,n-.5).attr(this.attributes),this}},{key:"clearRect",value:function(t,e,i,n){return n<0&&(e+=n,n=-n),this.paper.rect(t,e,i-.5,n-.5).attr(this.background_attributes),this}},{key:"beginPath",value:function(){return this.path="",this.pen.x=0,this.pen.y=0,this}},{key:"moveTo",value:function(t,e){return this.path+="M"+t+","+e,this.pen.x=t,this.pen.y=e,this}},{key:"lineTo",value:function(t,e){return this.path+="L"+t+","+e,this.pen.x=t,this.pen.y=e,this}},{key:"bezierCurveTo",value:function(t,e,i,n,r,o){return this.path+="C"+t+","+e+","+i+","+n+","+r+","+o,this.pen.x=r,this.pen.y=o,this}},{key:"quadraticCurveTo",value:function(t,e,i,n){return this.path+="Q"+t+","+e+","+i+","+n,this.pen.x=i,this.pen.y=n,this}},{key:"arc",value:function(t,e,i,n,r,o){function s(t){for(;t<0;)t+=2*Math.PI;for(;t>2*Math.PI;)t-=2*Math.PI;return t}if(n=s(n),r=s(r),n>r){var a=n;n=r,r=a,o=!o}var h=r-n;return h>Math.PI?(this.arcHelper(t,e,i,n,n+h/2,o),this.arcHelper(t,e,i,n+h/2,r,o)):this.arcHelper(t,e,i,n,r,o),this}},{key:"arcHelper",value:function(t,e,i,n,r,o){var s=t+i*Math.cos(n),a=e+i*Math.sin(n),h=t+i*Math.cos(r),u=e+i*Math.sin(r),l=0,c=0;o?(c=1,r-n<Math.PI&&(l=1)):r-n>Math.PI&&(l=1),this.path+="M"+s+","+a+",A"+i+","+i+",0,"+l+","+c+","+h+","+u+"M"+this.pen.x+","+this.pen.y}},{key:"glow",value:function(){var t=this.paper.set();if(this.shadow_attributes.width>0)for(var e=this.shadow_attributes,i=e.width/2,n=1;n<=i;n++)t.push(this.paper.path(this.path).attr({stroke:e.color,"stroke-linejoin":"round","stroke-linecap":"round","stroke-width":+(e.width/i*n).toFixed(3),opacity:+((e.opacity||.3)/i).toFixed(3),transform:this.attributes.transform,scale:this.attributes.scale}));return t}},{key:"fill",value:function(){var t=this.paper.path(this.path).attr(this.attributes).attr("stroke-width",0);return this.glow(t),this}},{key:"stroke",value:function(){var t=this.lineWidth*(this.state.scale.x+this.state.scale.y)/2,e=this.paper.path(this.path).attr(this.attributes).attr("fill","none").attr("stroke-width",t);return this.glow(e),this}},{key:"closePath",value:function(){return this.path+="Z",this}},{key:"measureText",value:function(t){var e=this.paper.text(0,0,t).attr(this.attributes).attr("fill","none").attr("stroke","none"),i=e.getBBox();return e.remove(),{width:i.width,height:i.height}}},{key:"fillText",value:function(t,e,i){return this.paper.text(e+this.measureText(t).width/2,i-this.state.font_size/(2.25*this.state.scale.y),t).attr(this.attributes),this}},{key:"save",value:function(){return this.state_stack.push({state:{font_family:this.state.font_family},attributes:{font:this.attributes.font,fill:this.attributes.fill,stroke:this.attributes.stroke,"stroke-width":this.attributes["stroke-width"]},shadow_attributes:{width:this.shadow_attributes.width,color:this.shadow_attributes.color}}),this}},{key:"restore",value:function(){var t=this.state_stack.pop();return this.state.font_family=t.state.font_family,this.attributes.font=t.attributes.font,this.attributes.fill=t.attributes.fill,this.attributes.stroke=t.attributes.stroke,this.attributes["stroke-width"]=t.attributes["stroke-width"],this.shadow_attributes.width=t.shadow_attributes.width,this.shadow_attributes.color=t.shadow_attributes.color,this}}]),t}(),io=function(){function t(e){fi(this,t),this.element=e,this.svgNS="http://www.w3.org/2000/svg";var i=this.create("svg");this.element.appendChild(i),this.svg=i,this.groups=[this.svg],this.parent=this.svg,this.path="",this.pen={x:0,y:0},this.lineWidth=1,this.state={scale:{x:1,y:1},"font-family":"Arial","font-size":"8pt","font-weight":"normal"},this.attributes={"stroke-width":.3,fill:"black",stroke:"black","stroke-dasharray":"none","font-family":"Arial","font-size":"10pt","font-weight":"normal","font-style":"normal"},this.background_attributes={"stroke-width":0,fill:"white",stroke:"white","stroke-dasharray":"none","font-family":"Arial","font-size":"10pt","font-weight":"normal","font-style":"normal"},this.shadow_attributes={width:0,color:"black"},this.state_stack=[],this.iePolyfill()}return gi(t,[{key:"create",value:function(t){return document.createElementNS(this.svgNS,t)}},{key:"openGroup",value:function(t,e,i){var n=this.create("g");return this.groups.push(n),this.parent.appendChild(n),this.parent=n,t&&n.setAttribute("class",or.Prefix(t)),e&&n.setAttribute("id",or.Prefix(e)),i&&i.pointerBBox&&n.setAttribute("pointer-events","bounding-box"),n}},{key:"closeGroup",value:function(){this.groups.pop(),this.parent=this.groups[this.groups.length-1]}},{key:"add",value:function(t){this.parent.appendChild(t)}},{key:"iePolyfill",value:function(){"undefined"!=typeof navigator&&(this.ie=/MSIE 9/i.test(navigator.userAgent)||/MSIE 10/i.test(navigator.userAgent)||/rv:11\.0/i.test(navigator.userAgent)||/Trident/i.test(navigator.userAgent))}},{key:"setFont",value:function(t,e,i){var n=!1,r=!1,o="normal";"string"==typeof i&&(-1!==i.indexOf("italic")&&(i=i.replace(/italic/g,""),r=!0),-1!==i.indexOf("bold")&&(i=i.replace(/bold/g,""),n=!0),i=i.replace(/ /g,""));var s={"font-family":t,"font-size":e+"pt","font-weight":i=void 0===(i=n?"bold":i)||""===i?"normal":i,"font-style":o=r?"italic":o};return this.fontSize=Number(e),or.Merge(this.attributes,s),or.Merge(this.state,s),this}},{key:"setRawFont",value:function(t){var e=(t=t.trim()).split(" ");return this.attributes["font-family"]=e[1],this.state["font-family"]=e[1],this.attributes["font-size"]=e[0],this.state["font-size"]=e[0],this.fontSize=Number(e[0].match(/\d+/)),this}},{key:"setFillStyle",value:function(t){return this.attributes.fill=t,this}},{key:"setBackgroundFillStyle",value:function(t){return this.background_attributes.fill=t,this.background_attributes.stroke=t,this}},{key:"setStrokeStyle",value:function(t){return this.attributes.stroke=t,this}},{key:"setShadowColor",value:function(t){return this.shadow_attributes.color=t,this}},{key:"setShadowBlur",value:function(t){return this.shadow_attributes.width=t,this}},{key:"setLineWidth",value:function(t){this.attributes["stroke-width"]=t,this.lineWidth=t}},{key:"setLineDash",value:function(t){if("[object Array]"===Object.prototype.toString.call(t))return t=t.join(", "),this.attributes["stroke-dasharray"]=t,this;throw new or.RERR("ArgumentError","lineDash must be an array of integers.")}},{key:"setLineCap",value:function(t){return this.attributes["stroke-linecap"]=t,this}},{key:"resize",value:function(t,e){this.width=t,this.height=e,this.element.style.width=t;var i={width:t,height:e};return this.applyAttributes(this.svg,i),this}},{key:"scale",value:function(t,e){this.state.scale={x:t,y:e};var i=this.width/t,n=this.height/e;return this.setViewBox(0,0,i,n),this}},{key:"setViewBox",value:function(){for(var t=arguments,e=arguments.length,i=Array(e),n=0;n<e;n++)i[n]=t[n];if(1===i.length){var r=i[0];this.svg.setAttribute("viewBox",r)}else{var o=i[0]+" "+i[1]+" "+i[2]+" "+i[3];this.svg.setAttribute("viewBox",o)}}},{key:"applyAttributes",value:function(t,e){return Object.keys(e).forEach(function(i){return t.setAttributeNS(null,i,e[i])}),t}},{key:"clear",value:function(){for(;this.svg.lastChild;)this.svg.removeChild(this.svg.lastChild);this.scale(this.state.scale.x,this.state.scale.y)}},{key:"rect",value:function(t,e,i,n,r){n<0&&(e+=n,n*=-1);var o=this.create("rect");return void 0===r&&(r={fill:"none","stroke-width":this.lineWidth,stroke:"black"}),or.Merge(r,{x:t,y:e,width:i,height:n}),this.applyAttributes(o,r),this.add(o),this}},{key:"fillRect",value:function(t,e,i,n){return n<0&&(e+=n,n*=-1),this.rect(t,e,i,n,this.attributes),this}},{key:"clearRect",value:function(t,e,i,n){return this.rect(t,e,i,n,this.background_attributes),this}},{key:"beginPath",value:function(){return this.path="",this.pen.x=0,this.pen.y=0,this}},{key:"moveTo",value:function(t,e){return this.path+="M"+t+" "+e,this.pen.x=t,this.pen.y=e,this}},{key:"lineTo",value:function(t,e){return this.path+="L"+t+" "+e,this.pen.x=t,this.pen.y=e,this}},{key:"bezierCurveTo",value:function(t,e,i,n,r,o){return this.path+="C"+t+" "+e+","+i+" "+n+","+r+" "+o,this.pen.x=r,this.pen.y=o,this}},{key:"quadraticCurveTo",value:function(t,e,i,n){return this.path+="Q"+t+" "+e+","+i+" "+n,this.pen.x=i,this.pen.y=n,this}},{key:"arc",value:function(t,e,i,n,r,o){function s(t){for(;t<0;)t+=2*Math.PI;for(;t>2*Math.PI;)t-=2*Math.PI;return t}if(n=s(n),r=s(r),n>r){var a=n;n=r,r=a,o=!o}var h=r-n;return h>Math.PI?(this.arcHelper(t,e,i,n,n+h/2,o),this.arcHelper(t,e,i,n+h/2,r,o)):this.arcHelper(t,e,i,n,r,o),this}},{key:"arcHelper",value:function(t,e,i,n,r,o){var s=t+i*Math.cos(n),a=e+i*Math.sin(n),h=t+i*Math.cos(r),u=e+i*Math.sin(r),l=0,c=0;o?(c=1,r-n<Math.PI&&(l=1)):r-n>Math.PI&&(l=1),this.path+="M"+s+" "+a+" A"+i+" "+i+" 0 "+l+" "+c+" "+h+" "+u+"M"+this.pen.x+" "+this.pen.y}},{key:"closePath",value:function(){return this.path+="Z",this}},{key:"glow",value:function(){if(this.shadow_attributes.width>0)for(var t=this.shadow_attributes,e=t.width/2,i=1;i<=e;i++){var n={stroke:t.color,"stroke-linejoin":"round","stroke-linecap":"round","stroke-width":+(.4*t.width/e*i).toFixed(3),opacity:+((t.opacity||.3)/e).toFixed(3)},r=this.create("path");n.d=this.path,this.applyAttributes(r,n),this.add(r)}return this}},{key:"fill",value:function(t){this.glow();var e=this.create("path");return void 0===t&&(t={},or.Merge(t,this.attributes),t.stroke="none"),t.d=this.path,this.applyAttributes(e,t),this.add(e),this}},{key:"stroke",value:function(){this.glow();var t=this.create("path"),e={};return or.Merge(e,this.attributes),e.fill="none",e["stroke-width"]=this.lineWidth,e.d=this.path,this.applyAttributes(t,e),this.add(t),this}},{key:"measureText",value:function(t){var e=this.create("text");if("function"!=typeof e.getBBox)return{x:0,y:0,width:0,height:0};e.textContent=t,this.applyAttributes(e,this.attributes),this.svg.appendChild(e);var i=e.getBBox();return this.ie&&""!==t&&"italic"===this.attributes["font-style"]&&(i=this.ieMeasureTextFix(i,t)),this.svg.removeChild(e),i}},{key:"ieMeasureTextFix",value:function(t){var e=1.196*Number(this.fontSize)+1.9598,i=t.width-e,n=t.height-1.5;return{x:t.x,y:t.y,width:i,height:n}}},{key:"fillText",value:function(t,e,i){var n={};or.Merge(n,this.attributes),n.stroke="none",n.x=e,n.y=i;var r=this.create("text");r.textContent=t,this.applyAttributes(r,n),this.add(r)}},{key:"save",value:function(){return this.state_stack.push({state:{"font-family":this.state["font-family"],"font-weight":this.state["font-weight"],"font-style":this.state["font-style"],"font-size":this.state["font-size"]},attributes:{"font-family":this.attributes["font-family"],"font-weight":this.attributes["font-weight"],"font-style":this.attributes["font-style"],"font-size":this.attributes["font-size"],fill:this.attributes.fill,stroke:this.attributes.stroke,"stroke-width":this.attributes["stroke-width"],"stroke-dasharray":this.attributes["stroke-dasharray"]},shadow_attributes:{width:this.shadow_attributes.width,color:this.shadow_attributes.color}}),this}},{key:"restore",value:function(){var t=this.state_stack.pop();return this.state["font-family"]=t.state["font-family"],this.state["font-weight"]=t.state["font-weight"],this.state["font-style"]=t.state["font-style"],this.state["font-size"]=t.state["font-size"],this.attributes["font-family"]=t.attributes["font-family"],this.attributes["font-weight"]=t.attributes["font-weight"],this.attributes["font-style"]=t.attributes["font-style"],this.attributes["font-size"]=t.attributes["font-size"],this.attributes.fill=t.attributes.fill,this.attributes.stroke=t.attributes.stroke,this.attributes["stroke-width"]=t.attributes["stroke-width"],this.attributes["stroke-dasharray"]=t.attributes["stroke-dasharray"],this.shadow_attributes.width=t.shadow_attributes.width,this.shadow_attributes.color=t.shadow_attributes.color,this}}]),t}(),no=null,ro=function(){function t(e,i){if(fi(this,t),this.elementId=e,!this.elementId)throw new or.RERR("BadArgument","Invalid id for renderer.");if(this.element=document.getElementById(e),this.element||(this.element=e),this.ctx=null,this.paper=null,this.backend=i,this.backend===t.Backends.CANVAS){if(!this.element.getContext)throw new or.RERR("BadElement","Can't get canvas context from element: "+e);this.ctx=t.bolsterCanvasContext(this.element.getContext("2d"))}else if(this.backend===t.Backends.RAPHAEL)this.ctx=new eo(this.element);else{if(this.backend!==t.Backends.SVG)throw new or.RERR("InvalidBackend","No support for backend: "+this.backend);this.ctx=new io(this.element)}}return gi(t,null,[{key:"buildContext",value:function(e,i,n,r,o){var s=new t(e,i);n&&r&&s.resize(n,r),o||(o="#FFF");var a=s.getContext();return a.setBackgroundFillStyle(o),t.lastContext=a,a}},{key:"getCanvasContext",value:function(e,i,n,r){return t.buildContext(e,t.Backends.CANVAS,i,n,r)}},{key:"getRaphaelContext",value:function(e,i,n,r){return t.buildContext(e,t.Backends.RAPHAEL,i,n,r)}},{key:"getSVGContext",value:function(e,i,n,r){return t.buildContext(e,t.Backends.SVG,i,n,r)}},{key:"bolsterCanvasContext",value:function(e){if(t.USE_CANVAS_PROXY)return new to(e);return e.vexFlowCanvasContext=e,["clear","setFont","setRawFont","setFillStyle","setBackgroundFillStyle","setStrokeStyle","setShadowColor","setShadowBlur","setLineWidth","setLineCap","setLineDash","openGroup","closeGroup","getGroup"].forEach(function(t){e[t]=e[t]||to.prototype[t]}),e}},{key:"drawDashedLine",value:function(t,e,i,n,r,o){t.beginPath();var s=n-e,a=r-i,h=Math.atan2(a,s),u=e,l=i;t.moveTo(e,i);for(var c=0,f=!0;!(s<0?u<=n:u>=n)||!(a<0?l<=r:l>=r);){var d=o[c++%o.length],v=u+Math.cos(h)*d;u=s<0?Math.max(n,v):Math.min(n,v);var y=l+Math.sin(h)*d;l=a<0?Math.max(r,y):Math.min(r,y),f?t.lineTo(u,l):t.moveTo(u,l),f=!f}t.closePath(),t.stroke()}},{key:"Backends",get:function(){return{CANVAS:1,RAPHAEL:2,SVG:3,VML:4}}},{key:"LineEndType",get:function(){return{NONE:1,UP:2,DOWN:3}}},{key:"USE_CANVAS_PROXY",get:function(){return!1}},{key:"lastContext",get:function(){return no},set:function(t){no=t}}]),gi(t,[{key:"resize",value:function(e,i){if(this.backend===t.Backends.CANVAS){if(!this.element.getContext)throw new or.RERR("BadElement","Can't get canvas context from element: "+this.elementId);var n=window.devicePixelRatio||1;this.element.width=e*n,this.element.height=i*n,this.element.style.width=e+"px",this.element.style.height=i+"px",this.ctx=t.bolsterCanvasContext(this.element.getContext("2d")),this.ctx.scale(n,n)}else this.ctx.resize(e,i);return this}},{key:"getContext",value:function(){return this.ctx}}]),t}(),oo=function(t){function e(t){fi(this,e);var i=ni(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return i.setAttribute("type","StringNumber"),i.note=null,i.last_note=null,i.index=null,i.string_number=t,i.setWidth(20),i.position=br.Position.ABOVE,i.x_shift=0,i.y_shift=0,i.x_offset=0,i.y_offset=0,i.dashed=!0,i.leg=ro.LineEndType.NONE,i.radius=8,i.font={family:"sans-serif",size:10,weight:"bold"},i}return ci(e,br),gi(e,null,[{key:"format",value:function(t,e){var i=e.left_shift,n=e.right_shift;if(!t||0===t.length)return this;var r=[],o=null,s=0,a=0,h=void 0,u=void 0,l=void 0,c=void 0,f=void 0;for(h=0;h<t.length;++h)for(l=(u=t[h]).getNote(),h=0;h<t.length;++h){l=(u=t[h]).getNote(),c=u.getPosition();var d=l.getKeyProps()[u.getIndex()];if(l!==o){for(var v=0;v<l.keys.length;++v)f=l.getKeyProps()[v],0===i&&(s=f.displaced?l.getExtraLeftPx():s),0===n&&(a=f.displaced?l.getExtraRightPx():a);o=l}r.push({pos:c,note:l,num:u,line:d.line,shiftL:s,shiftR:a})}r.sort(function(t,e){return e.line-t.line});var y=0,g=0,p=0,_=null,m=null;for(h=0;h<r.length;++h){var x=0;l=r[h].note,c=r[h].pos,u=r[h].num;var b=r[h].line,k=r[h].shiftR;b===_&&l===m||(y=n+k);var w=u.getWidth()+1;c===br.Position.LEFT?(u.setXShift(i),g=(x=s+w)>g?x:g):c===br.Position.RIGHT&&(u.setXShift(y),p=(x+=w)>p?x:p),_=b,m=l}return e.left_shift+=g,e.right_shift+=p,!0}},{key:"CATEGORY",get:function(){return"stringnumber"}}]),gi(e,[{key:"getCategory",value:function(){return e.CATEGORY}},{key:"getNote",value:function(){return this.note}},{key:"setNote",value:function(t){return this.note=t,this}},{key:"getIndex",value:function(){return this.index}},{key:"setIndex",value:function(t){return this.index=t,this}},{key:"setLineEndType",value:function(t){return t>=ro.LineEndType.NONE&&t<=ro.LineEndType.DOWN&&(this.leg=t),this}},{key:"setStringNumber",value:function(t){return this.string_number=t,this}},{key:"setOffsetX",value:function(t){return this.x_offset=t,this}},{key:"setOffsetY",value:function(t){return this.y_offset=t,this}},{key:"setLastNote",value:function(t){return this.last_note=t,this}},{key:"setDashed",value:function(t){return this.dashed=t,this}},{key:"draw",value:function(){var t=this.checkContext();if(!this.note||null==this.index)throw new or.RERR("NoAttachedNote","Can't draw string number without a note and index.");this.setRendered();var e=this.note.stave.options.spacing_between_lines_px,i=this.note.getModifierStartXY(this.position,this.index),n=i.x+this.x_shift+this.x_offset,r=i.y+this.y_shift+this.y_offset;switch(this.position){case br.Position.ABOVE:case br.Position.BELOW:var o=this.note.getStemExtents(),s=o.topY,a=o.baseY+2;this.note.stem_direction===wr.STEM_DOWN&&(s=o.baseY,a=o.topY-2),r=this.position===br.Position.ABOVE?this.note.hasStem()?s-1.75*e:i.y-1.75*e:this.note.hasStem()?a+1.5*e:i.y+1.75*e,r+=this.y_shift+this.y_offset;break;case br.Position.LEFT:n-=this.radius/2+5;break;case br.Position.RIGHT:n+=this.radius/2+6;break;default:throw new or.RERR("InvalidPosition","The position "+this.position+" is invalid")}t.save(),t.beginPath(),t.arc(n,r,this.radius,0,2*Math.PI,!1),t.lineWidth=1.5,t.stroke(),t.setFont(this.font.family,this.font.size,this.font.weight);var h=n-t.measureText(this.string_number).width/2;if(t.fillText(""+this.string_number,h,r+4.5),null!=this.last_note){var u=this.last_note.getStemX()-this.note.getX()+5;t.strokeStyle="#000000",t.lineCap="round",t.lineWidth=.6,this.dashed?ro.drawDashedLine(t,n+10,r,n+u,r,[3,3]):ro.drawDashedLine(t,n+10,r,n+u,r,[3,0]);var l=void 0,c=void 0;switch(this.leg){case ro.LineEndType.UP:l=-10,c=this.dashed?[3,3]:[3,0],ro.drawDashedLine(t,n+u,r,n+u,r+l,c);break;case ro.LineEndType.DOWN:l=10,c=this.dashed?[3,3]:[3,0],ro.drawDashedLine(t,n+u,r,n+u,r+l,c)}}t.restore()}}]),e}(),so=t(e(function(t,e){e.__esModule=!0;var i=function(t){return t&&t.__esModule?t:{default:t}}(yi);e.default=function(t,e,n){return e in t?(0,i.default)(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}})),ao=br.Position,ho=ao.ABOVE,uo=ao.BELOW,lo=function(t,e){return.5*t(e/.5)},co=function(t,e){return e===ho?t<=5:t>=1},fo=function(t,e){return co(t,e)?e===ho?Math.ceil:Math.floor:Math.round},vo=function(t){function e(t){fi(this,e);var i=ni(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));if(i.setAttribute("type","Articulation"),i.note=null,i.index=null,i.type=t,i.position=uo,i.render_options={font_scale:38},i.articulation=yr.articulationCodes(i.type),!i.articulation)throw new or.RERR("ArgumentError","Articulation not found: "+i.type);return i.glyph=new vr(i.articulation.code,i.render_options.font_scale),i.setWidth(i.glyph.getMetrics().width),i}return ci(e,br),gi(e,null,[{key:"format",value:function(t,e){if(!t||0===t.length)return!1;var i=function(t,e,i){return lo(fo(e,i),t.glyph.getMetrics().height/10+.5)};t.filter(function(t){return t.getPosition()===ho}).forEach(function(t){t.setTextLine(e.top_text_line),e.top_text_line+=i(t,e.top_text_line,ho)}),t.filter(function(t){return t.getPosition()===uo}).forEach(function(t){t.setTextLine(e.text_line),e.text_line+=i(t,e.text_line,uo)});var n=t.map(function(t){return t.getWidth()}).reduce(function(t,e){return Math.max(e,t)});return e.left_shift+=n/2,e.right_shift+=n/2,!0}},{key:"easyScoreHook",value:function(t,e,i){var n=t.articulations;if(n){var r={staccato:"a.",tenuto:"a-"};n.split(",").map(function(t){return t.trim().split(".")}).map(function(t){var e=nn(t,2),n=e[0],o=e[1],s={type:r[n]};return o&&(s.position=br.PositionString[o]),i.getFactory().Articulation(s)}).map(function(t){return e.addModifier(0,t)})}}},{key:"CATEGORY",get:function(){return"articulations"}},{key:"INITIAL_OFFSET",get:function(){return-.5}}]),gi(e,[{key:"getCategory",value:function(){return e.CATEGORY}},{key:"draw",value:function(){var t,i=this.note,n=this.index,r=this.position,o=this.glyph,s=this.articulation.between_lines,a=this.text_line,h=this.context;if(this.checkContext(),!i||null==n)throw new or.RERR("NoAttachedNote","Can't draw Articulation without a note and index.");this.setRendered();var u=i.getStave(),l=u.getSpacingBetweenLines(),c="tabnotes"===i.getCategory(),f=i.getModifierStartXY(r,n).x,d=!s||c,v=function(t,e){var i=e===ho&&t.getStemDirection()===gr.UP||e===uo&&t.getStemDirection()===gr.DOWN;return"stavenotes"===t.getCategory()?t.hasStem()&&i?.5:1:t.hasStem()&&i?1:0}(i,r),y=(t={},so(t,ho,function(){o.setOrigin(.5,1);var t=function(t,e){var i=t.getStave(),n=t.getStemDirection(),r=t.getStemExtents(),o=r.topY,s=r.baseY;if("stavenotes"===t.getCategory())return t.hasStem()?n===gr.UP?o:s:Math.min.apply(Math,Vr(t.getYs()));if("tabnotes"===t.getCategory())return t.hasStem()&&n===gr.UP?o:i.getYForTopText(e);throw new or.RERR("UnknownCategory","Only can get the top and bottom ys of stavenotes and tabnotes")}(i,a)-(a+v)*l;return d?Math.min(u.getYForTopText(e.INITIAL_OFFSET),t):t}),so(t,uo,function(){o.setOrigin(.5,0);var t=function(t,e){var i=t.getStave(),n=t.getStemDirection(),r=t.getStemExtents(),o=r.topY,s=r.baseY;if("stavenotes"===t.getCategory())return t.hasStem()?n===gr.UP?s:o:Math.max.apply(Math,Vr(t.getYs()));if("tabnotes"===t.getCategory())return t.hasStem()?n===gr.UP?i.getYForBottomText(e):o:i.getYForBottomText(e);throw new or.RERR("UnknownCategory","Only can get the top and bottom ys of stavenotes and tabnotes")}(i,a)+(a+v)*l;return d?Math.max(u.getYForBottomText(e.INITIAL_OFFSET),t):t}),t)[r]();if(!c){var g=r===ho?-1:1,p=c?i.positions[n].str:i.getKeyProps()[n].line,_=(i.getYs()[n]-y)/l+p,m=function(t,e,i,n){var r=lo(fo(e,i),e);if(t&&co(r,i)&&r%1==0)return r+.5*-n;return r}(s,_,r,g);co(m,r)&&o.setOrigin(.5,.5),y+=Math.abs(m-_)*l*g}!function(){for(var t=arguments,e=arguments.length,i=Array(e),n=0;n<e;n++)i[n]=t[n];vo.DEBUG&&or.L("Vex.Flow.Articulation",i)}("Rendering articulation at (x: "+f+", y: "+y+")"),o.render(h,f,y)}}]),e}(),yo=function(t){function e(){fi(this,e);var t=ni(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return t.setAttribute("type","TickContext"),t.currentTick=new ar(0,1),t.maxTicks=new ar(0,1),t.minTicks=null,t.padding=3,t.x=0,t.tickables=[],t.notePx=0,t.extraLeftPx=0,t.extraRightPx=0,t.tContexts=[],t}return ci(e,pr),gi(e,null,[{key:"getNextContext",value:function(t){var e=t.tContexts;return e[e.indexOf(t)+1]}}]),gi(e,[{key:"getX",value:function(){return this.x}},{key:"setX",value:function(t){return this.x=t,this}},{key:"getWidth",value:function(){return this.width+2*this.padding}},{key:"setPadding",value:function(t){return this.padding=t,this}},{key:"getMaxTicks",value:function(){return this.maxTicks}},{key:"getMinTicks",value:function(){return this.minTicks}},{key:"getTickables",value:function(){return this.tickables}},{key:"getCenterAlignedTickables",value:function(){return this.tickables.filter(function(t){return t.isCenterAligned()})}},{key:"getMetrics",value:function(){return{width:this.width,notePx:this.notePx,extraLeftPx:this.extraLeftPx,extraRightPx:this.extraRightPx}}},{key:"getCurrentTick",value:function(){return this.currentTick}},{key:"setCurrentTick",value:function(t){this.currentTick=t,this.preFormatted=!1}},{key:"getExtraPx",value:function(){for(var t=0,e=0,i=0,n=0,r=0;r<this.tickables.length;r++){i=Math.max(this.tickables[r].extraLeftPx||0,i),n=Math.max(this.tickables[r].extraRightPx||0,n);var o=this.tickables[r].modifierContext;o&&null!=o&&(t=Math.max(t,o.state.left_shift),e=Math.max(e,o.state.right_shift))}return{left:t,right:e,extraLeft:i,extraRight:n}}},{key:"addTickable",value:function(t){if(!t)throw new or.RERR("BadArgument","Invalid tickable added.");if(!t.shouldIgnoreTicks()){this.ignore_ticks=!1;var e=t.getTicks();e.greaterThan(this.maxTicks)&&(this.maxTicks=e.clone()),null==this.minTicks?this.minTicks=e.clone():e.lessThan(this.minTicks)&&(this.minTicks=e.clone())}return t.setTickContext(this),this.tickables.push(t),this.preFormatted=!1,this}},{key:"preFormat",value:function(){if(this.preFormatted)return this;for(var t=0;t<this.tickables.length;++t){var e=this.tickables[t];e.preFormat();var i=e.getMetrics();this.extraLeftPx=Math.max(this.extraLeftPx,i.extraLeftPx+i.modLeftPx),this.extraRightPx=Math.max(this.extraRightPx,i.extraRightPx+i.modRightPx),this.notePx=Math.max(this.notePx,i.noteWidth),this.width=this.notePx+this.extraLeftPx+this.extraRightPx}return this}},{key:"postFormat",value:function(){return this.postFormatted?this:(this.postFormatted=!0,this)}}]),e}(),go=function(t){function e(t){fi(this,e);var i=ni(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));if(i.setAttribute("type","Ornament"),i.note=null,i.index=null,i.type=t,i.position=br.Position.ABOVE,i.delayed=!1,i.accidentalUpper=null,i.accidentalLower=null,i.render_options={font_scale:38,accidentalLowerPadding:3,accidentalUpperPadding:3},i.ornament=yr.ornamentCodes(i.type),!i.ornament)throw new or.RERR("ArgumentError","Ornament not found: '"+i.type+"'");return i.glyph=new vr(i.ornament.code,i.render_options.font_scale),i.glyph.setOrigin(.5,1),i}return ci(e,br),gi(e,null,[{key:"format",value:function(t,e){if(!t||0===t.length)return!1;for(var i=0,n=0;n<t.length;++n){var r=t[n];i=Math.max(r.getWidth(),i),r.getPosition()===br.Position.ABOVE?(r.setTextLine(e.top_text_line),e.top_text_line+=2):(r.setTextLine(e.text_line),e.text_line+=2)}return e.left_shift+=i/2,e.right_shift+=i/2,!0}},{key:"CATEGORY",get:function(){return"ornaments"}}]),gi(e,[{key:"getCategory",value:function(){return e.CATEGORY}},{key:"setDelayed",value:function(t){return this.delayed=t,this}},{key:"setUpperAccidental",value:function(t){var e=this.render_options.font_scale/1.3;return this.accidentalUpper=new vr(yr.accidentalCodes(t).code,e),this.accidentalUpper.setOrigin(.5,1),this}},{key:"setLowerAccidental",value:function(t){var e=this.render_options.font_scale/1.3;return this.accidentalLower=new vr(yr.accidentalCodes(t).code,e),this.accidentalLower.setOrigin(.5,1),this}},{key:"draw",value:function(){if(this.checkContext(),!this.note||null==this.index)throw new or.RERR("NoAttachedNote","Can't draw Ornament without a note and index.");this.setRendered();var t=this.context,e=this.note.getStemDirection(),i=this.note.getStave(),n=this.note.getStem().getExtents(),r=e===wr.STEM_DOWN?n.baseY:n.topY;"tabnotes"===this.note.getCategory()&&(this.note.hasStem()?e===wr.STEM_DOWN&&(r=i.getYForTopText(this.text_line)):r=i.getYForTopText(this.text_line));var o=e===wr.STEM_DOWN,s=i.getSpacingBetweenLines(),a=1;!o&&this.note.beam&&(a+=.5);var h=r-s*(this.text_line+a),u=this.note.getModifierStartXY(this.position,this.index).x,l=Math.min(i.getYForTopText(this.text_line),h);if(l+=this.y_shift,this.delayed){u+=this.glyph.getMetrics().width;var c=yo.getNextContext(this.note.getTickContext());u+=c?.5*(c.getX()-u):.5*(i.x+i.width-u)}!function(){for(var t=arguments,e=arguments.length,i=Array(e),n=0;n<e;n++)i[n]=t[n];go.DEBUG&&or.L("Vex.Flow.Ornament",i)}("Rendering ornament: ",this.ornament,u,l),this.accidentalLower&&(this.accidentalLower.render(t,u,l),l-=this.accidentalLower.getMetrics().height,l-=this.render_options.accidentalLowerPadding),this.glyph.render(t,u,l),l-=this.glyph.getMetrics().height,this.accidentalUpper&&(l-=this.render_options.accidentalUpperPadding,this.accidentalUpper.render(t,u,l))}}]),e}(),po=function(t){function e(t){fi(this,e);var i=ni(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return i.setAttribute("type","Annotation"),i.note=null,i.index=null,i.text=t,i.justification=e.Justify.CENTER,i.vert_justification=e.VerticalJustify.TOP,i.font={family:"Arial",size:10,weight:""},i.setWidth(yr.textWidth(t)),i}return ci(e,br),gi(e,null,[{key:"format",value:function(t,e){if(!t||0===t.length)return!1;for(var i=0,n=0;n<t.length;++n){var r=t[n];i=Math.max(r.getWidth(),i),r.getPosition()===br.Position.ABOVE?(r.setTextLine(e.top_text_line),e.top_text_line++):(r.setTextLine(e.text_line),e.text_line++)}return e.left_shift+=i/2,e.right_shift+=i/2,!0}},{key:"CATEGORY",get:function(){return"annotations"}},{key:"Justify",get:function(){return{LEFT:1,CENTER:2,RIGHT:3,CENTER_STEM:4}}},{key:"JustifyString",get:function(){return{left:e.Justify.LEFT,right:e.Justify.RIGHT,center:e.Justify.CENTER,centerStem:e.Justify.CENTER_STEM}}},{key:"VerticalJustify",get:function(){return{TOP:1,CENTER:2,BOTTOM:3,CENTER_STEM:4}}},{key:"VerticalJustifyString",get:function(){return{above:e.VerticalJustify.TOP,top:e.VerticalJustify.TOP,below:e.VerticalJustify.BOTTOM,bottom:e.VerticalJustify.BOTTOM,center:e.VerticalJustify.CENTER,centerStem:e.VerticalJustify.CENTER_STEM}}}]),gi(e,[{key:"getCategory",value:function(){return e.CATEGORY}},{key:"setFont",value:function(t,e,i){return this.font={family:t,size:e,weight:i},this}},{key:"setVerticalJustification",value:function(t){return this.vert_justification="string"==typeof t?e.VerticalJustifyString[t]:t,this}},{key:"getJustification",value:function(){return this.justification}},{key:"setJustification",value:function(t){return this.justification="string"==typeof t?e.JustifyString[t]:t,this}},{key:"draw",value:function(){if(this.checkContext(),!this.note)throw new or.RERR("NoNoteForAnnotation","Can't draw text annotation without an attached note.");this.setRendered();var t=this.note.getModifierStartXY(br.Position.ABOVE,this.index);this.context.save(),this.context.setFont(this.font.family,this.font.size,this.font.weight);var i=this.context.measureText(this.text).width,n=this.context.measureText("m").width,r=void 0,o=void 0;r=this.justification===e.Justify.LEFT?t.x:this.justification===e.Justify.RIGHT?t.x-i:this.justification===e.Justify.CENTER?t.x-i/2:this.note.getStemX()-i/2;var s=void 0,a=void 0,h=this.note.hasStem(),u=this.note.getStave();if(h&&(s=this.note.getStem().getExtents(),a=u.getSpacingBetweenLines()),this.vert_justification===e.VerticalJustify.BOTTOM){if(o=u.getYForBottomText(this.text_line+yr.TEXT_HEIGHT_OFFSET_HACK),h){var l=1===this.note.getStemDirection()?s.baseY:s.topY;o=Math.max(o,l+a*(this.text_line+2))}}else if(this.vert_justification===e.VerticalJustify.CENTER){var c=this.note.getYForTopText(this.text_line)-1;o=c+(u.getYForBottomText(this.text_line)-c)/2+n/2}else if(this.vert_justification===e.VerticalJustify.TOP)o=Math.min(u.getYForTopText(this.text_line),this.note.getYs()[0]-10),h&&(o=Math.min(o,s.topY-5-a*this.text_line));else{var f=this.note.getStemExtents();o=f.topY+(f.baseY-f.topY)/2+n/2}!function(){for(var t=arguments,e=arguments.length,i=Array(e),n=0;n<e;n++)i[n]=t[n];po.DEBUG&&or.L("Vex.Flow.Annotation",i)}("Rendering annotation: ",this.text,r,o),this.context.fillText(this.text,r,o),this.context.restore()}}]),e}(),_o=function(t){function e(t,i,n){fi(this,e);var r=ni(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return r.setAttribute("type","Bend"),r.text=t,r.x_shift=0,r.release=i||!1,r.font="10pt Arial",r.render_options={line_width:1.5,line_style:"#777777",bend_width:8,release_width:8},n?r.phrase=n:(r.phrase=[{type:e.UP,text:r.text}],r.release&&r.phrase.push({type:e.DOWN,text:""})),r.updateWidth(),r}return ci(e,br),gi(e,null,[{key:"format",value:function(t,e){if(!t||0===t.length)return!1;for(var i=0,n=e.top_text_line,r=0;r<t.length;++r){var o=t[r];o.setXShift(i),i=o.getWidth(),o.setTextLine(n)}return e.right_shift+=i,e.top_text_line+=1,!0}},{key:"CATEGORY",get:function(){return"bends"}},{key:"UP",get:function(){return 0}},{key:"DOWN",get:function(){return 1}}]),gi(e,[{key:"getCategory",value:function(){return e.CATEGORY}},{key:"setXShift",value:function(t){this.x_shift=t,this.updateWidth()}},{key:"setFont",value:function(t){return this.font=t,this}},{key:"getText",value:function(){return this.text}},{key:"updateWidth",value:function(){function t(t){return i.context?i.context.measureText(t).width:yr.textWidth(t)}for(var i=this,n=0,r=0;r<this.phrase.length;++r){var o=this.phrase[r];if("width"in o)n+=o.width;else{var s=o.type===e.UP?this.render_options.bend_width:this.render_options.release_width;o.width=or.Max(s,t(o.text))+3,o.draw_width=o.width/2,n+=o.width}}return this.setWidth(n+this.x_shift),this}},{key:"draw",value:function(){function t(t,e,i,n){var r=t+i,o=e;a.save(),a.beginPath(),a.setLineWidth(l.render_options.line_width),a.setStrokeStyle(l.render_options.line_style),a.setFillStyle(l.render_options.line_style),a.moveTo(t,e),a.quadraticCurveTo(r,o,t+i,n),a.stroke(),a.restore()}function i(t,e,i,n){a.save(),a.beginPath(),a.setLineWidth(l.render_options.line_width),a.setStrokeStyle(l.render_options.line_style),a.setFillStyle(l.render_options.line_style),a.moveTo(t,n),a.quadraticCurveTo(t+i,n,t+i,e),a.stroke(),a.restore()}function n(t,e,i){var n=i||1;a.beginPath(),a.moveTo(t,e),a.lineTo(t-4,e+4*n),a.lineTo(t+4,e+4*n),a.closePath(),a.fill()}function r(t,e){a.save(),a.setRawFont(l.font);var i=t-a.measureText(e).width/2;a.fillText(e,i,u),a.restore()}if(this.checkContext(),!this.note||null==this.index)throw new or.RERR("NoNoteForBend","Can't draw bend without a note or index.");this.setRendered();var o=this.note.getModifierStartXY(br.Position.RIGHT,this.index);o.x+=3,o.y+=.5;for(var s=this.x_shift,a=this.context,h=this.note.getStave().getYForTopText(this.text_line)+3,u=this.note.getStave().getYForTopText(this.text_line)-1,l=this,c=null,f=0,d=0;d<this.phrase.length;++d){var v=this.phrase[d];0===d&&(v.draw_width+=s),f=v.draw_width+(c?c.draw_width:0)-(1===d?s:0),v.type===e.UP&&(c&&c.type===e.UP&&n(o.x,h),t(o.x,o.y,f,h)),v.type===e.DOWN&&(c&&c.type===e.UP&&i(o.x,o.y,f,h),c&&c.type===e.DOWN&&(n(o.x,o.y,-1),i(o.x,o.y,f,h)),null===c&&(f=v.draw_width,i(o.x,o.y,f,h))),r(o.x+f,v.text),(c=v).x=o.x,o.x+=f}c.type===e.UP?n(c.x+f,h):c.type===e.DOWN&&n(c.x+f,o.y,-1)}}]),e}(),mo=function(t){function e(){fi(this,e);var t=ni(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return t.setAttribute("type","Vibrato"),t.position=br.Position.RIGHT,t.render_options={harsh:!1,vibrato_width:20,wave_height:6,wave_width:4,wave_girth:2},t.setVibratoWidth(t.render_options.vibrato_width),t}return ci(e,br),gi(e,null,[{key:"format",value:function(t,e,i){if(!t||0===t.length)return!1;var n=e.top_text_line,r=0,o=e.right_shift-7,s=i.getModifiers(_o.CATEGORY);s&&s.length>0&&n--;for(var a=0;a<t.length;++a){var h=t[a];h.setXShift(o),h.setTextLine(n),o+=r+=h.getWidth()}return e.right_shift+=r,e.top_text_line+=1,!0}},{key:"CATEGORY",get:function(){return"vibratos"}}]),gi(e,[{key:"getCategory",value:function(){return e.CATEGORY}},{key:"setHarsh",value:function(t){return this.render_options.harsh=t,this}},{key:"setVibratoWidth",value:function(t){return this.render_options.vibrato_width=t,this.setWidth(t),this}},{key:"draw",value:function(){var t=this.checkContext();if(!this.note)throw new or.RERR("NoNoteForVibrato","Can't draw vibrato without an attached note.");this.setRendered();var i=this.note.getModifierStartXY(br.Position.RIGHT,this.index).x+this.x_shift,n=this.note.getYForTopText(this.text_line)+2;e.renderVibrato(t,i,n,this.render_options)}}],[{key:"renderVibrato",value:function(t,e,i,n){var r=n.harsh,o=n.vibrato_width,s=n.wave_width,a=n.wave_girth,h=n.wave_height,u=o/s;t.beginPath();var l=void 0;if(r){for(t.moveTo(e,i+a+1),l=0;l<u/2;++l)t.lineTo(e+s,i-h/2),e+=s,t.lineTo(e+s,i+h/2),e+=s;for(l=0;l<u/2;++l)t.lineTo(e-s,i-h/2+a+1),e-=s,t.lineTo(e-s,i+h/2+a+1),e-=s;t.fill()}else{for(t.moveTo(e,i+a),l=0;l<u/2;++l)t.quadraticCurveTo(e+s/2,i-h/2,e+s,i),e+=s,t.quadraticCurveTo(e+s/2,i+h/2,e+s,i),e+=s;for(l=0;l<u/2;++l)t.quadraticCurveTo(e-s/2,i+h/2+a,e-s,i+a),e-=s,t.quadraticCurveTo(e-s/2,i-h/2+a,e-s,i+a),e-=s;t.fill()}}}]),e}(),xo=function(){function t(){fi(this,t),this.modifiers={},this.preFormatted=!1,this.postFormatted=!1,this.width=0,this.spacing=0,this.state={left_shift:0,right_shift:0,text_line:0,top_text_line:0},this.PREFORMAT=[wr,kr,Kr,Ur,Zr,qr,$r,oo,vo,go,po,_o,mo],this.POSTFORMAT=[wr]}return gi(t,[{key:"addModifier",value:function(t){var e=t.getCategory();return this.modifiers[e]||(this.modifiers[e]=[]),this.modifiers[e].push(t),t.setModifierContext(this),this.preFormatted=!1,this}},{key:"getModifiers",value:function(t){return this.modifiers[t]}},{key:"getWidth",value:function(){return this.width}},{key:"getExtraLeftPx",value:function(){return this.state.left_shift}},{key:"getExtraRightPx",value:function(){return this.state.right_shift}},{key:"getState",value:function(){return this.state}},{key:"getMetrics",value:function(){if(!this.formatted)throw new or.RERR("UnformattedModifier","Unformatted modifier has no metrics.");return{width:this.state.left_shift+this.state.right_shift+this.spacing,spacing:this.spacing,extra_left_px:this.state.left_shift,extra_right_px:this.state.right_shift}}},{key:"preFormat",value:function(){var t=this;this.preFormatted||(this.PREFORMAT.forEach(function(e){N("Preformatting ModifierContext: ",e.CATEGORY),e.format(t.getModifiers(e.CATEGORY),t.state,t)}),this.width=this.state.left_shift+this.state.right_shift,this.preFormatted=!0)}},{key:"postFormat",value:function(){var t=this;this.postFormatted||this.POSTFORMAT.forEach(function(e){N("Postformatting ModifierContext: ",e.CATEGORY),e.postFormat(t.getModifiers(e.CATEGORY),t)})}}]),t}(),bo=function(){function t(){fi(this,t),this.minTotalWidth=0,this.hasMinTotalWidth=!1,this.totalTicks=new ar(0,1),this.tickContexts=null,this.modiferContexts=null,this.contextGaps={total:0,gaps:[]},this.voices=[]}return gi(t,null,[{key:"SimpleFormat",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:{}).paddingBetween,n=void 0===i?10:i;t.reduce(function(t,e){e.addToModifierContext(new xo);var i=(new yo).addTickable(e).preFormat(),r=i.getExtraPx();return i.setX(t+r.left),t+i.getWidth()+r.right+n},e)}},{key:"plotDebugging",value:function(t,e,i,n,r){var o=i+_r.STAVEPADDING,s=e.contextGaps;t.save(),t.setFont("Arial",8,""),s.gaps.forEach(function(e){!function(e,i,o){t.beginPath(),t.setStrokeStyle(o),t.setFillStyle(o),t.setLineWidth(1),t.fillRect(e,n,i-e,r-n)}(o+e.x1,o+e.x2,"#aaa"),t.fillText(Math.round(e.x2-e.x1),o+e.x1,r+12)}),t.fillText(Math.round(s.total)+"px",o-20,r+12),t.setFillStyle("red"),t.fillText("Loss: "+e.lossHistory.map(function(t){return Math.round(t)}),o-20,r+22),t.restore()}},{key:"FormatAndDraw",value:function(e,i,n,r){var o={auto_beam:!1,align_rests:!1};"object"===(void 0===r?"undefined":ii(r))?or.Merge(o,r):"boolean"==typeof r&&(o.auto_beam=r);var s=new Xr(yr.TIME4_4).setMode(Xr.Mode.SOFT).addTickables(n),a=o.auto_beam?wo.applyAndGetBeams(s):[];return(new t).joinVoices([s],{align_rests:o.align_rests}).formatToStave([s],i,{align_rests:o.align_rests,stave:i}),s.setStave(i).draw(e,i),a.forEach(function(t){return t.setContext(e).draw()}),s.getBoundingBox()}},{key:"FormatAndDrawTab",value:function(e,i,n,r,o,s,a){var h={auto_beam:s,align_rests:!1};"object"===(void 0===a?"undefined":ii(a))?or.Merge(h,a):"boolean"==typeof a&&(h.auto_beam=a);var u=new Xr(yr.TIME4_4).setMode(Xr.Mode.SOFT).addTickables(o),l=new Xr(yr.TIME4_4).setMode(Xr.Mode.SOFT).addTickables(r),c=h.auto_beam?wo.applyAndGetBeams(u):[];(new t).joinVoices([u],{align_rests:h.align_rests}).joinVoices([l]).formatToStave([u,l],n,{align_rests:h.align_rests}),u.draw(e,n),l.draw(e,i),c.forEach(function(t){return t.setContext(e).draw()}),new zr(n,i).setContext(e).draw()}},{key:"AlignRestsToNotes",value:function(t,e,i){return t.forEach(function(n,r){if(n instanceof wr&&n.isRest()){if(n.tuplet&&!i)return;var o=n.getGlyph().position.toUpperCase();if("R/4"!==o&&"B/4"!==o)return;if(e||null!=n.beam){var s=n.getKeyProps()[0];if(0===r)s.line=P(t,s.line,r,!1),n.setKeyLine(0,s.line);else if(r>0&&r<t.length){var a=void 0;t[r-1].isRest()?(a=t[r-1].getKeyProps()[0].line,s.line=a):(a=t[r-1].getLineForRest(),s.line=P(t,a,r,!0)),n.setKeyLine(0,s.line)}}}}),this}}]),gi(t,[{key:"alignRests",value:function(e,i){if(!e||!e.length)throw new or.RERR("BadArgument","No voices to format rests");e.forEach(function(e){return t.AlignRestsToNotes(e.getTickables(),i)})}},{key:"preCalculateMinTotalWidth",value:function(t){if(this.hasMinTotalWidth)return this.minTotalWidth;if(!this.tickContexts){if(!t)throw new or.RERR("BadArgument","'voices' required to run preCalculateMinTotalWidth");this.createTickContexts(t)}var e=this.tickContexts,i=e.list,n=e.map;return this.minTotalWidth=i.map(function(t){var e=n[t];return e.preFormat(),e.getWidth()}).reduce(function(t,e){return t+e},0),this.hasMinTotalWidth=!0,this.minTotalWidth}},{key:"getMinTotalWidth",value:function(){if(!this.hasMinTotalWidth)throw new or.RERR("NoMinTotalWidth","Call 'preCalculateMinTotalWidth' or 'preFormat' before calling 'getMinTotalWidth'");return this.minTotalWidth}},{key:"createModifierContexts",value:function(t){var e=A(t,xo,function(t,e){return t.addToModifierContext(e)});return this.modiferContexts=e,e}},{key:"createTickContexts",value:function(t){var e=A(t,yo,function(t,e){return e.addTickable(t)});return e.array.forEach(function(t){t.tContexts=e.array}),this.totalTicks=t[0].getTicksUsed().clone(),this.tickContexts=e,e}},{key:"preFormat",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments[1],i=this,n=arguments[2],r=arguments[3],o=this.tickContexts,s=o.list,a=o.map,h=o.resolutionMultiplier;n&&r&&n.forEach(function(t){return t.setStave(r).preFormat()});var u=0,l=0,c=t/2;if(this.minTotalWidth=0,s.forEach(function(t){var n=a[t];e&&n.setContext(e),n.preFormat();var r=n.getWidth();i.minTotalWidth+=r;var o=n.getMetrics();u=u+l+o.extraLeftPx,n.setX(u),l=r-o.extraLeftPx}),this.minTotalWidth=u+l,this.hasMinTotalWidth=!0,!(t<=0)){var f=(t-this.minTotalWidth)/(this.totalTicks.value()*h),d=0;s.forEach(function(t,e){var i=s[e-1]||0,n=a[t];d+=(t-i)*f,n.setX(n.getX()+d),n.getCenterAlignedTickables().forEach(function(t){t.center_x_shift=c-n.getX()})}),1!==s.length&&(this.justifyWidth=t,this.lossHistory=[],this.evaluate())}}},{key:"evaluate",value:function(){var t=this,e=this.justifyWidth;this.contextGaps={total:0,gaps:[]},this.tickContexts.list.forEach(function(e,i){if(0!==i){var n=t.tickContexts.list[i-1],r=t.tickContexts.map[n],o=t.tickContexts.map[e],s=r.getMetrics(),a=r.getX()+s.width,h=o.getX(),u=h-a;t.contextGaps.total+=u,t.contextGaps.gaps.push({x1:a,x2:h}),o.getFormatterMetrics().freedom.left=u,r.getFormatterMetrics().freedom.right=u}});var i=this.durationStats={};this.voices.forEach(function(t){t.getTickables().forEach(function(t,n,r){var o=t.getTicks().clone().simplify().toString(),s=t.getMetrics(),a=t.getFormatterMetrics(),h=t.getX()+s.noteWidth+s.modRightPx+s.extraRightPx,u=0;if(n<r.length-1){var l=r[n+1],c=l.getMetrics();u=l.getX()-c.modLeftPx-c.extraLeftPx-h,a.space.used=l.getX()-t.getX(),l.getFormatterMetrics().freedom.left=u}else u=e-h,a.space.used=e-t.getX();a.freedom.right=u,function(t,e){var n=i[t];void 0===n?i[t]={mean:e,count:1}:(n.count+=1,n.mean=(n.mean+e)/2)}(o,a.space.used)})});var n=0;return this.voices.forEach(function(t){t.getTickables().forEach(function(t){var e=t.getTicks().clone().simplify().toString(),r=t.getFormatterMetrics();r.iterations+=1,r.space.deviation=r.space.used-i[e].mean,r.duration=e,r.space.mean=i[e].mean,n+=Math.pow(i[e].mean,2)})}),this.totalCost=Math.sqrt(n),this.lossHistory.push(this.totalCost),this}},{key:"tune",value:function(){var t=this,e=0;return this.tickContexts.list.forEach(function(i,n,r){var o=t.tickContexts.map[i],s=n>0?t.tickContexts.map[r[n-1]]:null,a=n<r.length-1?t.tickContexts.map[r[n+1]]:null;!function(t,e,i,n){t.setX(t.getX()+n),t.getFormatterMetrics().freedom.left+=n,t.getFormatterMetrics().freedom.right-=n,e&&(e.getFormatterMetrics().freedom.right+=n),i&&(i.getFormatterMetrics().freedom.left-=n)}(o,s,a,e);var h=-function(t){return t.reduce(function(t,e){return t+e})}(o.getTickables().map(function(t){return t.getFormatterMetrics().space.deviation}));h>0?e=-Math.min(o.getFormatterMetrics().freedom.right,Math.abs(h)):h<0&&(e=a?Math.min(a.getFormatterMetrics().freedom.right,Math.abs(h)):0);var u=Math.min(5,Math.abs(e));e=e>0?u:-u}),this.evaluate()}},{key:"postFormat",value:function(){var t=function(t){return t.list.forEach(function(e){return t.map[e].postFormat()})};return t(this.modiferContexts),t(this.tickContexts),this}},{key:"joinVoices",value:function(t){return this.createModifierContexts(t),this.hasMinTotalWidth=!1,this}},{key:"format",value:function(t,e,i){var n={align_rests:!1,context:null,stave:null};return or.Merge(n,i),this.voices=t,this.alignRests(t,n.align_rests),this.createTickContexts(t),this.preFormat(e,n.context,t,n.stave),n.stave&&this.postFormat(),this}},{key:"formatToStave",value:function(t,e,i){var n=e.getNoteEndX()-e.getNoteStartX()-10;!function(){for(var t=arguments,e=arguments.length,i=Array(e),n=0;n<e;n++)i[n]=t[n];bo.DEBUG&&or.L("Vex.Flow.Formatter",i)}("Formatting voices to width: ",n);var r={context:e.getContext()};return or.Merge(r,i),this.format(t,n,r)}}]),t}(),ko=function(t){function e(t,i){fi(this,e);var n=ni(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));if(n.setAttribute("type","Tuplet"),!t||!t.length)throw new or.RuntimeError("BadArguments","No notes provided for tuplet.");return n.options=or.Merge({},i),n.notes=t,n.num_notes="num_notes"in n.options?n.options.num_notes:t.length,n.options.beats_occupied&&n.beatsOccupiedDeprecationWarning(),n.notes_occupied=n.options.notes_occupied||n.options.beats_occupied||2,"bracketed"in n.options?n.bracketed=n.options.bracketed:n.bracketed=t.some(function(t){return null===t.beam}),n.ratioed="ratioed"in n.options?n.options.ratioed:Math.abs(n.notes_occupied-n.num_notes)>1,n.point=28,n.y_pos=16,n.x_pos=100,n.width=200,n.location=n.options.location||e.LOCATION_TOP,bo.AlignRestsToNotes(t,!0,!0),n.resolveGlyphs(),n.attach(),n}return ci(e,fr),gi(e,null,[{key:"LOCATION_TOP",get:function(){return 1}},{key:"LOCATION_BOTTOM",get:function(){return-1}},{key:"NESTING_OFFSET",get:function(){return 15}}]),gi(e,[{key:"attach",value:function(){for(var t=0;t<this.notes.length;t++){this.notes[t].setTuplet(this)}}},{key:"detach",value:function(){for(var t=0;t<this.notes.length;t++){this.notes[t].resetTuplet(this)}}},{key:"setBracketed",value:function(t){return this.bracketed=!!t,this}},{key:"setRatioed",value:function(t){return this.ratioed=!!t,this}},{key:"setTupletLocation",value:function(t){if(t){if(t!==e.LOCATION_TOP&&t!==e.LOCATION_BOTTOM)throw new or.RERR("BadArgument","Invalid tuplet location: "+t)}else t=e.LOCATION_TOP;return this.location=t,this}},{key:"getNotes",value:function(){return this.notes}},{key:"getNoteCount",value:function(){return this.num_notes}},{key:"beatsOccupiedDeprecationWarning",value:function(){var t=["beats_occupied has been deprecated as an ","option for tuplets. Please use notes_occupied ","instead. Calls to getBeatsOccupied and ","setBeatsOccupied should now be routed to ","getNotesOccupied and setNotesOccupied instead"].join("");console&&console.warn?console.warn(t):console&&console.log(t)}},{key:"getBeatsOccupied",value:function(){return this.beatsOccupiedDeprecationWarning(),this.getNotesOccupied()}},{key:"setBeatsOccupied",value:function(t){return this.beatsOccupiedDeprecationWarning(),this.setNotesOccupied(t)}},{key:"getNotesOccupied",value:function(){return this.notes_occupied}},{key:"setNotesOccupied",value:function(t){this.detach(),this.notes_occupied=t,this.resolveGlyphs(),this.attach()}},{key:"resolveGlyphs",value:function(){this.num_glyphs=[];for(var t=this.num_notes;t>=1;)this.num_glyphs.push(new vr("v"+t%10,this.point)),t=parseInt(t/10,10);for(this.denom_glyphs=[],t=this.notes_occupied;t>=1;)this.denom_glyphs.push(new vr("v"+t%10,this.point)),t=parseInt(t/10,10)}},{key:"getNestedTupletCount",value:function(){function t(t,e){return t.tupletStack.filter(function(t){return t.location===e}).length}var e=this.location,i=this.notes[0],n=t(i,e),r=t(i,e);return this.notes.forEach(function(i){var o=t(i,e);n=o>n?o:n,r=o<r?o:r}),n-r}},{key:"getYPosition",value:function(){var t=this.getNestedTupletCount()*e.NESTING_OFFSET*-this.location,i=this.options.y_offset||0,n=this.notes[0],r=void 0;if(this.location===e.LOCATION_TOP){r=n.getStave().getYForLine(0)-15;for(var o=0;o<this.notes.length;++o){var s=this.notes[o].getStemDirection()===gr.UP?this.notes[o].getStemExtents().topY-10:this.notes[o].getStemExtents().baseY-20;s<r&&(r=s)}}else{r=n.getStave().getYForLine(4)+20;for(var a=0;a<this.notes.length;++a){var h=this.notes[a].getStemDirection()===gr.UP?this.notes[a].getStemExtents().baseY+20:this.notes[a].getStemExtents().topY+10;h>r&&(r=h)}}return r+t+i}},{key:"draw",value:function(){var t=this;this.checkContext(),this.setRendered();var i=this.notes[0],n=this.notes[this.notes.length-1];this.bracketed?(this.x_pos=i.getTieLeftX()-5,this.width=n.getTieRightX()-this.x_pos+5):(this.x_pos=i.getStemX(),this.width=n.getStemX()-this.x_pos),this.y_pos=this.getYPosition();var r=function(t,e){return t+e.getMetrics().width},o=this.num_glyphs.reduce(r,0);this.ratioed&&(o=this.denom_glyphs.reduce(r,o),o+=.32*this.point);var s=this.x_pos+this.width/2-o/2;if(this.bracketed){var a=this.width/2-o/2-5;a>0&&(this.context.fillRect(this.x_pos,this.y_pos,a,1),this.context.fillRect(this.x_pos+this.width/2+o/2+5,this.y_pos,a,1),this.context.fillRect(this.x_pos,this.y_pos+(this.location===e.LOCATION_BOTTOM),1,10*this.location),this.context.fillRect(this.x_pos+this.width,this.y_pos+(this.location===e.LOCATION_BOTTOM),1,10*this.location))}var h=0;if(this.num_glyphs.forEach(function(e){e.render(t.context,s+h,t.y_pos+t.point/3-2),h+=e.getMetrics().width}),this.ratioed){var u=s+h+.16*this.point,l=.06*this.point;this.context.beginPath(),this.context.arc(u,this.y_pos-.08*this.point,l,0,2*Math.PI,!0),this.context.closePath(),this.context.fill(),this.context.beginPath(),this.context.arc(u,this.y_pos+.12*this.point,l,0,2*Math.PI,!0),this.context.closePath(),this.context.fill(),h+=.32*this.point,this.denom_glyphs.forEach(function(e){e.render(t.context,s+h,t.y_pos+t.point/3-2),h+=e.getMetrics().width})}}}]),e}(),wo=function(t){function e(t,i){fi(this,e);var n=ni(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));if(n.setAttribute("type","Beam"),!t||t===[])throw new or.RuntimeError("BadArguments","No notes provided for beam.");if(1===t.length)throw new or.RuntimeError("BadArguments","Too few notes for beam.");if(n.ticks=t[0].getIntrinsicTicks(),n.ticks>=yr.durationToTicks("4"))throw new or.RuntimeError("BadArguments","Beams can only be applied to notes shorter than a quarter note.");var r=void 0,o=void 0;for(n.stem_direction=gr.UP,r=0;r<t.length;++r)if((o=t[r]).hasStem()){n.stem_direction=o.getStemDirection();break}var s=n.stem_direction;if(i&&"stavenotes"===t[0].getCategory())s=L(t);else if(i&&"tabnotes"===t[0].getCategory()){s=t.reduce(function(t,e){return t+e.stem_direction},0)>-1?gr.UP:gr.DOWN}for(r=0;r<t.length;++r)o=t[r],i&&(o.setStemDirection(s),n.stem_direction=s),o.setBeam(n);return n.postFormatted=!1,n.notes=t,n.beam_count=n.getBeamCount(),n.break_on_indices=[],n.render_options={beam_width:5,max_slope:.25,min_slope:-.25,slope_iterations:20,slope_cost:100,show_stemlets:!1,stemlet_extension:7,partial_beam_length:10,flat_beams:!1,min_flat_beam_offset:15},n}return ci(e,fr),gi(e,null,[{key:"getDefaultBeamGroups",value:function(t){t&&"c"!==t||(t="4/4");var e={"1/2":["1/2"],"2/2":["1/2"],"3/2":["1/2"],"4/2":["1/2"],"1/4":["1/4"],"2/4":["1/4"],"3/4":["1/4"],"4/4":["1/4"],"1/8":["1/8"],"2/8":["2/8"],"3/8":["3/8"],"4/8":["2/8"],"1/16":["1/16"],"2/16":["2/16"],"3/16":["3/16"],"4/16":["2/16"]}[t];if(void 0!==e)return e.map(function(t){return(new ar).parse(t)});var i=parseInt(t.split("/")[0],10),n=parseInt(t.split("/")[1],10);return i%3==0?[new ar(3,n)]:n>4?[new ar(2,n)]:n<=4?[new ar(1,n)]:[new ar(1,4)]}},{key:"applyAndGetBeams",value:function(t,i,n){return e.generateBeams(t.getTickables(),{groups:n,stem_direction:i})}},{key:"generateBeams",value:function(t,i){function n(){r.length-1>s?s+=1:s=0}i||(i={}),i.groups&&i.groups.length||(i.groups=[new ar(2,8)]);var r=i.groups.map(function(t){if(!t.multiply)throw new or.RuntimeError("InvalidBeamGroups","The beam groups must be an array of Vex.Flow.Fractions");return t.clone().multiply(yr.RESOLUTION,1)}),o=t,s=0,a=[],h=[];!function(){var t=[];o.forEach(function(e){if(t=[],e.shouldIgnoreTicks())return a.push(h),void(h=t);h.push(e);var i=r[s].clone(),o=function(t){return t.reduce(function(t,e){return e.getTicks().clone().add(t)},new ar(0,1))}(h),u=yr.durationToNumber(e.duration)<8;u&&e.tuplet&&(i.numerator*=2),o.greaterThan(i)?(u||t.push(h.pop()),a.push(h),h=t,n()):o.equals(i)&&(a.push(h),h=t,n())}),h.length>0&&a.push(h)}(),function(){var t=[];a.forEach(function(e){var n=[];e.forEach(function(e,r,o){var s=0===r||r===o.length-1,a=o[r-1],h=!i.beam_rests&&e.isRest(),u=i.beam_rests&&i.beam_middle_only&&e.isRest()&&s,l=!1;if(i.maintain_stem_directions&&a&&!e.isRest()&&!a.isRest()){var c=a.getStemDirection();l=e.getStemDirection()!==c}var f=parseInt(e.duration,10)<8;h||u||l||f?(n.length>0&&t.push(n),n=l?[e]:[]):n.push(e)}),n.length>0&&t.push(n)}),a=t}(),a.forEach(function(t){var e=void 0;if(i.maintain_stem_directions){var n=function(t){for(var e=0;e<t.length;e++){var i=t[e];if(!i.isRest())return i}return!1}(t);e=n?n.getStemDirection():gr.UP}else e=i.stem_direction?i.stem_direction:L(t);!function(t,e){t.forEach(function(t){t.setStemDirection(e)})}(t,e)});var u=a.filter(function(t){if(t.length>1){var e=!0;return t.forEach(function(t){t.getIntrinsicTicks()>=yr.durationToTicks("4")&&(e=!1)}),e}return!1}),l=function(){var t=[];return a.forEach(function(e){var i=null;e.forEach(function(e){e.tuplet&&i!==e.tuplet&&(i=e.tuplet,t.push(i))})}),t}(),c=[];return u.forEach(function(t){var n=new e(t);i.show_stemlets&&(n.render_options.show_stemlets=!0),i.secondary_breaks&&(n.render_options.secondary_break_ticks=yr.durationToTicks(i.secondary_breaks)),!0===i.flat_beams&&(n.render_options.flat_beams=!0,n.render_options.flat_beam_offset=i.flat_beam_offset),c.push(n)}),l.forEach(function(t){var e=t.notes[0].stem_direction===gr.DOWN?ko.LOCATION_BOTTOM:ko.LOCATION_TOP;t.setTupletLocation(e);for(var i=!1,n=0;n<t.notes.length;n++){if(null===t.notes[n].beam){i=!0;break}}t.setBracketed(i)}),c}}]),gi(e,[{key:"getNotes",value:function(){return this.notes}},{key:"getBeamCount",value:function(){return this.notes.map(function(t){return t.getGlyph().beam_count}).reduce(function(t,e){return e>t?e:t})}},{key:"breakSecondaryAt",value:function(t){return this.break_on_indices=t,this}},{key:"getSlopeY",value:function(t,e,i,n){return i+(t-e)*n}},{key:"calculateSlope",value:function(){for(var t=this.notes,e=this.stem_direction,i=this.render_options,n=i.max_slope,r=i.min_slope,o=i.slope_iterations,s=i.slope_cost,a=t[0],h=function(t,e){var i=t.getStemExtents().topY,n=t.getStemX();return(e.getStemExtents().topY-i)/(e.getStemX()-n)}(a,t[t.length-1]),u=(n-r)/o,l=Number.MAX_VALUE,c=0,f=0,d=r;d<=n;d+=u){for(var v=0,y=0,g=1;g<t.length;++g){var p=t[g],_=this.getSlopeY(p.getStemX(),a.getStemX(),a.getStemExtents().topY,d)+y,m=p.getStemExtents().topY;if(m*e<_*e){var x=Math.abs(m-_);y+=x*-e,v+=x*g}else v+=(m-_)*e}var b=h/2,k=s*Math.abs(b-d)+Math.abs(v);k<l&&(l=k,c=d,f=y)}this.slope=c,this.y_shift=f}},{key:"calculateFlatSlope",value:function(){for(var t=this.notes,e=this.stem_direction,i=this.render_options,n=i.beam_width,r=i.min_flat_beam_offset,o=i.flat_beam_offset,s=0,a=0,h=0,u=0,l=0;l<t.length;l++){var c=t[l],f=c.getStemExtents().topY;s+=f,e===gr.DOWN&&u<f?(u=f,a=Math.max.apply(Math,Vr(c.getYs())),h=c.getBeamCount()):e===gr.UP&&(0===u||u>f)&&(u=f,a=Math.min.apply(Math,Vr(c.getYs())),h=c.getBeamCount())}var d=s/t.length,v=r+h*(1.5*n),y=a+v*-e;e===gr.DOWN&&d<y?d=a+v:e===gr.UP&&d>y&&(d=a-v),o?e===gr.DOWN&&d>o?this.render_options.flat_beam_offset=d:e===gr.UP&&d<o&&(this.render_options.flat_beam_offset=d):this.render_options.flat_beam_offset=d,this.slope=0,this.y_shift=0}},{key:"applyStemExtensions",value:function(){var t=this.notes,e=this.slope,i=this.y_shift,n=this.stem_direction,r=this.beam_count,o=this.render_options,s=o.show_stemlets,a=o.flat_beam_offset,h=o.flat_beams,u=o.stemlet_extension,l=o.beam_width,c=t[0],f=c.getStemExtents().topY;h&&a&&(f=a);for(var d=c.getStemX(),v=0;v<t.length;++v){var y=t[v],g=y.getStemX(),p=y.getStemExtents().topY,_=this.getSlopeY(g,d,f,e)+i,m=y.getStem().getExtension(),x=n===gr.UP?p-_:_-p;if(y.stem.setExtension(m+x),y.stem.renderHeightAdjustment=-gr.WIDTH/2,y.isRest()&&s){var b=(r-1)*l*1.5+l;y.stem.setVisibility(!0).setStemlet(!0,b+u)}}}},{key:"getBeamLines",value:function(t){for(var e=[],i=!1,n=null,r=this.render_options.partial_beam_length,o=!1,s=0,a=0;a<this.notes.length;++a){var h=this.notes[a];s+=h.ticks.value();var u=!1;parseInt(t,10)>=8&&(u=-1!==this.break_on_indices.indexOf(a),this.render_options.secondary_break_ticks&&s>=this.render_options.secondary_break_ticks&&(s=0,u=!0));var l=h.getIntrinsicTicks()<yr.durationToTicks(t),c=h.getStemX()-gr.WIDTH/2,f=this.notes[a+1],d=f&&f.getIntrinsicTicks()<yr.durationToTicks(t);l?i?((n=e[e.length-1]).end=c,u&&(i=!1,f&&!d&&null===n.end&&(n.end=n.start-r))):(n={start:c,end:null},i=!0,d?u&&(n.end=n.start-r,i=!1):n.end=(o||0===a)&&f?n.start+r:n.start-r,e.push(n)):i=!1,o=u}var v=e[e.length-1];return v&&null===v.end&&(v.end=v.start-r),e}},{key:"drawStems",value:function(){var t=this;this.notes.forEach(function(e){e.getStem()&&e.getStem().setContext(t.context).draw()},this)}},{key:"drawBeamLines",value:function(){this.checkContext();var t=["4","8","16","32","64"],e=this.notes[0],i=e.getStemExtents().topY;this.render_options.flat_beams&&this.render_options.flat_beam_offset&&(i=this.render_options.flat_beam_offset);for(var n=e.getStemX(),r=this.render_options.beam_width*this.stem_direction,o=0;o<t.length;++o){for(var s=t[o],a=this.getBeamLines(s),h=0;h<a.length;++h){var u=a[h],l=u.start,c=this.getSlopeY(l,n,i,this.slope),f=u.end,d=this.getSlopeY(f,n,i,this.slope);this.context.beginPath(),this.context.moveTo(l,c),this.context.lineTo(l,c+r),this.context.lineTo(f+1,d+r),this.context.lineTo(f+1,d),this.context.closePath(),this.context.fill()}i+=1.5*r}}},{key:"preFormat",value:function(){return this}},{key:"postFormat",value:function(){this.postFormatted||("tabnotes"===this.notes[0].getCategory()||this.render_options.flat_beams?this.calculateFlatSlope():this.calculateSlope(),this.applyStemExtensions(),this.postFormatted=!0)}},{key:"draw",value:function(){this.checkContext(),this.setRendered(),this.unbeamable||(this.postFormatted||this.postFormat(),this.drawStems(),this.applyStyle(),this.drawBeamLines(),this.restoreStyle())}}]),e}(),To=function(t){function e(){fi(this,e);var t=ni(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return t.setAttribute("type","StaveModifier"),t.padding=10,t.position=e.Position.ABOVE,t}return ci(e,fr),gi(e,null,[{key:"Position",get:function(){return{LEFT:1,RIGHT:2,ABOVE:3,BELOW:4,BEGIN:5,END:6}}}]),gi(e,[{key:"getPosition",value:function(){return this.position}},{key:"setPosition",value:function(t){return this.position=t,this}},{key:"getStave",value:function(){return this.stave}},{key:"setStave",value:function(t){return this.stave=t,this}},{key:"getWidth",value:function(){return this.width}},{key:"setWidth",value:function(t){return this.width=t,this}},{key:"getX",value:function(){return this.x}},{key:"setX",value:function(t){return this.x=t,this}},{key:"getCategory",value:function(){return""}},{key:"makeSpacer",value:function(t){return{getContext:function(){return!0},setStave:function(){},renderToStave:function(){},getMetrics:function(){return{width:t}}}}},{key:"placeGlyphOnLine",value:function(t,e,i){t.setYShift(e.getYForLine(i)-e.getYForGlyphs())}},{key:"getPadding",value:function(t){return void 0!==t&&t<2?0:this.padding}},{key:"setPadding",value:function(t){return this.padding=t,this}}]),e}(),So=function(t){function e(t){fi(this,e);var i=ni(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));i.setAttribute("type","Barline"),i.thickness=yr.STAVE_LINE_THICKNESS;var n=e.type;return i.widths={},i.widths[n.SINGLE]=5,i.widths[n.DOUBLE]=5,i.widths[n.END]=5,i.widths[n.REPEAT_BEGIN]=5,i.widths[n.REPEAT_END]=5,i.widths[n.REPEAT_BOTH]=5,i.widths[n.NONE]=5,i.paddings={},i.paddings[n.SINGLE]=0,i.paddings[n.DOUBLE]=0,i.paddings[n.END]=0,i.paddings[n.REPEAT_BEGIN]=15,i.paddings[n.REPEAT_END]=15,i.paddings[n.REPEAT_BOTH]=15,i.paddings[n.NONE]=0,i.setPosition(To.Position.BEGIN),i.setType(t),i}return ci(e,To),gi(e,null,[{key:"CATEGORY",get:function(){return"barlines"}},{key:"type",get:function(){return{SINGLE:1,DOUBLE:2,END:3,REPEAT_BEGIN:4,REPEAT_END:5,REPEAT_BOTH:6,NONE:7}}},{key:"typeString",get:function(){return{single:e.type.SINGLE,double:e.type.DOUBLE,end:e.type.END,repeatBegin:e.type.REPEAT_BEGIN,repeatEnd:e.type.REPEAT_END,repeatBoth:e.type.REPEAT_BOTH,none:e.type.NONE}}}]),gi(e,[{key:"getCategory",value:function(){return e.CATEGORY}},{key:"getType",value:function(){return this.type}},{key:"setType",value:function(t){return this.type="string"==typeof t?e.typeString[t]:t,this.setWidth(this.widths[this.type]),this.setPadding(this.paddings[this.type]),this}},{key:"draw",value:function(t){switch(t.checkContext(),this.setRendered(),this.type){case e.type.SINGLE:this.drawVerticalBar(t,this.x,!1);break;case e.type.DOUBLE:this.drawVerticalBar(t,this.x,!0);break;case e.type.END:this.drawVerticalEndBar(t,this.x);break;case e.type.REPEAT_BEGIN:this.drawRepeatBar(t,this.x,!0),t.getX()!==this.x&&this.drawVerticalBar(t,t.getX());break;case e.type.REPEAT_END:this.drawRepeatBar(t,this.x,!1);break;case e.type.REPEAT_BOTH:this.drawRepeatBar(t,this.x,!1),this.drawRepeatBar(t,this.x,!0)}}},{key:"drawVerticalBar",value:function(t,e,i){t.checkContext();var n=t.getTopLineTopY(),r=t.getBottomLineBottomY();i&&t.context.fillRect(e-3,n,1,r-n),t.context.fillRect(e,n,1,r-n)}},{key:"drawVerticalEndBar",value:function(t,e){t.checkContext();var i=t.getTopLineTopY(),n=t.getBottomLineBottomY();t.context.fillRect(e-5,i,1,n-i),t.context.fillRect(e-2,i,3,n-i)}},{key:"drawRepeatBar",value:function(t,e,i){t.checkContext();var n=t.getTopLineTopY(),r=t.getBottomLineBottomY(),o=3;i||(o=-5),t.context.fillRect(e+o,n,1,r-n),t.context.fillRect(e-2,n,3,r-n);i?o+=4:o-=4;var s=e+o+1,a=(t.getNumLines()-1)*t.getSpacingBetweenLines(),h=n+(a=a/2-t.getSpacingBetweenLines()/2)+1;t.context.beginPath(),t.context.arc(s,h,2,0,2*Math.PI,!1),t.context.fill(),h+=t.getSpacingBetweenLines(),t.context.beginPath(),t.context.arc(s,h,2,0,2*Math.PI,!1),t.context.fill()}}]),e}(),Eo=function(t){function e(t,i,n){fi(this,e);var r=ni(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return r.setAttribute("type","Repetition"),r.symbol_type=t,r.x=i,r.x_shift=0,r.y_shift=n,r.font={family:"times",size:12,weight:"bold italic"},r}return ci(e,To),gi(e,null,[{key:"CATEGORY",get:function(){return"repetitions"}},{key:"type",get:function(){return{NONE:1,CODA_LEFT:2,CODA_RIGHT:3,SEGNO_LEFT:4,SEGNO_RIGHT:5,DC:6,DC_AL_CODA:7,DC_AL_FINE:8,DS:9,DS_AL_CODA:10,DS_AL_FINE:11,FINE:12}}}]),gi(e,[{key:"getCategory",value:function(){return e.CATEGORY}},{key:"setShiftX",value:function(t){return this.x_shift=t,this}},{key:"setShiftY",value:function(t){return this.y_shift=t,this}},{key:"draw",value:function(t,i){switch(this.setRendered(),this.symbol_type){case e.type.CODA_RIGHT:this.drawCodaFixed(t,i+t.width);break;case e.type.CODA_LEFT:this.drawSymbolText(t,i,"Coda",!0);break;case e.type.SEGNO_LEFT:this.drawSignoFixed(t,i);break;case e.type.SEGNO_RIGHT:this.drawSignoFixed(t,i+t.width);break;case e.type.DC:this.drawSymbolText(t,i,"D.C.",!1);break;case e.type.DC_AL_CODA:this.drawSymbolText(t,i,"D.C. al",!0);break;case e.type.DC_AL_FINE:this.drawSymbolText(t,i,"D.C. al Fine",!1);break;case e.type.DS:this.drawSymbolText(t,i,"D.S.",!1);break;case e.type.DS_AL_CODA:this.drawSymbolText(t,i,"D.S. al",!0);break;case e.type.DS_AL_FINE:this.drawSymbolText(t,i,"D.S. al Fine",!1);break;case e.type.FINE:this.drawSymbolText(t,i,"Fine",!1)}return this}},{key:"drawCodaFixed",value:function(t,e){var i=t.getYForTopText(t.options.num_lines)+this.y_shift;return vr.renderGlyph(t.context,this.x+e+this.x_shift,i+25,40,"v4d",!0),this}},{key:"drawSignoFixed",value:function(t,e){var i=t.getYForTopText(t.options.num_lines)+this.y_shift;return vr.renderGlyph(t.context,this.x+e+this.x_shift,i+25,30,"v8c",!0),this}},{key:"drawSymbolText",value:function(t,i,n,r){var o=t.checkContext();o.save(),o.setFont(this.font.family,this.font.size,this.font.weight);var s=0+this.x_shift,a=i+this.x_shift;this.symbol_type===e.type.CODA_LEFT?a=(s=this.x+t.options.vertical_bar_width)+o.measureText(n).width+12:s=(a=this.x+i+t.width-5+this.x_shift)-+o.measureText(n).width-12;var h=t.getYForTopText(t.options.num_lines)+this.y_shift;return r&&vr.renderGlyph(o,a,h,40,"v4d",!0),o.fillText(n,s,h+5),o.restore(),this}}]),e}(),Ro=function(t){function e(t,i,n){fi(this,e);var r=ni(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return r.setAttribute("type","StaveSection"),r.setWidth(16),r.section=t,r.x=i,r.shift_x=0,r.shift_y=n,r.font={family:"sans-serif",size:12,weight:"bold"},r}return ci(e,To),gi(e,null,[{key:"CATEGORY",get:function(){return"stavesection"}}]),gi(e,[{key:"getCategory",value:function(){return e.CATEGORY}},{key:"setStaveSection",value:function(t){return this.section=t,this}},{key:"setShiftX",value:function(t){return this.shift_x=t,this}},{key:"setShiftY",value:function(t){return this.shift_y=t,this}},{key:"draw",value:function(t,e){var i=t.checkContext();this.setRendered(),i.save(),i.lineWidth=2,i.setFont(this.font.family,this.font.size,this.font.weight);var n=i.measureText(""+this.section).width,r=n+6;r<18&&(r=18);var o=t.getYForTopText(3)+this.shift_y,s=this.x+e;return i.beginPath(),i.lineWidth=2,i.rect(s,o,r,20),i.stroke(),s+=(r-n)/2,i.fillText(""+this.section,s,o+16),i.restore(),this}}]),e}(),Co=function(t){function e(t,i,n){fi(this,e);var r=ni(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return r.setAttribute("type","StaveTempo"),r.tempo=t,r.position=br.Position.ABOVE,r.x=i,r.shift_x=10,r.shift_y=n,r.font={family:"times",size:14,weight:"bold"},r.render_options={glyph_font_scale:30},r}return ci(e,To),gi(e,null,[{key:"CATEGORY",get:function(){return"stavetempo"}}]),gi(e,[{key:"getCategory",value:function(){return e.CATEGORY}},{key:"setTempo",value:function(t){return this.tempo=t,this}},{key:"setShiftX",value:function(t){return this.shift_x=t,this}},{key:"setShiftY",value:function(t){return this.shift_y=t,this}},{key:"draw",value:function(t,e){var i=t.checkContext();this.setRendered();var n=this.render_options,r=n.glyph_font_scale/38,o=this.tempo.name,s=this.tempo.duration,a=this.tempo.dots,h=this.tempo.bpm,u=this.font,l=this.x+this.shift_x+e,c=t.getYForTopText(1)+this.shift_y;if(i.save(),o&&(i.setFont(u.family,u.size,u.weight),i.fillText(o,l,c),l+=i.measureText(o).width),s&&h){i.setFont(u.family,u.size,"normal"),o&&(l+=i.measureText(" ").width,i.fillText("(",l,c),l+=i.measureText("(").width);var f=yr.durationToGlyph(s);if(l+=3*r,vr.renderGlyph(i,l,c,n.glyph_font_scale,f.code_head),l+=f.getWidth()*r,f.stem){var d=30;f.beam_count&&(d+=3*(f.beam_count-1));var v=c-(d*=r);i.fillRect(l-r,v,r,d),f.flag&&(vr.renderGlyph(i,l,v,n.glyph_font_scale,f.code_flag_upstem),a||(l+=6*r))}for(var y=0;y<a;y++)l+=6*r,i.beginPath(),i.arc(l,c+2*r,2*r,0,2*Math.PI,!1),i.fill();i.fillText(" = "+h+(o?")":""),l+3*r,c)}return i.restore(),this}}]),e}(),Oo=function(t){function e(t){fi(this,e);var i=ni(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));if(i.setAttribute("type","TextNote"),i.text=t.text,i.superscript=t.superscript,i.subscript=t.subscript,i.glyph_type=t.glyph,i.glyph=null,i.font={family:"Arial",size:12,weight:""},t.font&&(i.font=t.font),i.glyph_type){var n=e.GLYPHS[i.glyph_type];if(!n)throw new or.RERR("Invalid glyph type: "+i.glyph_type);i.glyph=new vr(n.code,n.point,{cache:!1}),n.width?i.setWidth(n.width):i.setWidth(i.glyph.getMetrics().width),i.glyph_struct=n}else i.setWidth(yr.textWidth(i.text));return i.line=t.line||0,i.smooth=t.smooth||!1,i.ignore_ticks=t.ignore_ticks||!1,i.justification=e.Justification.LEFT,i}return ci(e,_r),gi(e,null,[{key:"Justification",get:function(){return{LEFT:1,CENTER:2,RIGHT:3}}},{key:"GLYPHS",get:function(){return{segno:{code:"v8c",point:40,x_shift:0,y_shift:-10},tr:{code:"v1f",point:40,x_shift:0,y_shift:0},mordent_upper:{code:"v1e",point:40,x_shift:0,y_shift:0},mordent_lower:{code:"v45",point:40,x_shift:0,y_shift:0},f:{code:"vba",point:40,x_shift:0,y_shift:0},p:{code:"vbf",point:40,x_shift:0,y_shift:0},m:{code:"v62",point:40,x_shift:0,y_shift:0},s:{code:"v4a",point:40,x_shift:0,y_shift:0},z:{code:"v80",point:40,x_shift:0,y_shift:0},coda:{code:"v4d",point:40,x_shift:0,y_shift:-8},pedal_open:{code:"v36",point:40,x_shift:0,y_shift:0},pedal_close:{code:"v5d",point:40,x_shift:0,y_shift:3},caesura_straight:{code:"v34",point:40,x_shift:0,y_shift:2},caesura_curved:{code:"v4b",point:40,x_shift:0,y_shift:2},breath:{code:"v6c",point:40,x_shift:0,y_shift:0},tick:{code:"v6f",point:50,x_shift:0,y_shift:0},turn:{code:"v72",point:40,x_shift:0,y_shift:0},turn_inverted:{code:"v33",point:40,x_shift:0,y_shift:0},mordent:{code:"v1e",point:40,x_shift:0,y_shift:0}}}}]),gi(e,[{key:"setJustification",value:function(t){return this.justification=t,this}},{key:"setLine",value:function(t){return this.line=t,this}},{key:"preFormat",value:function(){this.checkContext(),this.preFormatted||(this.smooth?this.setWidth(0):this.glyph||this.setWidth(this.context.measureText(this.text).width),this.justification===e.Justification.CENTER?this.extraLeftPx=this.width/2:this.justification===e.Justification.RIGHT&&(this.extraLeftPx=this.width),this.setPreFormatted(!0))}},{key:"draw",value:function(){if(this.checkContext(),!this.stave)throw new or.RERR("NoStave","Can't draw without a stave.");this.setRendered();var t=this.context,i=this.getAbsoluteX();this.justification===e.Justification.CENTER?i-=this.getWidth()/2:this.justification===e.Justification.RIGHT&&(i-=this.getWidth());var n=void 0;if(this.glyph)n=this.stave.getYForLine(this.line+-3),this.glyph.render(this.context,i+this.glyph_struct.x_shift,n+this.glyph_struct.y_shift);else{n=this.stave.getYForLine(this.line+-3),t.save(),t.setFont(this.font.family,this.font.size,this.font.weight),t.fillText(this.text,i,n);var r=t.measureText("M").width,o=t.measureText(this.text).width;this.superscript&&(t.setFont(this.font.family,this.font.size/1.3,this.font.weight),t.fillText(this.superscript,i+o+2,n-r/2.2)),this.subscript&&(t.setFont(this.font.family,this.font.size/1.3,this.font.weight),t.fillText(this.subscript,i+o+2,n+r/2.2-1)),t.restore()}}}]),e}(),No=function(t){function e(t,i,n){fi(this,e);var r=ni(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return r.setAttribute("type","StaveText"),r.setWidth(16),r.text=t,r.position=i,r.options={shift_x:0,shift_y:0,justification:Oo.Justification.CENTER},or.Merge(r.options,n),r.font={family:"times",size:16,weight:"normal"},r}return ci(e,To),gi(e,null,[{key:"CATEGORY",get:function(){return"stavetext"}}]),gi(e,[{key:"getCategory",value:function(){return e.CATEGORY}},{key:"setStaveText",value:function(t){return this.text=t,this}},{key:"setShiftX",value:function(t){return this.shift_x=t,this}},{key:"setShiftY",value:function(t){return this.shift_y=t,this}},{key:"setFont",value:function(t){or.Merge(this.font,t)}},{key:"setText",value:function(t){this.text=t}},{key:"draw",value:function(t){var e=t.checkContext();this.setRendered(),e.save(),e.lineWidth=2,e.setFont(this.font.family,this.font.size,this.font.weight),this.options.fill&&e.setFillStyle(this.options.fill);var i=e.measureText(""+this.text).width,n=void 0,r=void 0,o=To.Position,s=Oo.Justification;switch(this.position){case o.LEFT:case o.RIGHT:r=(t.getYForLine(0)+t.getBottomLineY())/2+this.options.shift_y,n=this.position===o.LEFT?t.getX()-i-24+this.options.shift_x:t.getX()+t.getWidth()+24+this.options.shift_x;break;case o.ABOVE:case o.BELOW:n=t.getX()+this.options.shift_x,this.options.justification===s.CENTER?n+=t.getWidth()/2-i/2:this.options.justification===s.RIGHT&&(n+=t.getWidth()-i),r=this.position===o.ABOVE?t.getYForTopText(2)+this.options.shift_y:t.getYForBottomText(2)+this.options.shift_y;break;default:throw new or.RERR("InvalidPosition","Value Must be in Modifier.Position.")}return e.fillText(""+this.text,n,r+4),e.restore(),this}}]),e}(),Po=function(t){function e(t,i,n){fi(this,e);var r=ni(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return r.setAttribute("type","Clef"),r.setPosition(To.Position.BEGIN),r.setType(t,i,n),r.setWidth(r.glyph.getMetrics().width),function(){for(var t=arguments,e=arguments.length,i=Array(e),n=0;n<e;n++)i[n]=t[n];Po.DEBUG&&or.L("Vex.Flow.Clef",i)}("Creating clef:",t),r}return ci(e,To),gi(e,null,[{key:"CATEGORY",get:function(){return"clefs"}},{key:"types",get:function(){return{treble:{code:"v83",line:3},bass:{code:"v79",line:1},alto:{code:"vad",line:2},tenor:{code:"vad",line:1},percussion:{code:"v59",line:2},soprano:{code:"vad",line:4},"mezzo-soprano":{code:"vad",line:3},"baritone-c":{code:"vad",line:0},"baritone-f":{code:"v79",line:2},subbass:{code:"v79",line:0},french:{code:"v83",line:4},tab:{code:"v2f"}}}},{key:"sizes",get:function(){return{default:40,small:32}}},{key:"annotations",get:function(){return{"8va":{code:"v8",sizes:{default:{point:20,attachments:{treble:{line:-1.2,x_shift:11}}},small:{point:18,attachments:{treble:{line:-.4,x_shift:8}}}}},"8vb":{code:"v8",sizes:{default:{point:20,attachments:{treble:{line:6.3,x_shift:10},bass:{line:4,x_shift:1}}},small:{point:18,attachments:{treble:{line:5.8,x_shift:6},bass:{line:3.5,x_shift:.5}}}}}}}}]),gi(e,[{key:"getCategory",value:function(){return e.CATEGORY}},{key:"setType",value:function(t,i,n){if(this.type=t,this.clef=e.types[t],this.size=void 0===i?"default":i,this.clef.point=e.sizes[this.size],this.glyph=new vr(this.clef.code,this.clef.point),void 0!==n){var r=e.annotations[n];this.annotation={code:r.code,point:r.sizes[this.size].point,line:r.sizes[this.size].attachments[this.type].line,x_shift:r.sizes[this.size].attachments[this.type].x_shift},this.attachment=new vr(this.annotation.code,this.annotation.point),this.attachment.metrics.x_max=0,this.attachment.setXShift(this.annotation.x_shift)}else this.annotation=void 0;return this}},{key:"getWidth",value:function(){if("tab"===this.type&&!this.stave)throw new or.RERR("ClefError","Can't get width without stave.");return this.width}},{key:"setStave",value:function(t){if(this.stave=t,"tab"!==this.type)return this;var e=void 0,i=void 0,n=this.stave.getOptions().num_lines;switch(n){case 8:e=55,i=14;break;case 7:e=47,i=8;break;case 6:e=40,i=1;break;case 5:e=30,i=-6;break;case 4:e=23,i=-12;break;default:throw new or.RERR("ClefError","Invalid number of lines: "+n)}return this.glyph.setPoint(e),this.glyph.setYShift(i),this}},{key:"draw",value:function(){if(!this.x)throw new or.RERR("ClefError","Can't draw clef without x.");if(!this.stave)throw new or.RERR("ClefError","Can't draw clef without stave.");this.setRendered(),this.glyph.setStave(this.stave),this.glyph.setContext(this.stave.context),void 0!==this.clef.line&&this.placeGlyphOnLine(this.glyph,this.stave,this.clef.line),this.glyph.renderToStave(this.x),void 0!==this.annotation&&(this.placeGlyphOnLine(this.attachment,this.stave,this.annotation.line),this.attachment.setStave(this.stave),this.attachment.setContext(this.stave.context),this.attachment.renderToStave(this.x))}}]),e}(),Ao=function(t){function e(t,i,n){fi(this,e);var r=ni(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return r.setAttribute("type","KeySignature"),r.setKeySig(t,i,n),r.setPosition(To.Position.BEGIN),r.glyphFontScale=38,r.glyphs=[],r.xPositions=[],r.paddingForced=!1,r}return ci(e,To),gi(e,null,[{key:"CATEGORY",get:function(){return"keysignatures"}},{key:"accidentalSpacing",get:function(){return{"#":{above:6,below:4},b:{above:4,below:7},n:{above:4,below:1},"##":{above:6,below:4},bb:{above:4,below:7},db:{above:4,below:7},d:{above:4,below:7},bbs:{above:4,below:7},"++":{above:6,below:4},"+":{above:6,below:4},"+-":{above:6,below:4},"++-":{above:6,below:4},bs:{above:4,below:10},bss:{above:4,below:10}}}}]),gi(e,[{key:"getCategory",value:function(){return e.CATEGORY}},{key:"convertToGlyph",value:function(t,i){var n=yr.accidentalCodes(t.type),r=new vr(n.code,this.glyphFontScale),o=1;if("n"===t.type&&i){var s=e.accidentalSpacing[i.type];if(s){o=i.line>=t.line?s.above:s.below}}this.placeGlyphOnLine(r,this.stave,t.line),this.glyphs.push(r);var a=this.xPositions[this.xPositions.length-1],h=r.getMetrics().width+o;this.xPositions.push(a+h),this.width+=h}},{key:"cancelKey",value:function(t){return this.formatted=!1,this.cancelKeySpec=t,this}},{key:"convertToCancelAccList",value:function(t){var e=yr.keySignature(t),i=this.accList.length>0&&e.length>0&&e[0].type!==this.accList[0].type,n=i?e.length:e.length-this.accList.length;if(!(n<1)){for(var r=[],o=0;o<n;o++){var s=o;i||(s=e.length-n+o);var a=e[s];r.push({type:"n",line:a.line})}this.accList=r.concat(this.accList)}}},{key:"addToStave",value:function(t){return this.paddingForced=!0,t.addModifier(this),this}},{key:"convertAccLines",value:function(t,e){var i=0,n=void 0;switch(t){case"soprano":"#"===e?n=[2.5,.5,2,0,1.5,-.5,1]:i=-1;break;case"mezzo-soprano":"b"===e?n=[0,2,.5,2.5,1,3,1.5]:i=1.5;break;case"alto":i=.5;break;case"tenor":"#"===e?n=[3,1,2.5,.5,2,0,1.5]:i=-.5;break;case"baritone-f":case"baritone-c":"b"===e?n=[.5,2.5,1,3,1.5,3.5,2]:i=2;break;case"bass":case"french":i=1}var r=void 0;if(void 0!==n)for(r=0;r<this.accList.length;++r)this.accList[r].line=n[r];else if(0!==i)for(r=0;r<this.accList.length;++r)this.accList[r].line+=i}},{key:"getPadding",value:function(t){return this.formatted||this.format(),0===this.glyphs.length||!this.paddingForced&&t<2?0:this.padding}},{key:"getWidth",value:function(){return this.formatted||this.format(),this.width}},{key:"setKeySig",value:function(t,e,i){return this.formatted=!1,this.keySpec=t,this.cancelKeySpec=e,this.alterKeySpec=i,this}},{key:"alterKey",value:function(t){return this.formatted=!1,this.alterKeySpec=t,this}},{key:"convertToAlterAccList",value:function(t){for(var e=Math.min(t.length,this.accList.length),i=0;i<e;++i)t[i]&&(this.accList[i].type=t[i])}},{key:"format",value:function(){if(!this.stave)throw new or.RERR("KeySignatureError","Can't draw key signature without stave.");this.width=0,this.glyphs=[],this.xPositions=[0],this.accList=yr.keySignature(this.keySpec),this.cancelKeySpec&&this.convertToCancelAccList(this.cancelKeySpec);var t=this.accList.length>0?this.accList[0].type:null;if(this.alterKeySpec&&this.convertToAlterAccList(this.alterKeySpec),this.accList.length>0){this.convertAccLines(this.stave.clef,t);for(var e=0;e<this.accList.length;++e)this.convertToGlyph(this.accList[e],this.accList[e+1])}this.formatted=!0}},{key:"draw",value:function(){if(!this.x)throw new or.RERR("KeySignatureError","Can't draw key signature without x.");if(!this.stave)throw new or.RERR("KeySignatureError","Can't draw key signature without stave.");this.formatted||this.format(),this.setRendered();for(var t=0;t<this.glyphs.length;t++){var e=this.glyphs[t],i=this.x+this.xPositions[t];e.setStave(this.stave),e.setContext(this.stave.context),e.renderToStave(i)}}}]),e}(),Lo=function(t){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:15;fi(this,e);var n=ni(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));if(n.setAttribute("type","TimeSignature"),null===t)return ni(n);var r=i;return n.point=40,n.topLine=2,n.bottomLine=4,n.setPosition(To.Position.BEGIN),n.setTimeSig(t),n.setWidth(n.timeSig.glyph.getMetrics().width),n.setPadding(r),n}return ci(e,To),gi(e,null,[{key:"CATEGORY",get:function(){return"timesignatures"}},{key:"glyphs",get:function(){return{C:{code:"v41",point:40,line:2},"C|":{code:"vb6",point:40,line:2}}}}]),gi(e,[{key:"getCategory",value:function(){return e.CATEGORY}},{key:"parseTimeSpec",value:function(t){if("C"===t||"C|"===t){var i=e.glyphs[t],n=i.line,r=i.code,o=i.point;return{line:n,num:!1,glyph:new vr(r,o)}}!function(t){var e=t.split("/").filter(function(t){return""!==t});if(2!==e.length)throw new or.RERR("BadTimeSignature","Invalid time spec: "+t+'. Must be in the form "<numerator>/<denominator>"');e.forEach(function(e){if(isNaN(Number(e)))throw new or.RERR("BadTimeSignature","Invalid time spec: "+t+". Must contain two valid numbers.")})}(t);var s=t.split("/").map(function(t){return t.split("")}),a=nn(s,2),h=a[0],u=a[1];return{num:!0,glyph:this.makeTimeSignatureGlyph(h,u)}}},{key:"makeTimeSignatureGlyph",value:function(t,e){var i=new vr("v0",this.point);i.topGlyphs=[],i.botGlyphs=[];for(var n=0,r=0;r<t.length;++r){var o=t[r],s=new vr("v"+o,this.point);i.topGlyphs.push(s),n+=s.getMetrics().width}for(var a=0,h=0;h<e.length;++h){var u=e[h],l=new vr("v"+u,this.point);i.botGlyphs.push(l),a+=l.getMetrics().width}var c=n>a?n:a,f=i.getMetrics().x_min;i.getMetrics=function(){return{x_min:f,x_max:f+c,width:c}};var d=(c-n)/2,v=(c-a)/2,y=this;return i.renderToStave=function(t){for(var e=t+d,i=0;i<this.topGlyphs.length;++i){var n=this.topGlyphs[i];vr.renderOutline(this.context,n.metrics.outline,n.scale,e+n.x_shift,this.stave.getYForLine(y.topLine)+1),e+=n.getMetrics().width}e=t+v;for(var r=0;r<this.botGlyphs.length;++r){var o=this.botGlyphs[r];y.placeGlyphOnLine(o,this.stave,o.line),vr.renderOutline(this.context,o.metrics.outline,o.scale,e+o.x_shift,this.stave.getYForLine(y.bottomLine)+1),e+=o.getMetrics().width}},i}},{key:"getTimeSig",value:function(){return this.timeSig}},{key:"setTimeSig",value:function(t){return this.timeSig=this.parseTimeSpec(t),this}},{key:"draw",value:function(){if(!this.x)throw new or.RERR("TimeSignatureError","Can't draw time signature without x.");if(!this.stave)throw new or.RERR("TimeSignatureError","Can't draw time signature without stave.");this.setRendered(),this.timeSig.glyph.setStave(this.stave),this.timeSig.glyph.setContext(this.stave.context),this.placeGlyphOnLine(this.timeSig.glyph,this.stave,this.timeSig.line),this.timeSig.glyph.renderToStave(this.x)}}]),e}(),Mo=function(t){function e(t,i,n,r){fi(this,e);var o=ni(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return o.setAttribute("type","Volta"),o.volta=t,o.x=n,o.y_shift=r,o.number=i,o.font={family:"sans-serif",size:9,weight:"bold"},o}return ci(e,To),gi(e,null,[{key:"CATEGORY",get:function(){return"voltas"}},{key:"type",get:function(){return{NONE:1,BEGIN:2,MID:3,END:4,BEGIN_END:5}}}]),gi(e,[{key:"getCategory",value:function(){return e.CATEGORY}},{key:"setShiftY",value:function(t){return this.y_shift=t,this}},{key:"draw",value:function(t,i){var n=t.checkContext();this.setRendered();var r=t.width,o=t.getYForTopText(t.options.num_lines)+this.y_shift,s=1.5*t.options.spacing_between_lines_px;switch(this.volta){case e.type.BEGIN:n.fillRect(this.x+i,o,1,s);break;case e.type.END:r-=5,n.fillRect(this.x+i+r,o,1,s);break;case e.type.BEGIN_END:r-=3,n.fillRect(this.x+i,o,1,s),n.fillRect(this.x+i+r,o,1,s)}return this.volta!==e.type.BEGIN&&this.volta!==e.type.BEGIN_END||(n.save(),n.setFont(this.font.family,this.font.size,this.font.weight),n.fillText(this.number,this.x+i+5,o+15),n.restore()),n.fillRect(this.x+i,o,r,1),this}}]),e}(),Fo=function(t){function e(t,i,n,r){fi(this,e);var o=ni(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));o.setAttribute("type","Stave"),o.x=t,o.y=i,o.width=n,o.formatted=!1,o.start_x=t+5,o.end_x=t+n,o.modifiers=[],o.measure=0,o.clef="treble",o.font={family:"sans-serif",size:8,weight:""},o.options={vertical_bar_width:10,glyph_spacing_px:10,num_lines:5,fill_style:"#999999",left_bar:!0,right_bar:!0,spacing_between_lines_px:10,space_above_staff_ln:4,space_below_staff_ln:4,top_text_position:1},o.bounds={x:o.x,y:o.y,w:o.width,h:0},or.Merge(o.options,r),o.resetLines();var s=So.type;return o.addModifier(new So(o.options.left_bar?s.SINGLE:s.NONE)),o.addEndModifier(new So(o.options.right_bar?s.SINGLE:s.NONE)),o}return ci(e,fr),gi(e,[{key:"space",value:function(t){return this.options.spacing_between_lines_px*t}},{key:"resetLines",value:function(){this.options.line_config=[];for(var t=0;t<this.options.num_lines;t++)this.options.line_config.push({visible:!0});this.height=(this.options.num_lines+this.options.space_above_staff_ln)*this.options.spacing_between_lines_px,this.options.bottom_text_position=this.options.num_lines}},{key:"getOptions",value:function(){return this.options}},{key:"setNoteStartX",value:function(t){return this.formatted||this.format(),this.start_x=t,this}},{key:"getNoteStartX",value:function(){return this.formatted||this.format(),this.start_x}},{key:"getNoteEndX",value:function(){return this.formatted||this.format(),this.end_x}},{key:"getTieStartX",value:function(){return this.start_x}},{key:"getTieEndX",value:function(){return this.x+this.width}},{key:"getX",value:function(){return this.x}},{key:"getNumLines",value:function(){return this.options.num_lines}},{key:"setNumLines",value:function(t){return this.options.num_lines=parseInt(t,10),this.resetLines(),this}},{key:"setY",value:function(t){return this.y=t,this}},{key:"getTopLineTopY",value:function(){return this.getYForLine(0)-yr.STAVE_LINE_THICKNESS/2}},{key:"getBottomLineBottomY",value:function(){return this.getYForLine(this.getNumLines()-1)+yr.STAVE_LINE_THICKNESS/2}},{key:"setX",value:function(t){var e=t-this.x;this.formatted=!1,this.x=t,this.start_x+=e,this.end_x+=e;for(var i=0;i<this.modifiers.length;i++){var n=this.modifiers[i];void 0!==n.x&&(n.x+=e)}return this}},{key:"setWidth",value:function(t){return this.formatted=!1,this.width=t,this.end_x=this.x+t,this}},{key:"getWidth",value:function(){return this.width}},{key:"getStyle",value:function(){return Object.assign({fillStyle:this.options.fill_style,strokeStyle:this.options.fill_style,lineWidth:yr.STAVE_LINE_THICKNESS},this.style||{})}},{key:"setMeasure",value:function(t){return this.measure=t,this}},{key:"getModifierXShift",value:function(){if("number"!=typeof(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))throw new or.RERR("InvalidIndex","Must be of number type");if(this.formatted||this.format(),1===this.getModifiers(To.Position.BEGIN).length)return 0;var t=this.start_x-this.x,e=this.modifiers[0];return e.getType()===So.type.REPEAT_BEGIN&&t>e.getWidth()&&(t-=e.getWidth()),t}},{key:"setRepetitionTypeLeft",value:function(t,e){return this.modifiers.push(new Eo(t,this.x,e)),this}},{key:"setRepetitionTypeRight",value:function(t,e){return this.modifiers.push(new Eo(t,this.x,e)),this}},{key:"setVoltaType",value:function(t,e,i){return this.modifiers.push(new Mo(t,e,this.x,i)),this}},{key:"setSection",value:function(t,e){return this.modifiers.push(new Ro(t,this.x,e)),this}},{key:"setTempo",value:function(t,e){return this.modifiers.push(new Co(t,this.x,e)),this}},{key:"setText",value:function(t,e,i){return this.modifiers.push(new No(t,e,i)),this}},{key:"getHeight",value:function(){return this.height}},{key:"getSpacingBetweenLines",value:function(){return this.options.spacing_between_lines_px}},{key:"getBoundingBox",value:function(){return new hr(this.x,this.y,this.width,this.getBottomY()-this.y)}},{key:"getBottomY",value:function(){var t=this.options,e=t.spacing_between_lines_px;return this.getYForLine(t.num_lines)+t.space_below_staff_ln*e}},{key:"getBottomLineY",value:function(){return this.getYForLine(this.options.num_lines)}},{key:"getYForLine",value:function(t){var e=this.options,i=e.spacing_between_lines_px,n=e.space_above_staff_ln;return this.y+t*i+n*i}},{key:"getLineForY",value:function(t){var e=this.options,i=e.spacing_between_lines_px,n=e.space_above_staff_ln;return(t-this.y)/i-n}},{key:"getYForTopText",value:function(t){var e=t||0;return this.getYForLine(-e-this.options.top_text_position)}},{key:"getYForBottomText",value:function(t){var e=t||0;return this.getYForLine(this.options.bottom_text_position+e)}},{key:"getYForNote",value:function(t){var e=this.options,i=e.spacing_between_lines_px,n=e.space_above_staff_ln;return this.y+n*i+5*i-t*i}},{key:"getYForGlyphs",value:function(){return this.getYForLine(3)}},{key:"addModifier",value:function(t,e){return void 0!==e&&t.setPosition(e),t.setStave(this),this.formatted=!1,this.modifiers.push(t),this}},{key:"addEndModifier",value:function(t){return this.addModifier(t,To.Position.END),this}},{key:"setBegBarType",value:function(t){var e=So.type,i=e.SINGLE,n=e.REPEAT_BEGIN,r=e.NONE;return t!==i&&t!==n&&t!==r||(this.modifiers[0].setType(t),this.formatted=!1),this}},{key:"setEndBarType",value:function(t){return t!==So.type.REPEAT_BEGIN&&(this.modifiers[1].setType(t),this.formatted=!1),this}},{key:"setClef",value:function(t,e,i,n){void 0===n&&(n=To.Position.BEGIN),this.clef=t;var r=this.getModifiers(n,Po.CATEGORY);return 0===r.length?this.addClef(t,e,i,n):r[0].setType(t,e,i),this}},{key:"setEndClef",value:function(t,e,i){return this.setClef(t,e,i,To.Position.END),this}},{key:"setKeySignature",value:function(t,e,i){void 0===i&&(i=To.Position.BEGIN);var n=this.getModifiers(i,Ao.CATEGORY);return 0===n.length?this.addKeySignature(t,e,i):n[0].setKeySig(t,e),this}},{key:"setEndKeySignature",value:function(t,e){return this.setKeySignature(t,e,To.Position.END),this}},{key:"setTimeSignature",value:function(t,e,i){void 0===i&&(i=To.Position.BEGIN);var n=this.getModifiers(i,Lo.CATEGORY);return 0===n.length?this.addTimeSignature(t,e,i):n[0].setTimeSig(t),this}},{key:"setEndTimeSignature",value:function(t,e){return this.setTimeSignature(t,e,To.Position.END),this}},{key:"addKeySignature",value:function(t,e,i){return this.addModifier(new Ao(t,e),i),this}},{key:"addClef",value:function(t,e,i,n){return void 0!==n&&n!==To.Position.BEGIN||(this.clef=t),this.addModifier(new Po(t,e,i),n),this}},{key:"addEndClef",value:function(t,e,i){return this.addClef(t,e,i,To.Position.END),this}},{key:"addTimeSignature",value:function(t,e,i){return this.addModifier(new Lo(t,e),i),this}},{key:"addEndTimeSignature",value:function(t,e){return this.addTimeSignature(t,e,To.Position.END),this}},{key:"addTrebleGlyph",value:function(){return this.addClef("treble"),this}},{key:"getModifiers",value:function(t,e){return void 0===t?this.modifiers:this.modifiers.filter(function(i){return t===i.getPosition()&&(void 0===e||e===i.getCategory())})}},{key:"sortByCategory",value:function(t,e){for(var i=t.length-1;i>=0;i--)for(var n=0;n<i;n++)if(e[t[n].getCategory()]>e[t[n+1].getCategory()]){var r=t[n];t[n]=t[n+1],t[n+1]=r}}},{key:"format",value:function(){var t=this.modifiers[0],e=this.modifiers[1],i=this.getModifiers(To.Position.BEGIN),n=this.getModifiers(To.Position.END);this.sortByCategory(i,{barlines:0,clefs:1,keysignatures:2,timesignatures:3}),this.sortByCategory(n,{timesignatures:0,keysignatures:1,barlines:2,clefs:3}),i.length>1&&t.getType()===So.type.REPEAT_BEGIN&&(i.push(i.splice(0,1)[0]),i.splice(0,0,new So(So.type.SINGLE))),n.indexOf(e)>0&&n.splice(0,0,new So(So.type.NONE));for(var r=void 0,o=void 0,s=void 0,a=0,h=this.x,u=0;u<i.length;u++)o=(s=i[u]).getPadding(u+a),r=s.getWidth(),h+=o,s.setX(h),h+=r,o+r===0&&a--;this.start_x=h,h=this.x+this.width;for(var l=0;l<n.length;l++)h-=(s=n[l]).getPadding(l),0!==l&&(h-=s.getWidth()),s.setX(h),0===l&&(h-=s.getWidth());this.end_x=1===n.length?this.x+this.width:h,this.formatted=!0}},{key:"draw",value:function(){this.checkContext(),this.setRendered(),this.formatted||this.format();for(var t=this.options.num_lines,e=this.width,i=this.x,n=void 0,r=0;r<t;r++)n=this.getYForLine(r),this.applyStyle(),this.options.line_config[r].visible&&(this.context.beginPath(),this.context.moveTo(i,n),this.context.lineTo(i+e,n),this.context.stroke()),this.restoreStyle();for(var o=0;o<this.modifiers.length;o++)"function"==typeof this.modifiers[o].draw&&this.modifiers[o].draw(this,this.getModifierXShift(o));if(this.measure>0){this.context.save(),this.context.setFont(this.font.family,this.font.size,this.font.weight);var s=this.context.measureText(""+this.measure).width;n=this.getYForTopText(0)+3,this.context.fillText(""+this.measure,this.x-s/2,n),this.context.restore()}return this}},{key:"drawVertical",value:function(t,e){this.drawVerticalFixed(this.x+t,e)}},{key:"drawVerticalFixed",value:function(t,e){this.checkContext();var i=this.getYForLine(0),n=this.getYForLine(this.options.num_lines-1);e&&this.context.fillRect(t-3,i,1,n-i+1),this.context.fillRect(t,i,1,n-i+1)}},{key:"drawVerticalBar",value:function(t){this.drawVerticalBarFixed(this.x+t,!1)}},{key:"drawVerticalBarFixed",value:function(t){this.checkContext();var e=this.getYForLine(0),i=this.getYForLine(this.options.num_lines-1);this.context.fillRect(t,e,1,i-e+1)}},{key:"getConfigForLines",value:function(){return this.options.line_config}},{key:"setConfigForLine",value:function(t,e){if(t>=this.options.num_lines||t<0)throw new or.RERR("StaveConfigError","The line number must be within the range of the number of lines in the Stave.");if(void 0===e.visible)throw new or.RERR("StaveConfigError","The line configuration object is missing the 'visible' property.");if("boolean"!=typeof e.visible)throw new or.RERR("StaveConfigError","The line configuration objects 'visible' property must be true or false.");return this.options.line_config[t]=e,this}},{key:"setConfigForLines",value:function(t){if(t.length!==this.options.num_lines)throw new or.RERR("StaveConfigError","The length of the lines configuration array must match the number of lines in the Stave");for(var e in t)t[e]||(t[e]=this.options.line_config[e]),or.Merge(this.options.line_config[e],t[e]);return this.options.line_config=t,this}}]),e}(),Bo=function(){function t(e,i){fi(this,t),this.staveNote=e,this.noteGroup=i,this.beams=[]}return gi(t,[{key:"setBeams",value:function(t){this.beams=t}}]),t}(),Io=function(){function t(e){fi(this,t),this.scoreElem=e}return gi(t,[{key:"clear",value:function(){for(;this.scoreElem.firstChild;)this.scoreElem.removeChild(this.scoreElem.firstChild)}},{key:"toStaveNote",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"treble";return new wr({clef:e,keys:t.noteNames,duration:t.duration})}},{key:"toRenderedMeasures",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4,i=this,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"treble",o=[],s=function(t){var s=[],a=[],h=[],u=!0,l=!1,c=void 0;try{for(var f,d=t[Symbol.iterator]();!(u=(f=d.next()).done);u=!0){var v=f.value,y=[],g=[],p=!0,_=!1,m=void 0;try{for(var x,b=v.scoreObjects[Symbol.iterator]();!(p=(x=b.next()).done);p=!0){var k=x.value,w=i.toStaveNote(k,r);y.push(w);var T=new Bo(w,k.noteGroup);s.push(T),g.push(T)}}catch(t){_=!0,m=t}finally{try{!p&&b.return&&b.return()}finally{if(_)throw m}}var S=new Xr({num_beats:e,beat_value:n});h=h.concat(wo.generateBeams(y)),g.forEach(function(t){t.setBeams(h)}),S.addTickables(y),a.push(S)}}catch(t){l=!0,c=t}finally{try{!u&&d.return&&d.return()}finally{if(l)throw c}}o.push(new function t(e,i,n){fi(this,t),this.vfVoices=e,this.beams=i,this.renderedNotes=n}(a,h,s))},a=!0,h=!1,u=void 0;try{for(var l,c=t[Symbol.iterator]();!(a=(l=c.next()).done);a=!0){s(l.value)}}catch(t){h=!0,u=t}finally{try{!a&&c.return&&c.return()}finally{if(h)throw u}}return o}},{key:"render",value:function(t,e){for(var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"C",n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"treble",r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"4/4",o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:250,s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:60,a=arguments.length>7&&void 0!==arguments[7]?arguments[7]:60,h=arguments.length>8&&void 0!==arguments[8]?arguments[8]:20,u=new ro(this.scoreElem,ro.Backends.SVG).getContext(),l=Or.fromNoteGroup(t).toProperVoices(),c=this.toRenderedMeasures(l),f=function(t){var f=t==l.length-1,d=c[t],v=e[t],y=new Fo(a+t*o+(0==t?0:s),h,o+(0==t?s:0));if(y.setText(v.namedChord.name,br.Position.BELOW,{fill:f?"#ccc":"#000",shift_y:20}),0==t&&y.addClef(n).addTimeSignature(r),y.setContext(u).draw(),Ur.applyAccidentals(d.vfVoices,i),f){var g=!0,p=!1,_=void 0;try{for(var m,x=d.beams[Symbol.iterator]();!(g=(m=x.next()).done);g=!0){m.value.setStyle({fillStyle:"#ccc",strokeStyle:"#ccc"})}}catch(t){p=!0,_=t}finally{try{!g&&x.return&&x.return()}finally{if(p)throw _}}var b=!0,k=!1,w=void 0;try{for(var T,S=d.vfVoices[Symbol.iterator]();!(b=(T=S.next()).done);b=!0){T.value.setStyle({fillStyle:"#ccc",strokeStyle:"#ccc"})}}catch(t){k=!0,w=t}finally{try{!b&&S.return&&S.return()}finally{if(k)throw w}}}(new bo).joinVoices(d.vfVoices).format(d.vfVoices,o),d.vfVoices.forEach(function(t){return t.draw(u,y)}),d.beams.forEach(function(t){return t.setContext(u).draw()})},d=0;d<l.length;d++)f(d);return c}}]),t}(),Go=new w({target:document.getElementById("arpeggiator")});new rr(function(t){var e=new pi(t,bi,6),i=new rn(120),n=new sn(i),r=document.getElementById("score"),o=new Io(r),s=new er(new ki("A4"),Mn,Fn,-1),a=null;""!=location.hash.trim()&&(a=location.hash.trim().replace("#","").replace("_","#"));new Lr(o,n,e,Go,s,On,a).render()})}();
